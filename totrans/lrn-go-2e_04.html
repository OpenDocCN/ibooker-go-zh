<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Blocks, Shadows, and Control Structures"><div class="chapter" id="unique_chapter_id_04">
<h1><span class="label">Chapter 4. </span>Blocks, Shadows, and Control Structures</h1>


<p>Now that I have covered variables, constants, and built-in types, you are ready to look at programming logic and organization. I’ll start by explaining blocks and how they control when an identifier is available. Then I’ll present Go’s control structures: <code>if</code>, <code>for</code>, and <code>switch</code>. Finally, I will talk about <code>goto</code> and the one situation when you should use it.</p>






<section data-type="sect1" data-pdf-bookmark="Blocks"><div class="sect1" id="blocks">
<h1>Blocks</h1>

<p>Go lets you declare variables in lots of places.<a data-type="indexterm" data-primary="blocks" id="id1087"/><a data-type="indexterm" data-primary="variables" data-secondary="declaration" data-tertiary="about" id="id1088"/><a data-type="indexterm" data-primary="variables" data-secondary="declaration" data-tertiary="blocks" id="id1089"/> You can declare them outside of functions, as the parameters to functions, and as local variables within functions.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>So far, you’ve written only the <code>main</code> function, but you’ll write functions with parameters in the next chapter.</p>
</div>

<p>Each place where a declaration occurs is called a <em>block</em>. <a data-type="indexterm" data-primary="blocks" data-secondary="package blocks" id="id1090"/><a data-type="indexterm" data-primary="package blocks" id="id1091"/>Variables, constants, types, and functions declared outside of any functions are placed in the <em>package</em> block. <a data-type="indexterm" data-primary="blocks" data-secondary="file block" id="id1092"/><a data-type="indexterm" data-primary="file block" id="id1093"/>You’ve used <code>import</code> statements in your programs to gain access to printing and math functions (and I will talk about them in detail in <a data-type="xref" href="ch10.html#unique_chapter_id_10">Chapter 10</a>). They define names for other packages that are valid for the file that contains the <code>import</code> statement. These names are in the <em>file</em> block. All the variables defined at the top level of a function (including the parameters to a function) are in a block. <a data-type="indexterm" data-primary="braces ({ })" data-secondary="defining a block" id="id1094"/><a data-type="indexterm" data-primary="{ } (braces)" data-secondary="defining a block" id="id1095"/>Within a function, every set of braces (<code>{}</code>) defines another block, and in a bit you will see that the control structures in Go define blocks of their own.</p>

<p>You can access an identifier defined in any outer block from within any inner block. This raises the question: what happens when you have a declaration with the same name as an identifier in a containing block? If you do that, you <em>shadow</em> the identifier created in the outer block.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Shadowing Variables"><div class="sect1" id="shadowing">
<h1>Shadowing Variables</h1>

<p>Before I explain what shadowing is,<a data-type="indexterm" data-primary="variables" data-secondary="declaration" data-tertiary="shadowing variables" id="ch04-shad"/><a data-type="indexterm" data-primary="shadowing variables" id="ch04-shad2"/><a data-type="indexterm" data-primary="var versus :=" data-secondary="shadowing variables" id="ch04-shad3"/><a data-type="indexterm" data-primary=":= versus var" data-secondary="shadowing variables" id="ch04-shad4"/><a data-type="indexterm" data-primary="troubleshooting" data-secondary="variables" data-tertiary="shadowing variables" id="ch04-shad5"/><a data-type="indexterm" data-primary="if keyword" data-secondary="shadowing variables" id="id1096"/> let’s take a look at some code (see <a data-type="xref" href="#EX3_1-2">Example 4-1</a>). You can run it on <a href="https://oreil.ly/50t6b">The Go Playground</a> or in the <em>sample_code/shadow_variables</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ix_dddd"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ix_ddd"/></p>
<div id="EX3_1-2" data-type="example">
<h5><span class="label">Example 4-1. </span>Shadowing variables</h5>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">x</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">10</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">x</code><code class="w"> </code><code class="p">&gt;</code><code class="w"> </code><code class="mi">5</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="nx">x</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">5</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Before you run this code, try to guess what it’s going to print out:</p>

<ul>
<li>
<p>Nothing prints; the code does not compile</p>
</li>
<li>
<p>10 on line one, 5 on line two, 5 on line three</p>
</li>
<li>
<p>10 on line one, 5 on line two, 10 on line three</p>
</li>
</ul>

<p>Here’s what happens:</p>

<pre data-type="programlisting">10
5
10</pre>

<p>A <em>shadowing variable</em> is a variable that has the same name as a variable in a containing block. For as long as the shadowing variable exists, you cannot access a shadowed variable.</p>

<p>In this case, you almost certainly didn’t want to create a brand-new <code>x</code> inside the <code>if</code> statement. Instead, you probably wanted to assign 5 to the <code>x</code> declared at the top level of the function block. At the first <code>fmt.Println</code> inside the <code>if</code> statement, you are able to access the <code>x</code> declared at the top level of the function. On the next line, though, you <em>shadow</em> <code>x</code> by <em>declaring a new variable with the same name</em> inside the block created by the <code>if</code> statement’s body. At the second <code>fmt.Println</code>, when you access the variable named <code>x</code>, you get the shadowing variable, which has the value of 5. The closing brace for the <code>if</code> statement’s body ends the block where the shadowing <code>x</code> exists, and at the third <code>fmt.Println</code>, when you access the variable named <code>x</code>, you get the variable declared at the top level of the function, which has the value of 10. Notice that this <code>x</code> didn’t disappear or get reassigned; there was just no way to access it once it was shadowed in the inner block.</p>

<p>I mentioned in the previous chapter that in some situations I avoid using <code>:=</code> because it can make it unclear what variables are being used. That’s because it is very easy to accidentally shadow a variable when using <code>:=</code>. Remember, you can use <code>:=</code> to create and assign to multiple variables at once. Also, not all variables on the lefthand side have to be new for <code>:=</code> to be legal. You can use <code>:=</code> as long as there is at least one new variable on the lefthand side. Let’s look at another program (see <a data-type="xref" href="#EX3_2">Example 4-2</a>), which you can find on <a href="https://oreil.ly/U_m4B">The Go Playground</a> or in the <em>sample_code/shadow_multiple_assignment</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.</p>
<div id="EX3_2" data-type="example">
<h5><span class="label">Example 4-2. </span>Shadowing with multiple assignment</h5>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">x</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">10</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">x</code><code class="w"> </code><code class="p">&gt;</code><code class="w"> </code><code class="mi">5</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">x</code><code class="p">,</code><code class="w"> </code><code class="nx">y</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">5</code><code class="p">,</code><code class="w"> </code><code class="mi">20</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">,</code><code class="w"> </code><code class="nx">y</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Running this code gives you the following:</p>

<pre data-type="programlisting">5 20
10</pre>

<p>Although there was an existing definition of <code>x</code> in an outer block, <code>x</code> was still shadowed within the <code>if</code> statement. That’s because <code>:=</code> reuses only variables that are declared in the current block. When using <code>:=</code>, make sure that you don’t have any variables from an outer scope on the lefthand side unless you intend to shadow them.</p>

<p>You also need to be careful to ensure<a data-type="indexterm" data-primary="packages" data-secondary="import statement" data-tertiary="shadowing variables" id="id1097"/><a data-type="indexterm" data-primary="import keyword" data-secondary="shadowing variables" id="id1098"/> that you don’t shadow a package import. I’ll talk more about importing packages in <a data-type="xref" href="ch10.html#unique_chapter_id_10">Chapter 10</a>, but you’ve been importing the <code>fmt</code> package to print out results of our programs. Let’s see what happens when you declare a variable called <code>fmt</code> within your <code>main</code> function, as shown in <a data-type="xref" href="#EX3_3">Example 4-3</a>. You can try to run it on <a href="https://oreil.ly/CKQvm">The Go Playground</a> or in the <em>sample_code/shadow_package_names</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.</p>
<div id="EX3_3" data-type="example">
<h5><span class="label">Example 4-3. </span>Shadowing package names</h5>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">x</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">10</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="s">"oops"</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">fmt</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>When you try to run this code, you get an error:</p>

<pre data-type="programlisting">fmt.Println undefined (type string has no field or method Println)</pre>

<p>Notice that the problem isn’t that you named your variable <code>fmt</code>; it’s that you tried to access something that the local variable <code>fmt</code> didn’t have. Once the local variable <code>fmt</code> is declared, it shadows the package named <code>fmt</code> in the file block, making it impossible to use the <code>fmt</code> package for the rest of the <code>main</code> function.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id1099">
<h1>The Universe Block</h1>
<p>One more block<a data-type="indexterm" data-primary="blocks" data-secondary="universe block" id="id1100"/><a data-type="indexterm" data-primary="universe block" id="id1101"/> is a little weird: the universe block. Remember, Go is a small language with only 25 keywords. What’s interesting is that the built-in types (like <code>int</code> and <code>string</code>), constants (like <code>true</code> and <code>false</code>), and functions (like <code>make</code> or <code>close</code>) aren’t included in that list. Neither is <code>nil</code>. So, where are they?</p>

<p>Rather than make them keywords,<a data-type="indexterm" data-primary="keywords" data-secondary="predeclared identifiers versus" id="id1102"/><a data-type="indexterm" data-primary="predeclared types" data-secondary="keywords versus" id="id1103"/><a data-type="indexterm" data-primary="universe block" data-secondary="predeclared identifiers defined" id="id1104"/> Go considers these <em>predeclared identifiers</em> and defines them in the universe block, which is the block that contains all other blocks.</p>

<p>Because these names are declared in the universe block, they can be shadowed in other scopes. You can see this happen by running the code in <a data-type="xref" href="#EX3_4">Example 4-4</a> on <a href="https://oreil.ly/eoU2A">The Go Playground</a> or in the <em>sample_code/shadow_true</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.</p>
<div id="EX3_4" data-type="example">
<h5><span class="label">Example 4-4. </span>Shadowing <code>true</code></h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="kc">true</code><code class="p">)</code><code class="w"/>
<code class="kc">true</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">10</code><code class="w"/>
<code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="kc">true</code><code class="p">)</code><code class="w"/></pre></div>

<p>When you run it, you’ll see:</p>

<pre data-type="programlisting">true
10</pre>

<p><em>You must be very careful to never redefine any identifiers in the universe block</em>. If you<a data-type="indexterm" data-primary="troubleshooting" data-secondary="universe block predeclared identifiers" id="id1105"/> accidentally do so, you will get some strange behavior. If you are lucky, you’ll get compilation failures. If you are not, you’ll have a harder time tracking down the source of your problems.</p>
</div></aside>

<p>Since shadowing<a data-type="indexterm" data-primary="go commands" data-secondary="go vet" data-tertiary="shadowing not reported" id="id1106"/><a data-type="indexterm" data-primary="testing" data-secondary="go vet" data-tertiary="shadowing not reported" id="id1107"/> is useful in a few instances (later chapters will point them out), <code>go vet</code> does not report it as a likely error. In <a data-type="xref" href="ch11.html#code_quality">“Using Code-Quality Scanners”</a>, you’ll learn about third-party tools that can detect accidental shadowing in your code.<a data-type="indexterm" data-startref="ch04-shad" id="id1108"/><a data-type="indexterm" data-startref="ch04-shad2" id="id1109"/><a data-type="indexterm" data-startref="ch04-shad3" id="id1110"/><a data-type="indexterm" data-startref="ch04-shad4" id="id1111"/><a data-type="indexterm" data-startref="ch04-shad5" id="id1112"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="if   "><div class="sect1" id="id47">
<h1>if   </h1>

<p>The <code>if</code> statement in Go is much<a data-type="indexterm" data-primary="if keyword" id="id1113"/><a data-type="indexterm" data-primary="keywords" data-secondary="if" id="id1114"/><a data-type="indexterm" data-primary="else keyword" id="id1115"/><a data-type="indexterm" data-primary="keywords" data-secondary="else" id="id1116"/><a data-type="indexterm" data-primary="control structures" data-secondary="if/else if/else" id="id1117"/> like the <code>if</code> statement in most programming languages. Because it is such a familiar construct, I’ve used it in previous sample code without worrying that it’d be confusing. <a data-type="xref" href="#EX3_5">Example 4-5</a> shows a more complete sample.</p>
<div id="EX3_5" data-type="example">
<h5><span class="label">Example 4-5. </span><code>if</code> and <code>else</code></h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">n</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">rand</code><code class="p">.</code><code class="nx">Intn</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code><code class="w"/>
<code class="k">if</code><code class="w"> </code><code class="nx">n</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's too low"</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="w"> </code><code class="nx">n</code><code class="w"> </code><code class="p">&gt;</code><code class="w"> </code><code class="mi">5</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's too big:"</code><code class="p">,</code><code class="w"> </code><code class="nx">n</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's a good number:"</code><code class="p">,</code><code class="w"> </code><code class="nx">n</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>The most visible difference between <code>if</code> statements in Go and other languages is that you don’t put parentheses around the condition. But Go adds another feature to <code>if</code> statements that helps you better manage your variables.</p>

<p>As I discussed in <a data-type="xref" href="#shadowing">“Shadowing Variables”</a>, any variable declared within the braces of an <code>if</code> or <code>else</code> statement exists only within that block. This isn’t that uncommon; it is true in most languages. <a data-type="indexterm" data-primary="variables" data-secondary="declaration" data-tertiary="if and else block scope" id="id1118"/><a data-type="indexterm" data-primary="if keyword" data-secondary="variables scoped to if and else blocks" id="id1119"/><a data-type="indexterm" data-primary="else keyword" data-secondary="variables scoped to if and else blocks" id="id1120"/>What Go adds is the ability to declare variables that are scoped to the condition and to both the <code>if</code> and <code>else</code> blocks. Take a look at <a data-type="xref" href="#EX3_6">Example 4-6</a>, which rewrites our previous example to use this scope.</p>
<div id="EX3_6" data-type="example">
<h5><span class="label">Example 4-6. </span>Scoping a variable to an <code>if</code> statement</h5>

<pre data-type="programlisting" data-code-language="go"><code class="k">if</code><code class="w"> </code><code class="nx">n</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">rand</code><code class="p">.</code><code class="nx">Intn</code><code class="p">(</code><code class="mi">10</code><code class="p">);</code><code class="w"> </code><code class="nx">n</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's too low"</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="w"> </code><code class="nx">n</code><code class="w"> </code><code class="p">&gt;</code><code class="w"> </code><code class="mi">5</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's too big:"</code><code class="p">,</code><code class="w"> </code><code class="nx">n</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's a good number:"</code><code class="p">,</code><code class="w"> </code><code class="nx">n</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Having this special scope is handy. It lets you create variables that are available only where they are needed. Once the series of <code>if/else</code> statements ends, <code>n</code> is undefined. You can test this by trying to run the code in <a data-type="xref" href="#EX3_6-2">Example 4-7</a> on <a href="https://oreil.ly/rz671">The Go Playground</a> or in the <em>sample_code/if_bad_scope</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-startref="ix_dddd" id="id1121"/><a data-type="indexterm" data-startref="ix_ddd" id="id1122"/></p>
<div id="EX3_6-2" data-type="example">
<h5><span class="label">Example 4-7. </span>Out of scope…​</h5>

<pre data-type="programlisting" data-code-language="go"><code class="k">if</code><code class="w"> </code><code class="nx">n</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">rand</code><code class="p">.</code><code class="nx">Intn</code><code class="p">(</code><code class="mi">10</code><code class="p">);</code><code class="w"> </code><code class="nx">n</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's too low"</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="w"> </code><code class="nx">n</code><code class="w"> </code><code class="p">&gt;</code><code class="w"> </code><code class="mi">5</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's too big:"</code><code class="p">,</code><code class="w"> </code><code class="nx">n</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"That's a good number:"</code><code class="p">,</code><code class="w"> </code><code class="nx">n</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/>
<code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">n</code><code class="p">)</code><code class="w"/></pre></div>

<p>Attempting to run this code produces a compilation error:</p>

<pre data-type="programlisting">undefined: n</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Technically, you can put any <em>simple statement</em> before the comparison in an <code>if</code> statement—including a function call that doesn’t return a value or an assignment of a new value to an existing variable. But don’t do this. Use this feature only to define new variables that are scoped to the <code>if/else</code> statements; anything else would be confusing.</p>

<p>Also be aware that just like any other block, a variable declared as part of an <code>if</code> statement will shadow variables with the same name that are declared in containing blocks.</p>
</div>
</div></section>






<section data-type="sect1" data-pdf-bookmark="for, Four Ways"><div class="sect1" id="id48">
<h1>for, Four Ways</h1>

<p>As in other languages in the C family,<a data-type="indexterm" data-primary="for statement" id="ch04-for"/><a data-type="indexterm" data-primary="keywords" data-secondary="for" id="ch04-for2"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" id="ch04-for4"/><a data-type="indexterm" data-primary="for statement" data-secondary="about" id="id1123"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="about" id="id1124"/><a data-type="indexterm" data-primary="looping" data-see="for statement" id="id1125"/> Go uses a <code>for</code> statement to loop. What makes Go different from other languages is that <code>for</code> is the <em>only</em> looping keyword in the language. Go accomplishes this by using the <code>for</code> keyword in four formats:</p>

<ul>
<li>
<p>A complete, C-style <code>for</code></p>
</li>
<li>
<p>A condition-only <code>for</code></p>
</li>
<li>
<p>An infinite <code>for</code></p>
</li>
<li>
<p><code>for-range</code></p>
</li>
</ul>








<section data-type="sect2" data-pdf-bookmark="The Complete for Statement"><div class="sect2" id="id226">
<h2>The Complete for Statement</h2>

<p>The first <code>for</code> loop style is the<a data-type="indexterm" data-primary="for statement" data-secondary="complete for statement" id="id1126"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="complete for statement" id="id1127"/> complete <code>for</code> declaration you might be familiar with from C, Java, or JavaScript, as shown in <a data-type="xref" href="#EX3_8-1">Example 4-8</a>.</p>
<div id="EX3_8-1" data-type="example">
<h5><span class="label">Example 4-8. </span>A complete <code>for</code> statement</h5>

<pre data-type="programlisting" data-code-language="go"><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">10</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>You might be unsurprised to find that this program prints out the numbers from 0 to 9, inclusive.</p>

<p>Just like the <code>if</code> statement, the <code>for</code> statement does not use parentheses around its parts. Otherwise, it should look familiar. The <code>if</code> statement has three parts, separated by semicolons. The first part is an initialization that sets one or more variables before the loop begins. You should remember two important details about the initialization section. First, you <em>must</em> use <code>:=</code> to initialize the variables; <code>var</code> is <em>not</em> legal here. <a data-type="indexterm" data-primary="for statement" data-secondary="shadowing variables" id="id1128"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="shadowing variables" id="id1129"/>Second, just as variable declarations in <code>if</code> statements, you can shadow a variable here.</p>

<p>The second part is the comparison. This must be an expression that evaluates to a <code>bool</code>. It is checked immediately <em>before</em> each iteration of the loop. If the expression evaluates to <code>true</code>, the loop body is executed.</p>

<p>The last part of a standard <code>for</code> statement is the increment. You usually see something like <code>i{plus}{plus}</code> here, but any assignment is valid. It runs immediately after each iteration of the loop, before the condition is evaluated.</p>

<p>Go allows you to leave out one or more of the three parts of the <code>for</code> statement. Most commonly, you’ll either leave off the initialization if it is based on a value calculated before the loop:</p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">10</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>or you’ll leave off the increment because you have a more complicated increment rule inside the loop:</p>

<pre data-type="programlisting" data-code-language="go"><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">10</code><code class="p">;</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">%</code><code class="w"> </code><code class="mi">2</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">i</code><code class="o">++</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">i</code><code class="o">+=</code><code class="mi">2</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="The Condition-Only for Statement"><div class="sect2" id="id49">
<h2>The Condition-Only for Statement</h2>

<p>When you  leave off both the initialization<a data-type="indexterm" data-primary="for statement" data-secondary="condition-only for statement" id="id1130"/><a data-type="indexterm" data-primary="while via condition-only for loop" id="id1131"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="condition-only for statement" id="id1132"/> and the increment in a <code>for</code> statement, do not include the semicolons. (If you do, <code>go fmt</code> will remove them.) That leaves a <code>for</code> statement that functions like the <code>while</code> statement found in C, Java, JavaScript, Python, Ruby, and many other languages. It looks like <a data-type="xref" href="#EX3_9-1">Example 4-9</a>.</p>
<div id="EX3_9-1" data-type="example">
<h5><span class="label">Example 4-9. </span>A condition-only <code>for</code> statement</h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">1</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">100</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="nx">i</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="mi">2</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="The Infinite for Statement"><div class="sect2" id="id50">
<h2>The Infinite for Statement</h2>

<p>The third <code>for</code> statement format<a data-type="indexterm" data-primary="for statement" data-secondary="infinite for statement" id="id1133"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="infinite for statement" id="id1134"/> does away with the condition too. Go has a version of a <code>for</code> loop that loops forever. If you learned to program in the 1980s, your first program was probably an infinite loop in BASIC that printed <code>HELLO</code> to the screen forever:</p>

<pre data-type="programlisting" data-code-language="basic"><code class="nl">10</code><code class="w"> </code><code class="kr">PRINT</code><code class="w"> </code><code class="s2">"HELLO"</code>
<code class="nl">20</code><code class="w"> </code><code class="kr">GOTO</code><code class="w"> </code><code class="nl">10</code></pre>

<p><a data-type="xref" href="#EX3_10-2">Example 4-10</a> shows the Go version of this program. You can run it locally or try it out on <a href="https://oreil.ly/whOi-">The Go Playground</a> or in the <em>sample_code/infinite_for</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="id1135"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="id1136"/></p>
<div id="EX3_10-2" data-type="example">
<h5><span class="label">Example 4-10. </span>Infinite looping nostalgia</h5>

<pre data-type="programlisting" data-code-language="go"><code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="s">"fmt"</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Hello"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Running this program gives you the same output that filled the screens of millions of Commodore 64s and Apple ][s:</p>

<pre data-type="programlisting">Hello
Hello
Hello
Hello
Hello
Hello
Hello
...</pre>

<p>Press Ctrl-C when you are tired of walking down memory lane.<a data-type="indexterm" data-primary="Ctrl-C to stop execution" id="id1137"/></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you run <a data-type="xref" href="#EX3_10-2">Example 4-10</a> on The Go Playground, you’ll find that it will stop execution after a few seconds. As a shared resource, the playground doesn’t allow any one program to run for too long.</p>
</div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="break and continue"><div class="sect2" id="id51">
<h2>break and continue</h2>

<p>How do you get out of an infinite <code>for</code> loop without using the keyboard or turning off your computer? <a data-type="indexterm" data-primary="for statement" data-secondary="break statement" id="id1138"/><a data-type="indexterm" data-primary="keywords" data-secondary="break" data-tertiary="for statement" id="id1139"/><a data-type="indexterm" data-primary="break keyword" data-secondary="for statement" id="id1140"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="break statement" id="id1141"/>That’s the job of the <code>break</code> statement. It exits the loop immediately, just like the <code>break</code> statement in other languages. Of course, you can use <code>break</code> with any <code>for</code> statement, not just the infinite <code>for</code> statement.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Go has no equivalent of<a data-type="indexterm" data-primary="do loop via infinite for loop" id="id1142"/> the <code>do</code> keyword in Java, C, and JavaScript. If you want to iterate at least once, the cleanest way is to use an infinite <code>for</code> loop that ends with an <code>if</code> statement. If you have some Java code, for example, that uses a <code>do/while</code> loop:</p>

<pre data-type="programlisting" data-code-language="java"><code class="k">do</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="c1">// things to do in the loop</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">while</code><code class="w"> </code><code class="p">(</code><code class="n">CONDITION</code><code class="p">);</code><code class="w"/></pre>

<p>the Go version looks like this:</p>

<pre data-type="programlisting" data-code-language="go"><code class="k">for</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="c1">// things to do in the loop</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="p">!</code><code class="nx">CONDITION</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">break</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Note that the condition has a leading <code>!</code> to <em>negate</em> the condition from the Java code. The Go code is specifying how to <em>exit</em> the loop, while the Java code specifies how to stay in it.</p>
</div>

<p>Go also includes the <code>continue</code> keyword,<a data-type="indexterm" data-primary="for statement" data-secondary="continue statement" id="id1143"/><a data-type="indexterm" data-primary="continue keyword" id="id1144"/><a data-type="indexterm" data-primary="keywords" data-secondary="continue" id="id1145"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="continue statement" id="id1146"/> which skips over the rest of the <code>for</code> loop’s body and proceeds directly to the next iteration. Technically, you don’t need a 
<span class="keep-together"><code>continue</code></span> statement. You could write code like <a data-type="xref" href="#EX3_11-2">Example 4-11</a>.</p>
<div id="EX3_11-2" data-type="example">
<h5><span class="label">Example 4-11. </span>Confusing code</h5>

<pre data-type="programlisting" data-code-language="go"><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">1</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">&lt;=</code><code class="w"> </code><code class="mi">100</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">3</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">5</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"FizzBuzz"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Fizz"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">5</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Buzz"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>But this is not idiomatic. Go encourages short <code>if</code> statement bodies, as left-aligned as possible. Nested code is more difficult to follow. Using a <code>continue</code> statement makes it easier to understand what’s going on. <a data-type="xref" href="#EX3_12-2">Example 4-12</a> shows the code from the previous example, rewritten to use <code>continue</code> instead.</p>
<div id="EX3_12-2" data-type="example">
<h5><span class="label">Example 4-12. </span>Using <code>continue</code> to make code clearer</h5>

<pre data-type="programlisting" data-code-language="go"><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">1</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">&lt;=</code><code class="w"> </code><code class="mi">100</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">3</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="o">&amp;&amp;</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">5</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"FizzBuzz"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="k">continue</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">3</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Fizz"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="k">continue</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">5</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Buzz"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="k">continue</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>As you can see, replacing chains of <code>if/else</code> statements with a series of <code>if</code> statements that use <code>continue</code> makes the conditions line up. This improves the layout of your conditions, which means your code is easier to read and understand.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="The for-range Statement"><div class="sect2" id="for_range">
<h2>The for-range Statement</h2>

<p>The fourth <code>for</code> statement format<a data-type="indexterm" data-primary="for statement" data-secondary="for-range statement" id="ch04-rng"/><a data-type="indexterm" data-primary="range keyword" id="ch04-rng2"/><a data-type="indexterm" data-primary="keywords" data-secondary="range" id="ch04-rng3"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="for-range statement" id="ch04-rng4"/> is for iterating over elements in some of Go’s built-in types. It is called a <code>for-range</code> loop and resembles the iterators found in other languages. This section shows how to use a <code>for-range</code> loop with strings, arrays, slices, and maps. When I cover channels in <a data-type="xref" href="ch12.html#unique_chapter_id_12">Chapter 12</a>, I will talk about how to use them with <code>for-range</code> loops.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You can use a <code>for-range</code> loop only to iterate over the built-in compound types and user-defined types that are based on them.</p>
</div>

<p>First, let’s take a look at using a <code>for-range</code> loop with a slice. You can try out the code in <a data-type="xref" href="#EX4_13">Example 4-13</a> on <a href="https://oreil.ly/XwuTL">The Go Playground</a> or in the <code>forRangeKeyValue</code> function in <em>main.go</em> in the <em>sample_code/for_range</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ix_dddd2"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ix_dd123"/></p>
<div id="EX4_13" data-type="example">
<h5><span class="label">Example 4-13. </span>The <code>for-range</code> loop</h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">evenVals</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">{</code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">6</code><code class="p">,</code><code class="w"> </code><code class="mi">8</code><code class="p">,</code><code class="w"> </code><code class="mi">10</code><code class="p">,</code><code class="w"> </code><code class="mi">12</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">evenVals</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Running this code produces the following output:</p>

<pre data-type="programlisting">0 2
1 4
2 6
3 8
4 10
5 12</pre>

<p>What makes a <code>for-range</code> loop interesting is that you get two loop variables. The first variable is the position in the data structure being iterated, while the second is the value at that position. The idiomatic names for the two loop variables depend on what is being looped over. When looping over an array, slice, or string, an <code>i</code> for <em>index</em> is commonly used. When iterating through a map, <code>k</code> (for <em>key</em>) is used instead.</p>

<p>The second variable is frequently called <code>v</code> for <em>value</em>, but is sometimes given a name based on the type of the values being iterated. Of course, you can give the variables any names that you like. If the body of the loop contains only a few statements, single-letter variable names work well. For longer (or nested) loops, you’ll want to use more descriptive names.</p>

<p>What if you don’t need to use the first variable within your <code>for-range</code> loop? <a data-type="indexterm" data-primary="variables" data-secondary="unused" data-tertiary="underscore (_) for name" id="id1147"/><a data-type="indexterm" data-primary="for statement" data-secondary="for-range statement" data-tertiary="underscore (_) for unused variable name" id="id1148"/><a data-type="indexterm" data-primary="underscore (_)" data-secondary="unused variable and constant names" id="id1149"/><a data-type="indexterm" data-primary="_ (underscore)" data-secondary="unused variable and constant names" id="id1150"/>Remember, Go requires you to access all declared variables, and this rule applies to the ones declared as part of a <code>for</code> loop too. If you don’t need to access the key, use an underscore (<code>_</code>) as the variable’s name. This tells Go to ignore the value.</p>

<p>Let’s rewrite the slice ranging code to not print out the position. You can run the code in <a data-type="xref" href="#EX3_14">Example 4-14</a> on <a href="https://oreil.ly/2fO12">The Go Playground</a> or in the <code>forRangeIgnoreKey</code> function in <em>main.go</em> in the <em>sample_code/for_range</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.</p>
<div id="EX3_14" data-type="example" class="less_space pagebreak-before">
<h5><span class="label">Example 4-14. </span>Ignoring the slice index in a <code>for-range</code> loop</h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">evenVals</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">{</code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">6</code><code class="p">,</code><code class="w"> </code><code class="mi">8</code><code class="p">,</code><code class="w"> </code><code class="mi">10</code><code class="p">,</code><code class="w"> </code><code class="mi">12</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">evenVals</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">v</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Running this code produces the following output:</p>

<pre data-type="programlisting">2
4
6
8
10
12</pre>
<div data-type="tip"><h6>Tip</h6>
<p>Anytime you are in a situation where<a data-type="indexterm" data-primary="underscore (_)" data-secondary="return value ignored" id="id1151"/><a data-type="indexterm" data-primary="_ (underscore)" data-secondary="return value ignored" id="id1152"/><a data-type="indexterm" data-primary="return keyword" data-secondary="multiple return values" data-tertiary="ignoring returned values" id="id1153"/><a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="ignoring returned values" id="id1154"/><a data-type="indexterm" data-primary="return keyword" data-secondary="ignoring returned values" id="id1155"/> a value is returned, but you want to ignore it, use an underscore to hide the value. You’ll see the underscore pattern again when I talk about functions in <a data-type="xref" href="ch05.html#unique_chapter_id_05">Chapter 5</a> and packages in <a data-type="xref" href="ch10.html#unique_chapter_id_10">Chapter 10</a>.</p>
</div>

<p>What if you want the key but don’t want the value? In this situation, Go allows you to just leave off the second variable. This is valid Go code:</p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">uniqueNames</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="kd">map</code><code class="p">[</code><code class="kt">string</code><code class="p">]</code><code class="kt">bool</code><code class="p">{</code><code class="s">"Fred"</code><code class="p">:</code><code class="w"> </code><code class="kc">true</code><code class="p">,</code><code class="w"> </code><code class="s">"Raul"</code><code class="p">:</code><code class="w"> </code><code class="kc">true</code><code class="p">,</code><code class="w"> </code><code class="s">"Wilma"</code><code class="p">:</code><code class="w"> </code><code class="kc">true</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">k</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">uniqueNames</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">k</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>The most common reason for iterating over the key is when a map is being used as a set. In those situations, the value is unimportant. However, you can also leave off the value when iterating over arrays or slices. This is rare, as the usual reason for iterating over a linear data structure is to access the data. If you find yourself using this format for an array or slice, there’s an excellent chance that you have chosen the wrong data structure and should consider refactoring.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When you look at channels in <a data-type="xref" href="ch12.html#unique_chapter_id_12">Chapter 12</a>, you’ll see a situation where a <code>for-range</code> loop returns only a single value each time the loop iterates.</p>
</div>










<section data-type="sect3" data-pdf-bookmark="Iterating over maps"><div class="sect3" id="id53">
<h3>Iterating over maps</h3>

<p>There’s something interesting about<a data-type="indexterm" data-primary="for statement" data-secondary="for-range statement" data-tertiary="iterating over maps" id="id1156"/><a data-type="indexterm" data-primary="maps" data-secondary="for statement iterating over" id="id1157"/> how a <code>for-range</code> loop iterates over a map. You can run the code in <a data-type="xref" href="#example4_15">Example 4-15</a> on <a href="https://oreil.ly/VplnA">The Go Playground</a> or in the <em>sample_code/iterate_map</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-startref="ix_dd123" id="id1158"/></p>
<div id="example4_15" data-type="example">
<h5><span class="label">Example 4-15. </span>Map iteration order varies</h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">m</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="kd">map</code><code class="p">[</code><code class="kt">string</code><code class="p">]</code><code class="kt">int</code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="s">"a"</code><code class="p">:</code><code class="w"> </code><code class="mi">1</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="s">"c"</code><code class="p">:</code><code class="w"> </code><code class="mi">3</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="s">"b"</code><code class="p">:</code><code class="w"> </code><code class="mi">2</code><code class="p">,</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">3</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Loop"</code><code class="p">,</code><code class="w"> </code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">k</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">m</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">k</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>When you build and run this program, the output varies. Here is one possibility:</p>

<pre data-type="programlisting">Loop 0
c 3
b 2
a 1
Loop 1
a 1
c 3
b 2
Loop 2
b 2
a 1
c 3</pre>

<p>The order of the keys and values<a data-type="indexterm" data-primary="maps" data-secondary="hash map implementation" id="id1159"/> varies; some runs may be identical. This is actually a security feature. In earlier Go versions, the iteration order for keys in a map was usually (but not always) the same if you inserted the same items into a map. This caused two problems:</p>

<ul>
<li>
<p>People would write code that assumed that the order was fixed, and this code would break at weird times.</p>
</li>
<li>
<p>If maps always hash items to the exact same values, and you know that a server is storing user data in a map, you can slow down a server with an attack called <em>Hash DoS</em> by sending it specially crafted data with keys that all hash to the same bucket.</p>
</li>
</ul>

<p>To prevent both of these problems, the Go team made two changes to the map implementation. First, they modified the hash algorithm for maps to include a random number that’s generated every time a map variable is created. Next, they made the order of a <code>for-range</code> iteration over a map vary a bit each time the map is looped over. These two changes make it far harder to implement a Hash DoS attack.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This rule has one exception. To make it easier to debug and log maps, the formatting functions (like <code>fmt.Println</code>) always output maps with their keys in ascending sorted order.</p>
</div>
</div></section>










<section data-type="sect3" data-pdf-bookmark="Iterating over strings"><div class="sect3" id="id227">
<h3>Iterating over strings</h3>

<p>As I mentioned earlier, you can also<a data-type="indexterm" data-primary="for statement" data-secondary="for-range statement" data-tertiary="iterating over strings" id="id1160"/><a data-type="indexterm" data-primary="string type" data-secondary="for statements iterating over" id="id1161"/> use a string with a <code>for-range</code> loop. Let’s take a look. You can run the code in <a data-type="xref" href="#EX3_15">Example 4-16</a> on your computer or on <a href="https://oreil.ly/C3LRy">The Go Playground</a> or in the <em>sample_code/iterate_string</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ddd2"/></p>
<div id="EX3_15" data-type="example">
<h5><span class="label">Example 4-16. </span>Iterating over strings</h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">samples</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">string</code><code class="p">{</code><code class="s">"hello"</code><code class="p">,</code><code class="w"> </code><code class="s">"apple_π!"</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">sample</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">samples</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">r</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">sample</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">r</code><code class="p">,</code><code class="w"> </code><code class="nb">string</code><code class="p">(</code><code class="nx">r</code><code class="p">))</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">()</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>The output when the code iterates over the word “hello” has no surprises:</p>

<pre data-type="programlisting">0 104 h
1 101 e
2 108 l
3 108 l
4 111 o</pre>

<p>In the first column is the index; in the second, the numeric value of the letter; and in the third is the numeric value of the letter type converted to a string.</p>

<p>Looking at the result for “apple_π!” is more interesting:</p>

<pre data-type="programlisting">0 97 a
1 112 p
2 112 p
3 108 l
4 101 e
5 95 _
6 960 π
8 33 !</pre>

<p>Notice two things about this output. First, notice that the first column skips the number 7. Second, the value at position 6 is 960. That’s far larger than what can fit in a byte. But in <a data-type="xref" href="ch03.html#unique_chapter_id_03">Chapter 3</a>, you saw that strings were made out of bytes. What’s going on?</p>

<p>What you are seeing is special behavior from<a data-type="indexterm" data-primary="rune integer type" data-secondary="for statements iterating over strings" id="id1162"/><a data-type="indexterm" data-primary="types" data-secondary="rune integer type" data-tertiary="for statements iterating over strings" id="id1163"/><a data-type="indexterm" data-primary="byte for uint8" data-secondary="for statements iterating over strings" id="id1164"/><a data-type="indexterm" data-primary="types" data-secondary="byte for uint8" data-tertiary="for statements iterating over strings" id="id1165"/> iterating over a string with a <code>for-range</code> loop. It iterates over the <em>runes</em>, not the <em>bytes</em>. Whenever a <code>for-range</code> loop encounters a multibyte rune in a string, it converts the UTF-8 representation into a single 32-bit number and assigns it to the value. The offset is incremented by the number of bytes in the rune. If the <code>for-range</code> loop encounters a byte that doesn’t represent a valid UTF-8 value, the Unicode replacement character (hex value 0xfffd) is returned instead.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Use a <code>for-range</code> loop to access the runes in a string in order. The first variable holds the number of bytes from the beginning of the string, but the type of the second variable is rune.</p>
</div>
</div></section>










<section data-type="sect3" data-pdf-bookmark="The for-range value is a copy"><div class="sect3" id="for_range_copy">
<h3>The for-range value is a copy</h3>

<p>You should be aware that each<a data-type="indexterm" data-primary="for statement" data-secondary="for-range statement" data-tertiary="value variable as a copy" id="id1166"/> time the <code>for-range</code> loop iterates over your compound type, it <em>copies</em> the value from the compound type to the value variable. <em>Modifying the value variable will not modify the value in the compound type</em>. <a data-type="xref" href="#EX4_16">Example 4-17</a> shows a quick program to demonstrate this. You can try it out on <a href="https://oreil.ly/ShwR0">The Go Playground</a> or in the <code>forRangeIsACopy</code> function in <em>main.go</em> in the <em>sample_code/for_range</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.</p>
<div id="EX4_16" data-type="example">
<h5><span class="label">Example 4-17. </span>Modifying the value doesn’t modify the source</h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">evenVals</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">{</code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">6</code><code class="p">,</code><code class="w"> </code><code class="mi">8</code><code class="p">,</code><code class="w"> </code><code class="mi">10</code><code class="p">,</code><code class="w"> </code><code class="mi">12</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">evenVals</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">v</code><code class="w"> </code><code class="o">*=</code><code class="w"> </code><code class="mi">2</code><code class="w"/>
<code class="p">}</code><code class="w"/>
<code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">evenVals</code><code class="p">)</code><code class="w"/></pre></div>

<p>Running this code gives the following output:</p>

<pre data-type="programlisting">[2 4 6 8 10 12]</pre>

<p>In versions of Go before 1.22, the value variable is created once and is reused on each iteration through the <code>for</code> loop. Since Go 1.22, the default behavior is to create a new index and value variable on each iteration through the <code>for</code> loop. This change may not seem important, but it prevents a common bug.  When I talk about goroutines and <code>for-range</code> loops in <a data-type="xref" href="ch12.html#shared_var_goroutine">“Goroutines, for Loops, and Varying Variables”</a>, you’ll see that prior to Go 1.22, if you launched goroutines in a <code>for-range</code> loop, you needed to be careful in how you passed the index and value to the goroutines, or you’d get surprisingly wrong results.</p>

<p>Because this is a backward-breaking change (even if it is a change that eliminates a common bug), <a data-type="indexterm" data-primary="go.mod file" data-secondary="go directive" data-tertiary="for-range value as copy" id="id1167"/><a data-type="indexterm" data-primary="for statement" data-secondary="for-range statement" data-tertiary="value variable copy control" id="id1168"/>you can control whether to enable this behavior by specifying the Go version in the <code>go</code> directive in the <em>go.mod</em> file for your module. I talk about this in greater detail in <a data-type="xref" href="ch10.html#go_mod">“Using go.mod”</a>.</p>

<p>Just as with the other three forms of the <code>for</code> statement, you can use <code>break</code> and <code>continue</code> with a <code>for-range</code> loop.<a data-type="indexterm" data-startref="ch04-rng" id="id1169"/><a data-type="indexterm" data-startref="ch04-rng2" id="id1170"/><a data-type="indexterm" data-startref="ch04-rng3" id="id1171"/><a data-type="indexterm" data-startref="ch04-rng4" id="id1172"/></p>
</div></section>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Labeling Your for Statements"><div class="sect2" id="id55">
<h2>Labeling Your for Statements</h2>

<p>By default, the <code>break</code> and <code>continue</code> keywords<a data-type="indexterm" data-primary="for statement" data-secondary="labeling" id="id1173"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="labeling" id="id1174"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="nested" id="id1175"/><a data-type="indexterm" data-primary="for statement" data-secondary="nested" id="id1176"/> apply to the <code>for</code> loop that directly contains them. What if you have nested <code>for</code> loops and want to exit or skip over an iterator of an outer loop? Let’s look at an example. You’re going to modify the earlier string iterating program to stop iterating through a string as soon as it hits a letter “l.” You can run the code in <a data-type="xref" href="#EX3_17">Example 4-18</a> on <a href="https://oreil.ly/ToDkq">The Go Playground</a> or in the <em>sample_code/for_label</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-startref="ix_dddd2" id="id1177"/><a data-type="indexterm" data-startref="ix_ddd2" id="id1178"/></p>
<div id="EX3_17" data-type="example">
<h5><span class="label">Example 4-18. </span>Labels</h5>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">samples</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">string</code><code class="p">{</code><code class="s">"hello"</code><code class="p">,</code><code class="w"> </code><code class="s">"apple_π!"</code><code class="p">}</code><code class="w"/>
<code class="nx">outer</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">sample</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">samples</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">r</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">sample</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">r</code><code class="p">,</code><code class="w"> </code><code class="nb">string</code><code class="p">(</code><code class="nx">r</code><code class="p">))</code><code class="w"/>
<code class="w">            </code><code class="k">if</code><code class="w"> </code><code class="nx">r</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="sc">'l'</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">                </code><code class="k">continue</code><code class="w"> </code><code class="nx">outer</code><code class="w"/>
<code class="w">            </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Notice that the label <code>outer</code> is indented by <code>go fmt</code> to the same level as the surrounding function. Labels are always indented to the same level as the braces for the block. This makes them easier to notice. Running the program gives the following output:</p>

<pre data-type="programlisting">0 104 h
1 101 e
2 108 l
0 97 a
1 112 p
2 112 p
3 108 l</pre>

<p>Nested <code>for</code> loops with labels are rare. They are most commonly used to implement algorithms similar to the following pseudocode:</p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">outer</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">outerVal</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">outerValues</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">innerVal</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">outerVal</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="c1">// process innerVal</code><code class="w"/>
<code class="w">            </code><code class="k">if</code><code class="w"> </code><code class="nx">invalidSituation</code><code class="p">(</code><code class="nx">innerVal</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">                </code><code class="k">continue</code><code class="w"> </code><code class="nx">outer</code><code class="w"/>
<code class="w">            </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="c1">// here we have code that runs only when all of the</code><code class="w"/>
<code class="w">        </code><code class="c1">// innerVal values were successfully processed</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Choosing the Right for Statement"><div class="sect2" id="id56">
<h2>Choosing the Right for Statement</h2>

<p>Now that I’ve covered all forms<a data-type="indexterm" data-primary="for statement" data-secondary="choosing the right statement" id="id1179"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="choosing the right statement" id="id1180"/> of the <code>for</code> statement, you might be wondering when to use which format. Most of the time, you’re going to use the <code>for-range</code> format. A <code>for-range</code> loop is the best way to walk through a string, since it properly gives you back runes instead of bytes. You have also seen that a <code>for-range</code> loop works well for iterating through slices and maps, and you’ll see in <a data-type="xref" href="ch12.html#unique_chapter_id_12">Chapter 12</a> that channels work naturally with <code>for-range</code> as well.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Favor a <code>for-range</code> loop when iterating over all the contents of an instance of one of the built-in compound types. It avoids a great deal of boilerplate code that’s required when you use an array, slice, or map with one of the other <code>for</code> loop styles.</p>
</div>

<p>When should you use the complete <code>for</code> loop? The best place for it is when you aren’t iterating from the first element to the last element in a compound type. While you could use some combination of <code>if</code>, <code>continue</code>, and <code>break</code> within a <code>for-range</code> loop, a standard <code>for</code> loop is a clearer way to indicate the start and end of your iteration. Compare these two code snippets, both of which iterate over the second through the second-to-last elements in an array. First the <code>for-range</code> loop:</p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">evenVals</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">{</code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">6</code><code class="p">,</code><code class="w"> </code><code class="mi">8</code><code class="p">,</code><code class="w"> </code><code class="mi">10</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">evenVals</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">continue</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">evenVals</code><code class="p">)</code><code class="o">-</code><code class="mi">1</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">break</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>And here’s the same code, with a standard <code>for</code> loop:</p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">evenVals</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">{</code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">6</code><code class="p">,</code><code class="w"> </code><code class="mi">8</code><code class="p">,</code><code class="w"> </code><code class="mi">10</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">1</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">evenVals</code><code class="p">)</code><code class="o">-</code><code class="mi">1</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">evenVals</code><code class="p">[</code><code class="nx">i</code><code class="p">])</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p class="pagebreak-before">The standard <code>for</code> loop code is both shorter and easier to understand.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>This pattern does not work for skipping over the beginning of a string. Remember, a standard <code>for</code> loop doesn’t properly handle multibyte characters. If you want to skip over some of the runes in a string, you need to use a <code>for-range</code> loop so that it will properly process runes for you.</p>
</div>

<p>The remaining two <code>for</code> statement formats are used less frequently. The condition-only <code>for</code> loop is, like the <code>while</code> loop it replaces, useful when you are looping based on a calculated value.</p>

<p>The infinite <code>for</code> loop is useful in some situations. The body of the <code>for</code> loop should always contain a <code>break</code> or <code>return</code> because you’ll rarely want to loop forever. Real-world programs should bound iteration and fail gracefully when operations cannot be completed. As shown previously, an infinite <code>for</code> loop can be combined with an <code>if</code> statement to simulate the <code>do</code> statement that’s present in other languages. An infinite <code>for</code> loop is also used to implement some versions of the <em>iterator</em> pattern, which you will look at when I review the standard library in <a data-type="xref" href="ch13.html#io_friends">“io and Friends”</a>.<a data-type="indexterm" data-startref="ch04-for" id="id1181"/><a data-type="indexterm" data-startref="ch04-for2" id="id1182"/><a data-type="indexterm" data-startref="ch04-for4" id="id1183"/></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="switch"><div class="sect1" id="switch_statement">
<h1>switch</h1>

<p>Like many C-derived languages,<a data-type="indexterm" data-primary="control structures" data-secondary="switch statement" id="ch04-sw"/><a data-type="indexterm" data-primary="switch keyword" id="ch04-sw2"/><a data-type="indexterm" data-primary="keywords" data-secondary="switch" id="ch04-sw3"/><a data-type="indexterm" data-primary="case clause" id="ch04-sw4"/><a data-type="indexterm" data-primary="keywords" data-secondary="case" id="ch04-sw5"/><a data-type="indexterm" data-primary="keywords" data-secondary="default" id="ch04-sw6"/><a data-type="indexterm" data-primary="switch keyword" data-secondary="default" id="ch04-sw7"/><a data-type="indexterm" data-primary="default keyword" id="ch04-sw8"/><a data-type="indexterm" data-primary="switch keyword" data-secondary="case clause" id="ch04-sw9"/> Go has a <code>switch</code> statement. Most developers in those languages avoid <code>switch</code> statements because of their limitations on values that can be switched on and the default fall-through behavior. But Go is different. It makes <code>switch</code> statements useful.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>For those readers who are more familiar with Go, I’m going to cover <em>expression switch</em> statements in this chapter. I’ll discuss <em>type switch</em> statements when I talk about interfaces in <a data-type="xref" href="ch07.html#unique_chapter_id_07">Chapter 7</a>.</p>
</div>

<p>At first glance, <code>switch</code> statements in Go don’t look all that different from how they appear in C/C++, Java, or JavaScript, but there are a few surprises. Let’s take a look 
<span class="keep-together">at a</span> sample <code>switch</code> statement. You can run the code in <a data-type="xref" href="#EX3_18">Example 4-19</a> on <a href="https://oreil.ly/VKf4N">The Go Playground</a> or in the <code>basicSwitch</code> function in <code>main.go</code> in the <em>sample_code/switch</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="id1184"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="id1185"/></p>
<div id="EX3_18" data-type="example">
<h5><span class="label">Example 4-19. </span>The <code>switch</code> statement</h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">words</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">string</code><code class="p">{</code><code class="s">"a"</code><code class="p">,</code><code class="w"> </code><code class="s">"cow"</code><code class="p">,</code><code class="w"> </code><code class="s">"smile"</code><code class="p">,</code><code class="w"> </code><code class="s">"gopher"</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="s">"octopus"</code><code class="p">,</code><code class="w"> </code><code class="s">"anthropologist"</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">word</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">words</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">switch</code><code class="w"> </code><code class="nx">size</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">word</code><code class="p">);</code><code class="w"> </code><code class="nx">size</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">case</code><code class="w"> </code><code class="mi">1</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">3</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">word</code><code class="p">,</code><code class="w"> </code><code class="s">"is a short word!"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">case</code><code class="w"> </code><code class="mi">5</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">wordLen</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">word</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">word</code><code class="p">,</code><code class="w"> </code><code class="s">"is exactly the right length:"</code><code class="p">,</code><code class="w"> </code><code class="nx">wordLen</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">case</code><code class="w"> </code><code class="mi">6</code><code class="p">,</code><code class="w"> </code><code class="mi">7</code><code class="p">,</code><code class="w"> </code><code class="mi">8</code><code class="p">,</code><code class="w"> </code><code class="mi">9</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="k">default</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">word</code><code class="p">,</code><code class="w"> </code><code class="s">"is a long word!"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>When you run this code, you get the following output:</p>

<pre data-type="programlisting">a is a short word!
cow is a short word!
smile is exactly the right length: 5
anthropologist is a long word!</pre>

<p>I’ll go over the features of the <code>switch</code> statement to explain the output. As is the case with <code>if</code> statements, you don’t put parentheses around the value being compared in a <code>switch</code>. Also as if an <code>if</code> statement, you can declare a variable that’s scoped to all branches of the <code>switch</code> statement. In this case, you are scoping the variable <code>size</code> to all cases in the <code>switch</code> statement.</p>

<p>All <code>case</code> clauses (and the optional <code>default</code> clause) are contained inside a set of braces. But you should note that you don’t put braces around the contents of the <code>case</code> clauses. You can have multiple lines inside a <code>case</code> (or <code>default</code>) clause, and they are all considered to be part of the same block.</p>

<p>Inside <code>case 5:</code>, you declare <code>wordLen</code>, a new variable. Since this is a new block, you can declare new variables within it. Just like any other block, any variables declared within a <code>case</code> clause’s block are visible only within that block.</p>

<p>If you are used to putting a <code>break</code> statement at the end of every <code>case</code> in your <code>switch</code> statements, you’ll be happy to notice that they are gone. By default, cases in <code>switch</code> statements in Go don’t fall through. This is more in line with the behavior in Ruby or (if you are an old-school programmer) Pascal.</p>

<p>This prompts the question: if cases don’t fall through, what do you do if there are multiple values that should trigger the exact same logic? In Go, you separate multiple matches with commas, as you do when matching 1, 2, 3, and 4 or 6, 7, 8, and 9. That’s why you get the same output for both <code>a</code> and <code>cow</code>.</p>

<p>Which leads to the next question: if you don’t have fall-through, and you have an empty case (as you do in the sample program when the length of your argument is 6, 7, 8, or 9 characters), what happens? In Go, <em>an empty case means nothing happens</em>. That’s why you don’t see any output from your program when you use <em>octopus</em> or <em>gopher</em> as the parameter.</p>
<div data-type="tip"><h6>Tip</h6>
<p>For the sake of completeness,<a data-type="indexterm" data-primary="switch keyword" data-secondary="fallthrough keyword avoided" id="id1186"/><a data-type="indexterm" data-primary="fallthrough keyword avoided" id="id1187"/><a data-type="indexterm" data-primary="keywords" data-secondary="fallthrough avoided" id="id1188"/> Go does include a <code>fallthrough</code> keyword, which lets one case continue on to the next one. Please think twice before implementing an algorithm that uses it. If you find yourself needing to use <code>fallthrough</code>, try to restructure your logic to remove the dependencies between cases.</p>
</div>

<p>In the sample program, you are switching on the value of an integer, but that’s not all you can do. You can switch on any type that can be compared with <code>==</code>, which includes all built-in types except slices, maps, channels, functions, and structs that contain fields of these types.</p>

<p>Even though you don’t need to<a data-type="indexterm" data-primary="keywords" data-secondary="break" data-tertiary="switch statement" id="id1189"/><a data-type="indexterm" data-primary="switch keyword" data-secondary="break keyword" id="id1190"/><a data-type="indexterm" data-primary="break keyword" data-secondary="switch statement" id="id1191"/> put a <code>break</code> statement at the end of each <code>case</code> clause, you can use them when you want to exit early from a <code>case</code>. However, the need for a <code>break</code> statement might indicate that you are doing something too complicated. Consider refactoring your code to remove it.</p>

<p>There is one more place where you might find yourself using a <code>break</code> statement in a <code>case</code> in a <code>switch</code> statement. <a data-type="indexterm" data-primary="for statement" data-secondary="labeling" id="id1192"/><a data-type="indexterm" data-primary="control structures" data-secondary="for statement" data-tertiary="labeling" id="id1193"/>If you have a <code>switch</code> statement inside a <code>for</code> loop, and you want to break out of the <code>for</code> loop, put a label on the <code>for</code> statement and put the name of the label on the <code>break</code>. If you don’t use a label, Go assumes that you want to break out of the <code>case</code>. Let’s look at a quick example where you want to break out of the <code>for</code> loop once it reaches 7. You can run the code in <a data-type="xref" href="#EX3_19">Example 4-20</a> on <a href="https://oreil.ly/xH2Ij">The Go Playground</a> or in the <code>missingLabel</code> function in <em>main.go</em> in the <em>sample_code/switch</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ix_ddd123"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ix_d123"/></p>
<div id="EX3_19" data-type="example">
<h5><span class="label">Example 4-20. </span>The case of the missing label</h5>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">10</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">switch</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">case</code><code class="w"> </code><code class="mi">0</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">6</code><code class="p">:</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="s">"is even"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="k">case</code><code class="w"> </code><code class="mi">3</code><code class="p">:</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="s">"is divisible by 3 but not 2"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="k">case</code><code class="w"> </code><code class="mi">7</code><code class="p">:</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"exit the loop!"</code><code class="p">)</code><code class="w"/>
<code class="w">            </code><code class="k">break</code><code class="w"/>
<code class="w">        </code><code class="k">default</code><code class="p">:</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="s">"is boring"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Running this code produces the following output:</p>

<pre data-type="programlisting">0 is even
1 is boring
2 is even
3 is divisible by 3 but not 2
4 is even
5 is boring
6 is even
exit the loop!
8 is boring
9 is boring</pre>

<p>That’s not what is intended. The goal was to break out of the <code>for</code> loop when it got a 7, but the <code>break</code> was interpreted as exiting the <code>case</code>. To resolve this, you need to introduce a label, just as you did when breaking out of a nested <code>for</code> loop. First, you label the <code>for</code> statement:</p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">loop</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">10</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/></pre>

<p>Then you use the label on your break:</p>

<pre data-type="programlisting" data-code-language="go"><code class="k">break</code><code class="w"> </code><code class="nx">loop</code><code class="w"/></pre>

<p>You can see these changes on <a href="https://oreil.ly/PeaBI">The Go Playground</a> or in the <code>labeledBreak</code> function in <em>main.go</em> in the <em>sample_code/switch</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>. When you run it again, you get the expected output:<a data-type="indexterm" data-startref="ix_ddd123" id="id1194"/><a data-type="indexterm" data-startref="ix_d123" id="id1195"/><a data-type="indexterm" data-startref="ch04-sw" id="id1196"/><a data-type="indexterm" data-startref="ch04-sw2" id="id1197"/><a data-type="indexterm" data-startref="ch04-sw3" id="id1198"/><a data-type="indexterm" data-startref="ch04-sw4" id="id1199"/><a data-type="indexterm" data-startref="ch04-sw5" id="id1200"/><a data-type="indexterm" data-startref="ch04-sw6" id="id1201"/><a data-type="indexterm" data-startref="ch04-sw7" id="id1202"/><a data-type="indexterm" data-startref="ch04-sw8" id="id1203"/><a data-type="indexterm" data-startref="ch04-sw9" id="id1204"/></p>

<pre data-type="programlisting">0 is even
1 is boring
2 is even
3 is divisible by 3 but not 2
4 is even
5 is boring
6 is even
exit the loop!</pre>








<section data-type="sect2" data-pdf-bookmark="Blank Switches"><div class="sect2" id="id58">
<h2>Blank Switches</h2>

<p>You can<a data-type="indexterm" data-primary="control structures" data-secondary="switch statement" data-tertiary="blank switches" id="id1205"/><a data-type="indexterm" data-primary="switch keyword" data-secondary="blank switches" id="id1206"/><a data-type="indexterm" data-primary="blank switches" id="id1207"/> use <code>switch</code> statements in another, more powerful way. Just as Go allows you to leave out parts from a <code>for</code> statement’s declaration, you can write a <code>switch</code> statement that doesn’t specify the value that you’re comparing against. This is called a <em>blank switch</em>. A regular <code>switch</code> only allows you to check a value for equality. A blank <code>switch</code> allows you to use any boolean comparison for each <code>case</code>. You can try out the code in <a data-type="xref" href="#EX3_21">Example 4-21</a> on <a href="https://oreil.ly/v7qI5">The Go Playground</a> or in the <code>basicBlankSwitch</code> function in <em>main.go</em> in the <em>sample_code/blank_switch</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.</p>
<div id="EX3_21" data-type="example">
<h5><span class="label">Example 4-21. </span>The blank <code>switch</code></h5>

<pre data-type="programlisting" data-code-language="go"><code class="nx">words</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">string</code><code class="p">{</code><code class="s">"hi"</code><code class="p">,</code><code class="w"> </code><code class="s">"salutations"</code><code class="p">,</code><code class="w"> </code><code class="s">"hello"</code><code class="p">}</code><code class="w"/>
<code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">word</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">words</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">switch</code><code class="w"> </code><code class="nx">wordLen</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">word</code><code class="p">);</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">case</code><code class="w"> </code><code class="nx">wordLen</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">5</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">word</code><code class="p">,</code><code class="w"> </code><code class="s">"is a short word!"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">case</code><code class="w"> </code><code class="nx">wordLen</code><code class="w"> </code><code class="p">&gt;</code><code class="w"> </code><code class="mi">10</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">word</code><code class="p">,</code><code class="w"> </code><code class="s">"is a long word!"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">default</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">word</code><code class="p">,</code><code class="w"> </code><code class="s">"is exactly the right length."</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>When you run this program, you get the following output:</p>

<pre data-type="programlisting">hi is a short word!
salutations is a long word!
hello is exactly the right length.</pre>

<p>Just as with a regular <code>switch</code> statement, you can optionally include a short variable declaration as part of your blank <code>switch</code>. But unlike a regular <code>switch</code>, you can write logical tests for your cases. Blank switches are pretty cool, but don’t overdo them. If you find that you have written a blank <code>switch</code> where all your cases are equality comparisons against the same variable:</p>

<pre data-type="programlisting" data-code-language="go"><code class="k">switch</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="k">case</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">2</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is 2"</code><code class="p">)</code><code class="w"/>
<code class="k">case</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">3</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is 3"</code><code class="p">)</code><code class="w"/>
<code class="k">case</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">4</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is 4"</code><code class="p">)</code><code class="w"/>
<code class="k">default</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is "</code><code class="p">,</code><code class="w"> </code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>you should replace it with an expression <code>switch</code> statement:</p>

<pre data-type="programlisting" data-code-language="go"><code class="k">switch</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="k">case</code><code class="w"> </code><code class="mi">2</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is 2"</code><code class="p">)</code><code class="w"/>
<code class="k">case</code><code class="w"> </code><code class="mi">3</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is 3"</code><code class="p">)</code><code class="w"/>
<code class="k">case</code><code class="w"> </code><code class="mi">4</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is 4"</code><code class="p">)</code><code class="w"/>
<code class="k">default</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is "</code><code class="p">,</code><code class="w"> </code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Choosing Between if and switch"><div class="sect2" id="id228">
<h2>Choosing Between if and switch</h2>

<p>As a matter of functionality, there<a data-type="indexterm" data-primary="switch keyword" data-secondary="choosing between if and switch" id="id1208"/><a data-type="indexterm" data-primary="if keyword" data-secondary="choosing between switch and if" id="id1209"/><a data-type="indexterm" data-primary="control structures" data-secondary="choosing between if and switch" id="id1210"/> isn’t much difference between a series of <code>if/else</code> statements and a blank <code>switch</code> statement. Both allow a series of comparisons. So, when should you use <code>switch</code>, and when should you use a set of <code>if</code> or <code>if/else</code> statements? A <code>switch</code> statement, even a blank <code>switch</code>, indicates that a relationship exists between the values or comparisons in each case. To demonstrate the difference in clarity, rewrite the FizzBuzz program from <a data-type="xref" href="#EX3_11-2">Example 4-11</a> using a blank <code>switch</code>, 
<span class="keep-together">as shown</span> in <a data-type="xref" href="#EX3_22">Example 4-22</a>. You can also find this code in the <em>sample_code/simplest_fizzbuzz</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ix_ddd1234"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="ix_d123d"/></p>
<div id="EX3_22" data-type="example">
<h5><span class="label">Example 4-22. </span>Rewriting a series of <code>if</code> statements with a blank <code>switch</code></h5>

<pre data-type="programlisting" data-code-language="go"><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">1</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">&lt;=</code><code class="w"> </code><code class="mi">100</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">switch</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">case</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">3</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="o">&amp;&amp;</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">5</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"FizzBuzz"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">case</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">3</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Fizz"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">case</code><code class="w"> </code><code class="nx">i</code><code class="o">%</code><code class="mi">5</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Buzz"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">default</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Most people would agree that this is the most readable version. There’s no more need for <code>continue</code> statements, and the default behavior is made explicit with the <code>default</code> case.</p>

<p>Of course, nothing in Go prevents you from doing all sorts of unrelated comparisons on each <code>case</code> in a blank <code>switch</code>. However, this is not idiomatic. If you find yourself in a situation where you want to do this, use a series of <code>if/else</code> statements (or perhaps consider refactoring your code).</p>
<div data-type="tip"><h6>Tip</h6>
<p>Favor blank <code>switch</code> statements over <code>if/else</code> chains when you have multiple related cases. Using a <code>switch</code> makes the comparisons more visible and reinforces that they are a related set of concerns.</p>
</div>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="goto—Yes, goto"><div class="sect1" id="id59">
<h1>goto—Yes, goto</h1>

<p>Go has a fourth control statement,<a data-type="indexterm" data-primary="control structures" data-secondary="goto generally not used" id="ch04-goto"/><a data-type="indexterm" data-primary="goto keyword generally not used" id="ch04-goto2"/><a data-type="indexterm" data-primary="keywords" data-secondary="goto generally not used" id="ch04-goto3"/><a data-type="indexterm" data-primary="“Go To Statement Considered Harmful” (Dijkstra)" data-primary-sortas="Go To Statement Considered" id="id1211"/><a data-type="indexterm" data-primary="Dijkstra, Edsger" id="id1212"/> but chances are, you will never use it. Ever since Edsger Dijkstra wrote  <a href="https://oreil.ly/YK2tl">“Go To Statement Considered Harmful”</a> in 1968, the <code>goto</code> statement has been the black sheep of the coding family. There are good reasons for this. Traditionally, <code>goto</code> was dangerous because it could jump to nearly anywhere in a program; you could jump into or out of a loop, skip over variable definitions, or into the middle of a set of statements in an <code>if</code> statement. This made it difficult to understand what a <code>goto</code>-using program did.</p>

<p>Most modern languages don’t include <code>goto</code>. Yet Go has a <code>goto</code> statement. You should still do what you can to avoid using it, but it has some uses, and the limitations that Go places on it make it a better fit with structured programming.</p>

<p>In Go, a <code>goto</code> statement specifies a labeled line of code, and execution jumps to it. However, you can’t jump anywhere. Go forbids jumps that skip over variable declarations and jumps that go into an inner or parallel block.</p>

<p>The program in <a data-type="xref" href="#EX3_23">Example 4-23</a> shows two illegal <code>goto</code> statements. You can attempt to run it on <a href="https://oreil.ly/l016p">The Go Playground</a> or in the <em>sample_code/broken_goto</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-startref="ix_ddd1234" id="id1213"/><a data-type="indexterm" data-startref="ix_d123d" id="id1214"/></p>
<div id="EX3_23" data-type="example">
<h5><span class="label">Example 4-23. </span>Go’s <code>goto</code> has rules</h5>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">a</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">10</code><code class="w"/>
<code class="w">    </code><code class="k">goto</code><code class="w"> </code><code class="nx">skip</code><code class="w"/>
<code class="w">    </code><code class="nx">b</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">20</code><code class="w"/>
<code class="nx">skip</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">c</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">30</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">a</code><code class="p">,</code><code class="w"> </code><code class="nx">b</code><code class="p">,</code><code class="w"> </code><code class="nx">c</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">c</code><code class="w"> </code><code class="p">&gt;</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">goto</code><code class="w"> </code><code class="nx">inner</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="nx">b</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">inner</code><code class="p">:</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"a is less than b"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>Trying to run this program produces the following errors:</p>

<pre data-type="programlisting">goto skip jumps over declaration of b at ./main.go:8:4
goto inner jumps into block starting at ./main.go:15:11</pre>

<p>So what should you use <code>goto</code> for? Mostly, you shouldn’t. Labeled <code>break</code> and <code>continue</code> statements allow you to jump out of deeply nested loops or skip iteration. The program in <a data-type="xref" href="#EX3_24">Example 4-24</a> has a legal <code>goto</code> and demonstrates one of the few valid use cases. You can also find this code in the <em>sample_code/good_goto</em> directory in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.</p>
<div id="EX3_24" data-type="example">
<h5><span class="label">Example 4-24. </span>A reason to use <code>goto</code></h5>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">a</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">rand</code><code class="p">.</code><code class="nx">Intn</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">100</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nx">a</code><code class="o">%</code><code class="mi">5</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="k">goto</code><code class="w"> </code><code class="nx">done</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="nx">a</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">a</code><code class="o">*</code><code class="mi">2</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="mi">1</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"do something when the loop completes normally"</code><code class="p">)</code><code class="w"/>
<code class="nx">done</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"do complicated stuff no matter why we left the loop"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div>

<p>This example is contrived, but it shows how <code>goto</code> can make a program clearer. In this simple case, there is some logic that you don’t want to run in the middle of the function, but you do want to run at the end of the function. There are ways to do this without <code>goto</code>. You could set up a boolean flag or duplicate the complicated code after the <code>for</code> loop instead of having a <code>goto</code>, but both approaches have drawbacks. Littering your code with boolean flags to control the logic flow is arguably the same functionality as the <code>goto</code> statement, just more verbose. Duplicating complicated code is problematic because it makes your code harder to maintain. These situations are rare, but if you cannot find a way to restructure your logic, using a <code>goto</code> like this actually improves your code.</p>

<p>If you want to see a real-world example, you can take a look at the <code>floatBits</code> method in the file <em>atof.go</em> in the <code>strconv</code> package in the standard library. It’s too long to include in its entirety, but the method ends with this code:<a data-type="indexterm" data-primary="standard library" data-secondary="strconv package" id="id1215"/></p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">overflow</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="c1">// ±Inf</code><code class="w"/>
<code class="w">    </code><code class="nx">mant</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="mi">0</code><code class="w"/>
<code class="w">    </code><code class="nx">exp</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="mi">1</code><code class="o">&lt;&lt;</code><code class="nx">flt</code><code class="p">.</code><code class="nx">expbits</code><code class="w"> </code><code class="o">-</code><code class="w"> </code><code class="mi">1</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="nx">flt</code><code class="p">.</code><code class="nx">bias</code><code class="w"/>
<code class="w">    </code><code class="nx">overflow</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="kc">true</code><code class="w"/>

<code class="nx">out</code><code class="p">:</code><code class="w"/>
<code class="w">    </code><code class="c1">// Assemble bits.</code><code class="w"/>
<code class="w">    </code><code class="nx">bits</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">mant</code><code class="w"> </code><code class="o">&amp;</code><code class="w"> </code><code class="p">(</code><code class="nb">uint64</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="o">&lt;&lt;</code><code class="nx">flt</code><code class="p">.</code><code class="nx">mantbits</code><code class="w"> </code><code class="o">-</code><code class="w"> </code><code class="mi">1</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">bits</code><code class="w"> </code><code class="o">|=</code><code class="w"> </code><code class="nb">uint64</code><code class="p">((</code><code class="nx">exp</code><code class="o">-</code><code class="nx">flt</code><code class="p">.</code><code class="nx">bias</code><code class="p">)</code><code class="o">&amp;</code><code class="p">(</code><code class="mi">1</code><code class="o">&lt;&lt;</code><code class="nx">flt</code><code class="p">.</code><code class="nx">expbits</code><code class="o">-</code><code class="mi">1</code><code class="p">))</code><code class="w"> </code><code class="o">&lt;&lt;</code><code class="w"> </code><code class="nx">flt</code><code class="p">.</code><code class="nx">mantbits</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">d</code><code class="p">.</code><code class="nx">neg</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">bits</code><code class="w"> </code><code class="o">|=</code><code class="w"> </code><code class="mi">1</code><code class="w"> </code><code class="o">&lt;&lt;</code><code class="w"> </code><code class="nx">flt</code><code class="p">.</code><code class="nx">mantbits</code><code class="w"> </code><code class="o">&lt;&lt;</code><code class="w"> </code><code class="nx">flt</code><code class="p">.</code><code class="nx">expbits</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">bits</code><code class="p">,</code><code class="w"> </code><code class="nx">overflow</code><code class="w"/></pre>

<p>Before these lines, there are several condition checks. Some require the code after the <code>overflow</code> label to run, while other conditions require skipping that code and going directly to <code>out</code>. Depending on the condition, there are <code>goto</code> statements that jump to <code>overflow</code> or <code>out</code>. You could probably come up with a way to avoid the <code>goto</code> statements, but they all make the code harder to understand.</p>
<div data-type="tip"><h6>Tip</h6>
<p>You should try very hard to avoid using <code>goto</code>. But in the rare situations where it makes your code more readable, it is an option.<a data-type="indexterm" data-startref="ch04-goto" id="id1216"/><a data-type="indexterm" data-startref="ch04-goto2" id="id1217"/><a data-type="indexterm" data-startref="ch04-goto3" id="id1218"/></p>
</div>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Exercises"><div class="sect1" id="id279">
<h1>Exercises</h1>

<p>Now it’s time to apply everything you’ve learned about control structures and blocks in Go. You can find answers to these exercises in the <a href="https://oreil.ly/Fqw5B">Chapter 4 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="id1219"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 4" data-tertiary-sortas="ddd" id="id1220"/></p>
<ol>
<li>
<p>Write a <code>for</code> loop that puts 100 random numbers between 0 and 100 into an <code>int</code> slice.</p>
</li>
<li>
<p>Loop over the slice you created in exercise 1. For each value in the slice, apply the following rules:</p>
<ol>
<li>
<p>If the value is divisible by 2, print “Two!”</p>
</li>
<li>
<p>If the value is divisible by 3, print “Three!”</p>
</li>
<li>
<p>IIf the value is divisible by 2 and 3, print “Six!”. Don’t print anything else.</p>
</li>
<li>
<p>Otherwise, print “Never mind”.</p>
</li>

</ol>
</li>
<li>
<p>Start a new program. In <code>main</code>, declare an <code>int</code> variable called <code>total</code>. Write a <code>for</code> loop that uses a variable named <code>i</code> to iterate from 0 (inclusive) to 10 (exclusive). The body of the <code>for</code> loop should be as follows:</p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">total</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">total</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="nx">i</code><code class="w"/>
<code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">total</code><code class="p">)</code><code class="w"/></pre>

<p>After the <code>for</code> loop, print out the value of <code>total</code>.  What is printed out? What is the likely bug in this code?</p>
</li>

</ol>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Wrapping Up"><div class="sect1" id="id342">
<h1>Wrapping Up</h1>

<p>This chapter covered a lot of important topics for writing idiomatic Go. You’ve learned about blocks, shadowing, and control structures, and how to use them correctly. At this point, you’re able to write simple Go programs that fit within the <code>main</code> function. It’s time to move on to larger programs, using functions to organize your code.</p>
</div></section>
</div></section></div>
</div>
</body></html>