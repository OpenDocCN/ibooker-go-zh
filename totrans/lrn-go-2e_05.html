<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. Functions"><div class="chapter" id="unique_chapter_id_05">
<h1><span class="label">Chapter 5. </span>Functions</h1>


<p>So far, your programs have been limited to a few lines in the <code>main</code> function. It’s time to get bigger. In this chapter, you’re going to learn how to write functions in Go and see all the interesting things you can do with them.</p>






<section data-type="sect1" data-pdf-bookmark="Declaring and Calling Functions"><div class="sect1" id="id60">
<h1>Declaring and Calling Functions</h1>

<p>The basics of Go functions are familiar<a data-type="indexterm" data-primary="functions" data-secondary="declaring" id="id1221"/><a data-type="indexterm" data-primary="functions" data-secondary="calling" id="id1222"/><a data-type="indexterm" data-primary="parameters" data-secondary="functions declared and called" id="id1223"/> to anyone who has programmed in other languages with first-class functions, like C, Python, Ruby, or JavaScript. (Go also has methods, which I’ll cover in <a data-type="xref" href="ch07.html#unique_chapter_id_07">Chapter 7</a>.) Just as with control structures, Go adds its own twist on function features. Some are improvements, and others are experiments that should be avoided. I’ll cover both in this chapter.</p>

<p>You’ve already seen functions being declared and used. <a data-type="indexterm" data-primary="main package" data-secondary="main function" id="id1224"/><a data-type="indexterm" data-primary="functions" data-secondary="returning values" id="id1225"/><a data-type="indexterm" data-primary="func keyword" data-secondary="function declarations" id="id1226"/><a data-type="indexterm" data-primary="keywords" data-secondary="func" data-tertiary="function declarations" id="id1227"/><a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="return keyword" id="id1228"/><a data-type="indexterm" data-primary="return keyword" id="id1229"/><a data-type="indexterm" data-primary="keywords" data-secondary="return" id="id1230"/>Every Go program starts from a <code>main</code> function, and you’ve been calling the <code>fmt.Println</code> function to print to the screen. Since a <code>main</code> function doesn’t take in parameters or return values, let’s see what it looks like when a function does:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">div</code><code class="p">(</code><code class="nx">num</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="mi">0</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">num</code><code class="w"> </code><code class="o">/</code><code class="w"> </code><code class="nx">denom</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Let’s look at all the new things in this code sample. A function declaration has four parts: the keyword <code>func</code>, the name of the function, the input parameters, and the return type. The input parameters are listed in parentheses, separated by commas, with the parameter name first and the type second. Go is a typed language, so you must specify the types of the parameters. The return type is written between the input parameter’s closing parenthesis and the opening brace for the function body.</p>

<p>Just like other languages, Go has a <code>return</code> keyword for returning values from a function. If a function returns a value, you <em>must</em> supply a <code>return</code>. <a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="no return value" id="id1231"/><a data-type="indexterm" data-primary="return keyword" data-secondary="no return value" id="id1232"/>If a function returns nothing, a <code>return</code> statement is not needed at the end of the function. The <code>return</code> keyword is needed in a function that returns nothing only if you are exiting from the function before the last line.</p>

<p>The <code>main</code> function has<a data-type="indexterm" data-primary="parameters" data-secondary="functions declared and called" data-tertiary="no input parameters" id="id1233"/><a data-type="indexterm" data-primary="main package" data-secondary="main function" data-tertiary="no input parameters" id="id1234"/><a data-type="indexterm" data-primary="functions" data-secondary="calling" data-tertiary="no input parameters" id="id1235"/> no input parameters or return values. When a function has no input parameters, use empty parentheses (<code>()</code>). When a function returns nothing, you write nothing between the input parameter’s closing parenthesis and the opening brace for the function body:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">result</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">div</code><code class="p">(</code><code class="mi">5</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">result</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>The code for this simple program is in the <em>sample_code/simple_div</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="ix_eee123"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="ix_e123"/></p>

<p>Calling a function should be familiar to experienced developers. On the right side of the <code>:=</code>, you call the <code>div</code> function with the values 5 and 2. On the left side, you assign the returned value to the variable <code>result</code>.</p>
<div data-type="tip"><h6>Tip</h6>
<p>When you have two <a data-type="indexterm" data-primary="functions" data-secondary="calling" data-tertiary="consecutive input parameters of same type" id="id1236"/>or more consecutive input parameters of the same type, you can specify the type once for all of them like this:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">div</code><code class="p">(</code><code class="nx">num</code><code class="p">,</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/></pre>
</div>








<section data-type="sect2" data-pdf-bookmark="Simulating Named and Optional Parameters"><div class="sect2" id="id61">
<h2>Simulating Named and Optional Parameters</h2>

<p>Before getting to the unique function features that Go has, I’ll mention two that Go <em>doesn’t</em> have: named and optional input parameters. With one exception that I
will cover in the next section, <a data-type="indexterm" data-primary="functions" data-secondary="calling" data-tertiary="input parameters must be supplied" id="id1237"/><a data-type="indexterm" data-primary="parameters" data-secondary="functions declared and called" data-tertiary="input parameters must be supplied" id="id1238"/><a data-type="indexterm" data-primary="parameters" data-secondary="functions declared and called" data-tertiary="emulating named and optional parameters" id="id1239"/><a data-type="indexterm" data-primary="functions" data-secondary="calling" data-tertiary="emulating named and optional parameters" id="id1240"/><a data-type="indexterm" data-primary="structs" data-secondary="emulating named and optional parameters" id="id1241"/>you must supply all the parameters for a
function. If you want to emulate named and optional parameters, define a
struct that has fields that match the desired parameters, and pass the struct
to your function. <a data-type="xref" href="#EX5_1">Example 5-1</a> shows a snippet of code that demonstrates this pattern.</p>
<div id="EX5_1" data-type="example">
<h5><span class="label">Example 5-1. </span>Using a struct to simulate named parameters</h5>

<pre data-type="programlisting" data-code-language="go"><code class="kd">type</code><code class="w"> </code><code class="nx">MyFuncOpts</code><code class="w"> </code><code class="kd">struct</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">FirstName</code><code class="w"> </code><code class="kt">string</code><code class="w"/>
<code class="w">    </code><code class="nx">LastName</code><code class="w">  </code><code class="kt">string</code><code class="w"/>
<code class="w">    </code><code class="nx">Age</code><code class="w">       </code><code class="kt">int</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">MyFunc</code><code class="p">(</code><code class="nx">opts</code><code class="w"> </code><code class="nx">MyFuncOpts</code><code class="p">)</code><code class="w"> </code><code class="kt">error</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="c1">// do something here</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">MyFunc</code><code class="p">(</code><code class="nx">MyFuncOpts</code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">LastName</code><code class="p">:</code><code class="w"> </code><code class="s">"Patel"</code><code class="p">,</code><code class="w"/>
<code class="w">        </code><code class="nx">Age</code><code class="p">:</code><code class="w">      </code><code class="mi">50</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="p">})</code><code class="w"/>
<code class="w">    </code><code class="nx">MyFunc</code><code class="p">(</code><code class="nx">MyFuncOpts</code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">FirstName</code><code class="p">:</code><code class="w"> </code><code class="s">"Joe"</code><code class="p">,</code><code class="w"/>
<code class="w">        </code><code class="nx">LastName</code><code class="p">:</code><code class="w">  </code><code class="s">"Smith"</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="p">})</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>The code for this program is in the <em>sample_code/named_optional_parameters</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.<a data-type="indexterm" data-startref="ix_eee123" id="id1242"/><a data-type="indexterm" data-startref="ix_e123" id="id1243"/></p></div>

<p>In practice, not having named and optional parameters isn’t a limitation. A function shouldn’t have more than a few parameters, and named and optional parameters are mostly useful when a function has many inputs. If you find yourself in that situation, your function is quite possibly too complicated.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Variadic Input Parameters and Slices"><div class="sect2" id="vararg">
<h2>Variadic Input Parameters and Slices</h2>

<p>You’ve been using <code>fmt.Println</code> to print results<a data-type="indexterm" data-primary="functions" data-secondary="calling" data-tertiary="variadic input parameters" id="id1244"/><a data-type="indexterm" data-primary="parameters" data-secondary="functions declared and called" data-tertiary="variadic input parameters" id="id1245"/><a data-type="indexterm" data-primary="variadic input parameter (. . .)" id="id1246"/><a data-type="indexterm" data-primary=". . . operator" data-secondary="variadic input parameter" id="id1247"/> to the screen and you’ve probably noticed that it allows any number of input parameters. How does it do that? Like  many languages, Go supports <em>variadic parameters</em>. The variadic parameter <em>must</em> be the last (or only) parameter in the input parameter list. You indicate it with three dots (<code>...</code>) <em>before</em> the type. The variable that’s created within the function is a slice of the specified type. You use it just like any other slice. Let’s see how they work by writing a program that adds a base number to a variable number of parameters and returns the result as a slice of <code>int</code>. You can run this program on <a href="https://oreil.ly/nSad4">The Go Playground</a> or in the <em>sample_code/variadic</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>. First, write the variadic function:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">addTo</code><code class="p">(</code><code class="nx">base</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">vals</code><code class="w"> </code><code class="o">...</code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">out</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nb">make</code><code class="p">([]</code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="mi">0</code><code class="p">,</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">vals</code><code class="p">))</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">vals</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">out</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nb">append</code><code class="p">(</code><code class="nx">out</code><code class="p">,</code><code class="w"> </code><code class="nx">base</code><code class="o">+</code><code class="nx">v</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">out</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>And now call it in a few ways:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">addTo</code><code class="p">(</code><code class="mi">3</code><code class="p">))</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">addTo</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">))</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">addTo</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">6</code><code class="p">,</code><code class="w"> </code><code class="mi">8</code><code class="p">))</code><code class="w"/>
<code class="w">    </code><code class="nx">a</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">{</code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">3</code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">addTo</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code><code class="w"> </code><code class="nx">a</code><code class="o">...</code><code class="p">))</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">addTo</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">{</code><code class="mi">1</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">3</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">,</code><code class="w"> </code><code class="mi">5</code><code class="p">}</code><code class="o">...</code><code class="p">))</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>As you can see, you can supply however many values you want for the variadic parameter or no values at all. <a data-type="indexterm" data-primary="variadic input parameter (. . .)" data-secondary="slice as input" id="id1248"/><a data-type="indexterm" data-primary="slices" data-secondary="function input parameters" id="id1249"/>Since the variadic parameter is converted to a slice, you can supply a slice as the input. <a data-type="indexterm" data-primary="errors" data-secondary="compile-time errors" data-tertiary="variadic input parameter dot placement" id="id1250"/>However, you must put three dots (<code>...</code>) <em>after</em> the variable or slice literal. If you do not, it is a compile-time error.</p>

<p>When you build and run this program, you get this output:</p>

<pre data-type="programlisting">[]
[5]
[5 7 9 11]
[7 6]
[4 5 6 7 8]</pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Multiple Return Values"><div class="sect2" id="multiple_return">
<h2>Multiple Return Values</h2>

<p>The first difference that you’ll see between<a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="multiple return values" id="id1251"/><a data-type="indexterm" data-primary="return keyword" data-secondary="multiple return values" id="id1252"/> Go and other languages is that Go allows for multiple return values. Let’s add a small feature to the previous division program. You’re going to return both the dividend and the remainder from the function. Here’s the updated function:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">divAndRemainder</code><code class="p">(</code><code class="nx">num</code><code class="p">,</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">(</code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="kt">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="mi">0</code><code class="p">,</code><code class="w"> </code><code class="mi">0</code><code class="p">,</code><code class="w"> </code><code class="nx">errors</code><code class="p">.</code><code class="nx">New</code><code class="p">(</code><code class="s">"cannot divide by zero"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">num</code><code class="w"> </code><code class="o">/</code><code class="w"> </code><code class="nx">denom</code><code class="p">,</code><code class="w"> </code><code class="nx">num</code><code class="w"> </code><code class="o">%</code><code class="w"> </code><code class="nx">denom</code><code class="p">,</code><code class="w"> </code><code class="kc">nil</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>There are a few changes to support multiple return values. When a Go function returns multiple values, the types of the return values are listed in parentheses, separated by commas. Also, if a function returns multiple values, you must return all of them, separated by commas. <a data-type="indexterm" data-primary="return keyword" data-secondary="parentheses around returned values" id="id1253"/><a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="parentheses around returned values" id="id1254"/><a data-type="indexterm" data-primary="errors" data-secondary="compile-time errors" data-tertiary="parentheses around returned values" id="id1255"/>Don’t put parentheses around the returned values; that’s a compile-time error.</p>

<p>There’s something else that you haven’t seen yet: creating and returning an <code>error</code>. If you want to learn more about errors, skip ahead to <a data-type="xref" href="ch09.html#unique_chapter_id_09">Chapter 9</a>. <a data-type="indexterm" data-primary="return keyword" data-secondary="multiple return values" data-tertiary="errors returned" id="id1256"/><a data-type="indexterm" data-primary="errors" data-secondary="returning errors via return value" id="id1257"/><a data-type="indexterm" data-primary="nil" data-secondary="error return value when no error" id="id1258"/><a data-type="indexterm" data-primary="errors" data-secondary="returning errors via return value" data-tertiary="nil returned if no error" id="id1259"/><a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="errors" id="id1260"/>For now, you need to know only that you use Go’s multiple return value support to return an <code>error</code> if something goes wrong in a function. If the function completes successfully, you return <code>nil</code> for the error’s value. By convention, the <code>error</code> is always the last (or only) value returned from a function.</p>

<p>Calling the updated function looks like this:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">result</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">divAndRemainder</code><code class="p">(</code><code class="mi">5</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="nx">os</code><code class="p">.</code><code class="nx">Exit</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">result</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>The code for this program is in the <em>sample_code/updated_div</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="id1261"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="id1262"/></p>

<p>I talked about assigning multiple values at once in <a data-type="xref" href="ch02.html#var_declarations">“var Versus :=”</a>. Here you are using that feature to assign the results of a function call to three variables. On the right side of the <code>:=</code>, you call the <code>divAndRemainder</code> function with the values 5 and 2. On the left side, you assign the returned values to the variables <code>result</code>, <code>remainder</code>, and <code>err</code>. You check to see if there was an error by comparing <code>err</code> to <code>nil</code>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Multiple Return Values Are Multiple Values"><div class="sect2" id="id280">
<h2>Multiple Return Values Are Multiple Values</h2>

<p>If you are familiar with Python, you might think that multiple return values are like Python functions returning a tuple that’s optionally destructured if the tuple’s values are assigned to multiple variables. <a data-type="xref" href="#EX5_2">Example 5-2</a> shows some sample code run in the Python interpreter.</p>
<div id="EX5_2" data-type="example">
<h5><span class="label">Example 5-2. </span>Multiple return values in Python are destructured tuples</h5>

<pre data-type="programlisting" data-code-language="python"><code class="o">&gt;&gt;&gt;</code> <code class="k">def</code> <code class="nf">div_and_remainder</code><code class="p">(</code><code class="n">n</code><code class="p">,</code><code class="n">d</code><code class="p">):</code>
<code class="o">...</code>   <code class="k">if</code> <code class="n">d</code> <code class="o">==</code> <code class="mi">0</code><code class="p">:</code>
<code class="o">...</code>     <code class="k">raise</code> <code class="ne">Exception</code><code class="p">(</code><code class="s2">"cannot divide by zero"</code><code class="p">)</code>
<code class="o">...</code>   <code class="k">return</code> <code class="n">n</code> <code class="o">/</code> <code class="n">d</code><code class="p">,</code> <code class="n">n</code> <code class="o">%</code> <code class="n">d</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">v</code> <code class="o">=</code> <code class="n">div_and_remainder</code><code class="p">(</code><code class="mi">5</code><code class="p">,</code><code class="mi">2</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">v</code>
<code class="p">(</code><code class="mf">2.5</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">result</code><code class="p">,</code> <code class="n">remainder</code> <code class="o">=</code> <code class="n">div_and_remainder</code><code class="p">(</code><code class="mi">5</code><code class="p">,</code><code class="mi">2</code><code class="p">)</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">result</code>
<code class="mf">2.5</code>
<code class="o">&gt;&gt;&gt;</code> <code class="n">remainder</code>
<code class="mi">1</code></pre></div>

<p>In Python, you can assign all the values returned to a single variable or to multiple variables. <a data-type="indexterm" data-primary="return keyword" data-secondary="multiple return values" data-tertiary="multiple variables for" id="id1263"/><a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="multiple return values via multiple variables" id="id1264"/><a data-type="indexterm" data-primary="errors" data-secondary="compile-time errors" data-tertiary="multiple return values assigned to one variable" id="id1265"/>That’s not how Go works. You must assign each value returned from a function. If you try to assign multiple return values to one variable, you get a compile-time error.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Ignoring Returned Values"><div class="sect2" id="id230">
<h2>Ignoring Returned Values</h2>

<p>What if you call a function and<a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="ignoring returned values" id="id1266"/><a data-type="indexterm" data-primary="return keyword" data-secondary="multiple return values" data-tertiary="ignoring returned values" id="id1267"/><a data-type="indexterm" data-primary="underscore (_)" data-secondary="return value ignored" id="id1268"/><a data-type="indexterm" data-primary="_ (underscore)" data-secondary="return value ignored" id="id1269"/><a data-type="indexterm" data-primary="return keyword" data-secondary="ignoring returned values" id="id1270"/> don’t want to use all the returned values? As covered in <a data-type="xref" href="ch02.html#unused_vars_section">“Unused Variables”</a>, Go does not allow unused variables. If a function returns multiple values, but you don’t need to read one or more of the values, assign the unused values to the name <code>_</code>. For example, if you weren’t going to read 
<span class="keep-together"><code>remainder</code>,</span> you would write the assignment as <code>result, _, err :=</code> 
<span class="keep-together"><code>divAndRemainder(5, 2)</code>.</span></p>

<p>Surprisingly, Go does let you implicitly ignore <em>all</em> of the return values for a function. You can write <code>divAndRemainder(5,2)</code>, and the returned values are dropped. You have actually been doing this since the earliest examples: <code>fmt.Println</code> returns two values, but it is idiomatic to ignore them. In almost all other cases, you should make it explicit that you are ignoring return values by using underscores.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Use <code>_</code> whenever you don’t need to read a value that’s returned by a function.</p>
</div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Named Return Values"><div class="sect2" id="id231">
<h2>Named Return Values</h2>

<p>In addition to letting you return<a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="named return values" id="id1271"/><a data-type="indexterm" data-primary="return keyword" data-secondary="named return values" id="id1272"/> more than one value from a function, Go allows you to specify <em>names</em> for your return values. Rewrite the <code>divAndRemainder</code> function one more time, this time using named return values:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">divAndRemainder</code><code class="p">(</code><code class="nx">num</code><code class="p">,</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">(</code><code class="nx">result</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="kt">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">errors</code><code class="p">.</code><code class="nx">New</code><code class="p">(</code><code class="s">"cannot divide by zero"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="nx">result</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">result</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">num</code><code class="o">/</code><code class="nx">denom</code><code class="p">,</code><code class="w"> </code><code class="nx">num</code><code class="o">%</code><code class="nx">denom</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">result</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>When you supply names to your return values, what you are doing is predeclaring variables that you use within the function to hold the return values. They are written as a comma-separated list within parentheses. <em>You must surround named return values with parentheses, even if there is only a single return value</em>. Named return values are initialized to their zero values when created. This means that you can return them before any explicit use or assignment.</p>
<div data-type="tip"><h6>Tip</h6>
<p>If you want to name only <em>some</em> of the return values,<a data-type="indexterm" data-primary="underscore (_)" data-secondary="return value nameless among named" id="id1273"/><a data-type="indexterm" data-primary="_ (underscore)" data-secondary="return value nameless among named" id="id1274"/> you can do so by using <code>_</code> as the name for any return values you want to remain nameless.</p>
</div>

<p>One important thing to note: the name that’s used for a named returned value is local to the function; it doesn’t enforce any name outside of the function. It is perfectly legal to assign the return values to variables of different names:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">x</code><code class="p">,</code><code class="w"> </code><code class="nx">y</code><code class="p">,</code><code class="w"> </code><code class="nx">z</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">divAndRemainder</code><code class="p">(</code><code class="mi">5</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">,</code><code class="w"> </code><code class="nx">y</code><code class="p">,</code><code class="w"> </code><code class="nx">z</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>While named return values can sometimes help clarify your code, they do have some potential corner cases. First is the problem of shadowing. Just as with any other variable, you can shadow a named return value. Be sure that you are assigning to the return value and not to a shadow of it.</p>

<p>The other problem with named return values is that you don’t have to return them. Let’s take a look at another variation on <code>divAndRemainder</code>. You can run it on <a href="https://oreil.ly/FzUkw">The Go Playground</a> or in the <code>divAndRemainderConfusing</code> function in <em>main.go</em> in the <em>sample_code/named_div</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>:<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="id1275"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="id1276"/></p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">divAndRemainder</code><code class="p">(</code><code class="nx">num</code><code class="p">,</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">(</code><code class="nx">result</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="kt">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="c1">// assign some values</code><code class="w"/>
<code class="w">    </code><code class="nx">result</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="mi">20</code><code class="p">,</code><code class="w"> </code><code class="mi">30</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="mi">0</code><code class="p">,</code><code class="w"> </code><code class="mi">0</code><code class="p">,</code><code class="w"> </code><code class="nx">errors</code><code class="p">.</code><code class="nx">New</code><code class="p">(</code><code class="s">"cannot divide by zero"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">num</code><code class="w"> </code><code class="o">/</code><code class="w"> </code><code class="nx">denom</code><code class="p">,</code><code class="w"> </code><code class="nx">num</code><code class="w"> </code><code class="o">%</code><code class="w"> </code><code class="nx">denom</code><code class="p">,</code><code class="w"> </code><code class="kc">nil</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Notice that you assigned values to <code>result</code> and <code>remainder</code> and then returned different values directly. Before running this code, try to guess what happens when 5 and 2 are passed to this function. The result might surprise you:</p>

<pre data-type="programlisting">2 1</pre>

<p>The values from the <code>return</code> statement were returned even though they were never assigned to the named return parameters. That’s because the Go compiler inserts code that assigns whatever is returned to the return parameters. The named return parameters give a way to declare an <em>intent</em> to use variables to hold the return values, but don’t <em>require</em> you to use them.</p>

<p>Some developers like to use named return parameters because they provide additional documentation. However, I find them of limited value. Shadowing makes them confusing, as does simply ignoring them. Named return parameters are essential in one situation. I will talk about that when I cover <code>defer</code> later in the chapter.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Blank Returns—Never Use These!"><div class="sect2" id="id63">
<h2>Blank Returns—Never Use These!</h2>

<p>If you use named return values,<a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="blank returns never should be used" id="id1277"/><a data-type="indexterm" data-primary="return keyword" data-secondary="blank returns never should be used" id="id1278"/><a data-type="indexterm" data-primary="blank returns never should be used" id="id1279"/> you need to be aware of one severe misfeature in Go: blank (sometimes called <em>naked</em>) returns. If you have named return values, you can just write <code>return</code> without specifying the values that are returned. This returns the last values assigned to the named return values. Rewrite the <code>divAndRemainder</code> function one last time, this time using blank returns:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">divAndRemainder</code><code class="p">(</code><code class="nx">num</code><code class="p">,</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">(</code><code class="nx">result</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="kt">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">denom</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">errors</code><code class="p">.</code><code class="nx">New</code><code class="p">(</code><code class="s">"cannot divide by zero"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">result</code><code class="p">,</code><code class="w"> </code><code class="nx">remainder</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">num</code><code class="o">/</code><code class="nx">denom</code><code class="p">,</code><code class="w"> </code><code class="nx">num</code><code class="o">%</code><code class="nx">denom</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Using blank returns makes a few additional changes to the function. When there’s invalid input, the function returns immediately. Since no values were assigned to <code>result</code> and <code>remainder</code>, their zero values are returned. If you are returning the zero values for your named return values, be sure they make sense. Also note that you still have to put a <code>return</code> at the end of the function. Even though the function is using blank returns, this function returns values. Leaving out <code>return</code> is a compile-time error.</p>

<p>At first, you might find blank returns handy since they allow you to avoid some typing. However, most experienced Go developers consider blank returns a bad idea because they make it harder to understand data flow. Good software is clear and readable; it’s obvious what is happening. When you use a blank return, the reader of your code needs to scan back through the program to find the last value assigned to the return parameters to see what is actually being returned.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>If your function returns values, <em>never</em> use a blank return. It can make it very confusing to figure out what value is actually returned.</p>
</div>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Functions Are Values"><div class="sect1" id="id64">
<h1>Functions Are Values</h1>

<p>Just as in many other languages,<a data-type="indexterm" data-primary="functions" data-secondary="functions are values" id="ch05-val"/><a data-type="indexterm" data-primary="functions" data-secondary="functions are values" data-tertiary="signature of function" id="id1280"/><a data-type="indexterm" data-primary="signature of function" id="id1281"/> functions in Go are values. The type of a function is built out of the keyword <code>func</code> and the types of the parameters and return values. This combination is called the <em>signature</em> of the function. Any function that has the exact same number and types of parameters and return values meets the type <span class="keep-together">signature</span>.</p>

<p>Since functions are values, you can declare a function variable:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">var</code><code class="w"> </code><code class="nx">myFuncVariable</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="kt">string</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"/></pre>

<p class="pagebreak-before"><code>myFuncVariable</code> can be assigned any function that has a single parameter of type <code>string</code> and returns a single value of type <code>int</code>. Here’s a longer example:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">f1</code><code class="p">(</code><code class="nx">a</code><code class="w"> </code><code class="kt">string</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">f2</code><code class="p">(</code><code class="nx">a</code><code class="w"> </code><code class="kt">string</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">total</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">total</code><code class="w"> </code><code class="o">+=</code><code class="w"> </code><code class="nb">int</code><code class="p">(</code><code class="nx">v</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">total</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="kd">var</code><code class="w"> </code><code class="nx">myFuncVariable</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="kt">string</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"/>
<code class="w">    </code><code class="nx">myFuncVariable</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">f1</code><code class="w"/>
<code class="w">    </code><code class="nx">result</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">myFuncVariable</code><code class="p">(</code><code class="s">"Hello"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">result</code><code class="p">)</code><code class="w"/>

<code class="w">    </code><code class="nx">myFuncVariable</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">f2</code><code class="w"/>
<code class="w">    </code><code class="nx">result</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">myFuncVariable</code><code class="p">(</code><code class="s">"Hello"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">result</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>You can run this program on <a href="https://oreil.ly/lPj9X">The Go Playground</a> or in the <em>sample_code/func_value</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="id1282"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="id1283"/> The output is:</p>

<pre data-type="programlisting">5
500</pre>

<p>The default zero value for a<a data-type="indexterm" data-primary="zero value of unassigned variables" data-secondary="function variables as nil" id="id1284"/><a data-type="indexterm" data-primary="functions" data-secondary="functions are values" data-tertiary="zero value of function variable as nil" id="id1285"/><a data-type="indexterm" data-primary="panics" data-secondary="function variable of nil value running" id="id1286"/><a data-type="indexterm" data-primary="nil" data-secondary="function variable zero value" id="id1287"/> function variable is <code>nil</code>. Attempting to run a function variable with a <code>nil</code> value results in a panic (which is covered in <a data-type="xref" href="ch09.html#panic_recover">“panic and recover”</a>).</p>

<p>Having functions as values<a data-type="indexterm" data-primary="functions" data-secondary="functions are values" data-tertiary="calculator example code" id="id1288"/><a data-type="indexterm" data-primary="calculator example code" id="id1289"/> allows you to do some clever things, such as build a simple calculator using functions as values in a map. Let’s see how this works. The following code is available on <a href="https://oreil.ly/L59VY">The Go Playground</a> or in the <em>sample_code/calculator</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>. First, create a set of functions that all have the same signature:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">add</code><code class="p">(</code><code class="nx">i</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">sub</code><code class="p">(</code><code class="nx">i</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">-</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">mul</code><code class="p">(</code><code class="nx">i</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">div</code><code class="p">(</code><code class="nx">i</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">/</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/></pre>

<p class="pagebreak-before">Next, create a map to associate a math operator with each function:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">var</code><code class="w"> </code><code class="nx">opMap</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="kd">map</code><code class="p">[</code><code class="kt">string</code><code class="p">]</code><code class="kd">func</code><code class="p">(</code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="s">"+"</code><code class="p">:</code><code class="w"> </code><code class="nx">add</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="s">"-"</code><code class="p">:</code><code class="w"> </code><code class="nx">sub</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="s">"*"</code><code class="p">:</code><code class="w"> </code><code class="nx">mul</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="s">"/"</code><code class="p">:</code><code class="w"> </code><code class="nx">div</code><code class="p">,</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Finally, try out the calculator with a few expressions:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">expressions</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[][]</code><code class="kt">string</code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="p">{</code><code class="s">"2"</code><code class="p">,</code><code class="w"> </code><code class="s">"+"</code><code class="p">,</code><code class="w"> </code><code class="s">"3"</code><code class="p">},</code><code class="w"/>
<code class="w">        </code><code class="p">{</code><code class="s">"2"</code><code class="p">,</code><code class="w"> </code><code class="s">"-"</code><code class="p">,</code><code class="w"> </code><code class="s">"3"</code><code class="p">},</code><code class="w"/>
<code class="w">        </code><code class="p">{</code><code class="s">"2"</code><code class="p">,</code><code class="w"> </code><code class="s">"*"</code><code class="p">,</code><code class="w"> </code><code class="s">"3"</code><code class="p">},</code><code class="w"/>
<code class="w">        </code><code class="p">{</code><code class="s">"2"</code><code class="p">,</code><code class="w"> </code><code class="s">"/"</code><code class="p">,</code><code class="w"> </code><code class="s">"3"</code><code class="p">},</code><code class="w"/>
<code class="w">        </code><code class="p">{</code><code class="s">"2"</code><code class="p">,</code><code class="w"> </code><code class="s">"%"</code><code class="p">,</code><code class="w"> </code><code class="s">"3"</code><code class="p">},</code><code class="w"/>
<code class="w">        </code><code class="p">{</code><code class="s">"two"</code><code class="p">,</code><code class="w"> </code><code class="s">"+"</code><code class="p">,</code><code class="w"> </code><code class="s">"three"</code><code class="p">},</code><code class="w"/>
<code class="w">        </code><code class="p">{</code><code class="s">"5"</code><code class="p">},</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">expression</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">expressions</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">expression</code><code class="p">)</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="mi">3</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"invalid expression:"</code><code class="p">,</code><code class="w"> </code><code class="nx">expression</code><code class="p">)</code><code class="w"/>
<code class="w">            </code><code class="k">continue</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="nx">p1</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">strconv</code><code class="p">.</code><code class="nx">Atoi</code><code class="p">(</code><code class="nx">expression</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">            </code><code class="k">continue</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="nx">op</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">expression</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="w"/>
<code class="w">        </code><code class="nx">opFunc</code><code class="p">,</code><code class="w"> </code><code class="nx">ok</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">opMap</code><code class="p">[</code><code class="nx">op</code><code class="p">]</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="p">!</code><code class="nx">ok</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"unsupported operator:"</code><code class="p">,</code><code class="w"> </code><code class="nx">op</code><code class="p">)</code><code class="w"/>
<code class="w">            </code><code class="k">continue</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="nx">p2</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">strconv</code><code class="p">.</code><code class="nx">Atoi</code><code class="p">(</code><code class="nx">expression</code><code class="p">[</code><code class="mi">2</code><code class="p">])</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">            </code><code class="k">continue</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="nx">result</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">opFunc</code><code class="p">(</code><code class="nx">p1</code><code class="p">,</code><code class="w"> </code><code class="nx">p2</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">result</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>You’re using the <code>strconv.Atoi</code> function<a data-type="indexterm" data-primary="strconv package" data-secondary="strconv.Atoi" id="id1290"/><a data-type="indexterm" data-primary="standard library" data-secondary="strconv package" id="id1291"/> in the standard library to convert a <code>string</code> to an <code>int</code>. The second value returned by this function is an <code>error</code>. Just as before, you check for errors that are returned by functions and handle error conditions properly.</p>

<p class="pageberak-before">You use <code>op</code> as the key to the <code>opMap</code> map, and assign the value associated with the key to the variable <code>opFunc</code>. The type of <code>opFunc</code> is <code>func(int, int) int</code>. If there wasn’t a function in the map associated with the provided key, you print an error message and skip the rest of the loop. You then call the function assigned to the <code>opFunc</code> variable with the <code>p1</code> and <code>p2</code> variables that you decoded earlier. Calling a function in a variable looks just like calling a function directly.</p>

<p>When you run this program, you can see the simple calculator at work:</p>

<pre data-type="programlisting">5
-1
6
0
unsupported operator: %
strconv.Atoi: parsing "two": invalid syntax
invalid expression: [5]</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Don’t write fragile programs. <a data-type="indexterm" data-primary="errors" data-secondary="importance of error checking" id="id1292"/><a data-type="indexterm" data-primary="code" data-secondary="importance of error checking" id="id1293"/>The core logic for this example is relatively short. Of the 22 lines inside the <code>for</code> loop, 6 of them implement the actual algorithm, and the other 16 are for error checking and data validation. You might be tempted to not validate incoming data or check errors, but doing so produces unstable, unmaintainable code. Error handling is what separates the professionals from the amateurs.<a data-type="indexterm" data-startref="ch05-val" id="id1294"/></p>
</div>








<section data-type="sect2" data-pdf-bookmark="Function Type Declarations"><div class="sect2" id="id232">
<h2>Function Type Declarations</h2>

<p>Just as you can use the <code>type</code> keyword<a data-type="indexterm" data-primary="functions" data-secondary="type declarations" id="id1295"/><a data-type="indexterm" data-primary="type keyword" data-secondary="functions" id="id1296"/><a data-type="indexterm" data-primary="keywords" data-secondary="type" data-tertiary="functions" id="id1297"/> to define a <code>struct</code>, you can use it to define a function type too (I’ll go into more details on type declarations in <a data-type="xref" href="ch07.html#unique_chapter_id_07">Chapter 7</a>):</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">type</code><code class="w"> </code><code class="nx">opFuncType</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="kt">int</code><code class="p">,</code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"/></pre>

<p>You can then rewrite the <code>opMap</code> declaration to look like this:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">var</code><code class="w"> </code><code class="nx">opMap</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="kd">map</code><code class="p">[</code><code class="kt">string</code><code class="p">]</code><code class="nx">opFuncType</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="c1">// same as before</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>You don’t have to modify the functions at all. Any function that has two input parameters of type <code>int</code> and a single return value of type <code>int</code> automatically meets the type and can be assigned as a value in the map.</p>

<p>What’s the advantage of declaring a function type? One use is documentation. It’s useful to give something a name if you are going to refer to it multiple times. You will see another use in <a data-type="xref" href="ch07.html#function_type_interface">“Function Types Are a Bridge to Interfaces”</a>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Anonymous Functions"><div class="sect2" id="id65">
<h2>Anonymous Functions</h2>

<p>You can not only assign functions<a data-type="indexterm" data-primary="functions" data-secondary="anonymous functions" id="id1298"/><a data-type="indexterm" data-primary="anonymous functions" id="id1299"/><a data-type="indexterm" data-primary="functions" data-secondary="declaring" data-tertiary="new function within a function" id="id1300"/><a data-type="indexterm" data-primary="func keyword" data-secondary="new function within a function" id="id1301"/> to variables, but also define new functions within a function and assign them to variables. Here’s a program to demonstrate this, which you can run on <a href="https://oreil.ly/WPI6w">The Go Playground</a>. The code is also available in the <em>sample_code/anon_func</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>:<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="ix_eee1234"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="ix_ee1234"/></p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">f</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"printing"</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="p">,</code><code class="w"> </code><code class="s">"from inside of an anonymous function"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">5</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">f</code><code class="p">(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Inner functions are <em>anonymous</em>; they don’t have a name. You declare an anonymous function with the keyword <code>func</code> immediately followed by the input parameters, the return values, and the opening brace. <a data-type="indexterm" data-primary="errors" data-secondary="compile-time errors" data-tertiary="anonymous function name" id="id1302"/>It is a compile-time error to try to put a function name between <code>func</code> and the input parameters.</p>

<p>Just like any other function, <a data-type="indexterm" data-primary="functions" data-secondary="calling" data-tertiary="anonymous functions" id="id1303"/>an anonymous function is called by using parentheses. In this example, you are passing the <code>i</code> variable from the <code>for</code> loop in here. It is assigned to the <code>j</code> input parameter of the anonymous function.</p>

<p>The program gives the following output:</p>

<pre data-type="programlisting">printing 0 from inside of an anonymous function
printing 1 from inside of an anonymous function
printing 2 from inside of an anonymous function
printing 3 from inside of an anonymous function
printing 4 from inside of an anonymous function</pre>

<p>You don’t have to assign an anonymous function to a variable. You can write them inline and call them immediately. The previous program can be rewritten into this:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">5</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="kd">func</code><code class="p">(</code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"printing"</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="p">,</code><code class="w"> </code><code class="s">"from inside of an anonymous function"</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="p">}(</code><code class="nx">i</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>You can run this example on <a href="https://oreil.ly/EnkN6">The Go Playground</a> or in the <em>sample_code/anon_func</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.</p>

<p>Now, this is not something that you would normally do. If you are declaring and executing an anonymous function immediately, you might as well get rid of the anonymous function and just call the code. However, declaring anonymous functions without assigning them to variables is useful in two situations: <code>defer</code> statements and launching goroutines. I’ll talk about <code>defer</code> statements in a bit. 
<span class="keep-together">Goroutines</span> are covered in <a data-type="xref" href="ch12.html#unique_chapter_id_12">Chapter 12</a>.</p>

<p>Since you can declare variables<a data-type="indexterm" data-primary="package blocks" data-secondary="anonymous functions" id="id1304"/> at the package scope, you can also declare package scope variables that are assigned anonymous functions:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">var</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">    </code><code class="nx">add</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">sub</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">-</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">mul</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">div</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">/</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">x</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">add</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">3</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Unlike a normal function definition, you can assign a new value to a package-level anonymous function:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">x</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">add</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">3</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">changeAdd</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="nx">y</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">add</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">3</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">y</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">changeAdd</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">add</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Running this code gives the following output:</p>

<pre data-type="programlisting">5
8</pre>

<p>You can try this sample on <a href="https://oreil.ly/nK6Z9">The Go Playground</a>. The code is also in the <em>sample_code/package_level_anon</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.<a data-type="indexterm" data-startref="ix_eee1234" id="id1305"/><a data-type="indexterm" data-startref="ix_ee1234" id="id1306"/></p>

<p>Before using a package-level anonymous function, be very sure you need this capability. Package-level state should be immutable to make data flow easier to understand. If a function’s meaning changes while a program is running, it becomes difficult to understand not just how data flows, but how it is processed.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Closures"><div class="sect1" id="id66">
<h1>Closures</h1>

<p>Functions declared inside functions<a data-type="indexterm" data-primary="functions" data-secondary="closures" id="ch05-clos"/><a data-type="indexterm" data-primary="closures" id="ch05-clos2"/><a data-type="indexterm" data-primary="anonymous functions" data-secondary="as closures" id="ch05-clos3"/><a data-type="indexterm" data-primary="functions" data-secondary="anonymous functions" data-tertiary="as closures" id="ch05-clos4"/> are special; they are <em>closures</em>. This is a computer science word that means that functions declared inside functions are able to access and modify variables declared in the outer function. Let’s look at a quick example to see how this works. You can find the code on <a href="https://oreil.ly/6aILJ">The Go Playground</a>. The code is also in the <em>sample_code/closure</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">a</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">20</code><code class="w"/>
<code class="w">    </code><code class="nx">f</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="kd">func</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="nx">a</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="mi">30</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">f</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Running this program gives the following output:</p>

<pre data-type="programlisting">20
30</pre>

<p>The anonymous function assigned to <code>f</code> can read and write <code>a</code>, even though <code>a</code> is not passed in to the function.</p>

<p>Just as with any inner scope, you can shadow a variable inside a closure. If you change the code to:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">a</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">20</code><code class="w"/>
<code class="w">    </code><code class="nx">f</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="kd">func</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="nx">a</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">30</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">f</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>this will print out the following:</p>

<pre data-type="programlisting">20
30
20</pre>

<p>Using <code>:=</code> instead of <code>=</code> inside the closure creates a new <code>a</code> that ceases to exist when the closure exits. When working with inner functions, be careful to use the correct assignment operator, especially when multiple variables are on the lefthand side. You can try this code on <a href="https://oreil.ly/JXn8P">The Go Playground</a>. The code is also in the <em>sample_code/closure_shadow</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.</p>

<p>This inner function and closure stuff might not seem all that useful at first. What benefit do you get from making mini-functions within a larger function? Why does Go have this feature?</p>

<p>One thing that closures allow you to do is to limit a function’s scope. If a function is going to be called from only one other function, but it’s called multiple times, you can use an inner function to “hide” the called function. This reduces the number of declarations at the package level, which can make it easier to find an unused name.</p>

<p>If you have a piece of logic that is repeated multiple times within a function, a closure can be used to remove that repetition. I wrote a simple Lisp interpreter with a <code>Scan</code> function that processes an input string to find the parts of a Lisp program. It relies on two closures, <code>buildCurToken</code> and <code>update</code>, to make the code shorter and easier to understand. You can see it on <a href="https://oreil.ly/qanW3">GitHub</a>.</p>

<p>Closures really become interesting when they are passed to other functions or returned from a function. They allow you to take the variables within your function and use those values <em>outside</em> of your function.</p>








<section data-type="sect2" data-pdf-bookmark="Passing Functions as Parameters"><div class="sect2" id="func_param">
<h2>Passing Functions as Parameters</h2>

<p>Since functions are values and<a data-type="indexterm" data-primary="functions" data-secondary="passing functions as parameters" id="id1307"/><a data-type="indexterm" data-primary="functions" data-secondary="closures" data-tertiary="passing functions as parameters" id="id1308"/><a data-type="indexterm" data-primary="closures" data-secondary="passing functions as parameters" id="id1309"/><a data-type="indexterm" data-primary="parameters" data-secondary="passing functions as parameters" id="id1310"/> you can specify the type of a function using its parameter and return types, you can pass functions as parameters into functions. If you aren’t used to treating functions like data, you might need a moment to think about the implications of creating a closure that references local variables and then passing that closure to another function. It’s a very useful pattern that appears several times in the standard library.</p>

<p>One example is sorting slices.<a data-type="indexterm" data-primary="slices" data-secondary="sort.Slice" id="id1311"/><a data-type="indexterm" data-primary="sort.Slice" id="id1312"/><a data-type="indexterm" data-primary="standard library" data-secondary="sort package" id="id1313"/> The <code>sort</code> package in the standard library has a function called <code>sort.Slice</code>. It takes in any slice and a function that is used to sort the slice that’s passed in. Let’s see how it works by sorting a slice of a struct using two different fields.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The <code>sort.Slice</code> function predates the addition of generics to Go, so it does some internal magic to make it work with any kind of slice. I’ll talk about this magic more in <a data-type="xref" href="ch16.html#unique_chapter_id_16">Chapter 16</a>.</p>
</div>

<p>Let’s see how to use closures to sort the same data different ways. You can run this code on <a href="https://oreil.ly/deOHW">The Go Playground</a>. The code is also in the <em>sample_code/sort_sample</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="ix_eeee"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="ix_eee"/> First, define a simple type, a slice of values of that type, and print out the slice:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">type</code><code class="w"> </code><code class="nx">Person</code><code class="w"> </code><code class="kd">struct</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">FirstName</code><code class="w"> </code><code class="kt">string</code><code class="w"/>
<code class="w">    </code><code class="nx">LastName</code><code class="w">  </code><code class="kt">string</code><code class="w"/>
<code class="w">    </code><code class="nx">Age</code><code class="w">       </code><code class="kt">int</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="nx">people</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="nx">Person</code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="p">{</code><code class="s">"Pat"</code><code class="p">,</code><code class="w"> </code><code class="s">"Patterson"</code><code class="p">,</code><code class="w"> </code><code class="mi">37</code><code class="p">},</code><code class="w"/>
<code class="w">    </code><code class="p">{</code><code class="s">"Tracy"</code><code class="p">,</code><code class="w"> </code><code class="s">"Bobdaughter"</code><code class="p">,</code><code class="w"> </code><code class="mi">23</code><code class="p">},</code><code class="w"/>
<code class="w">    </code><code class="p">{</code><code class="s">"Fred"</code><code class="p">,</code><code class="w"> </code><code class="s">"Fredson"</code><code class="p">,</code><code class="w"> </code><code class="mi">18</code><code class="p">},</code><code class="w"/>
<code class="p">}</code><code class="w"/>
<code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">people</code><code class="p">)</code><code class="w"/></pre>

<p>Next, sort the slice by last name and print out the results:</p>

<pre data-type="programlisting" data-code-language="go"><code class="c1">// sort by last name</code><code class="w"/>
<code class="nx">sort</code><code class="p">.</code><code class="nx">Slice</code><code class="p">(</code><code class="nx">people</code><code class="p">,</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">bool</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">people</code><code class="p">[</code><code class="nx">i</code><code class="p">].</code><code class="nx">LastName</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="nx">people</code><code class="p">[</code><code class="nx">j</code><code class="p">].</code><code class="nx">LastName</code><code class="w"/>
<code class="p">})</code><code class="w"/>
<code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">people</code><code class="p">)</code><code class="w"/></pre>

<p>The closure that’s passed to <code>sort.Slice</code> has two parameters, <code>i</code> and <code>j</code>, but within the closure, <code>people</code> is used, so you can sort it by the <code>LastName</code> field.  In computer science terms, <code>people</code> is <em>captured</em> by the closure. Next you do the same, sorting by the <code>Age</code> field:</p>

<pre data-type="programlisting" data-code-language="go"><code class="c1">// sort by age</code><code class="w"/>
<code class="nx">sort</code><code class="p">.</code><code class="nx">Slice</code><code class="p">(</code><code class="nx">people</code><code class="p">,</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">j</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">bool</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">people</code><code class="p">[</code><code class="nx">i</code><code class="p">].</code><code class="nx">Age</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="nx">people</code><code class="p">[</code><code class="nx">j</code><code class="p">].</code><code class="nx">Age</code><code class="w"/>
<code class="p">})</code><code class="w"/>
<code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">people</code><code class="p">)</code><code class="w"/></pre>

<p>Running this code gives the following output:</p>

<pre data-type="programlisting">[{Pat Patterson 37} {Tracy Bobdaughter 23} {Fred Fredson 18}]
[{Tracy Bobdaughter 23} {Fred Fredson 18} {Pat Patterson 37}]
[{Fred Fredson 18} {Tracy Bobdaughter 23} {Pat Patterson 37}]</pre>

<p>The <code>people</code> slice is changed by the call to <code>sort.Slice</code>. I talk about this briefly in <a data-type="xref" href="#call_value">“Go Is Call by Value”</a> and in more detail in the next chapter.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Passing functions as parameters to other functions is often useful for performing different operations on the same kind of data.</p>
</div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Returning Functions from Functions"><div class="sect2" id="id68">
<h2>Returning Functions from Functions</h2>

<p>In addition to using a closure to pass<a data-type="indexterm" data-primary="functions" data-secondary="closures" data-tertiary="returning functions from functions" id="id1314"/><a data-type="indexterm" data-primary="closures" data-secondary="returning functions from functions" id="id1315"/><a data-type="indexterm" data-primary="return keyword" data-secondary="returning functions from functions" id="id1316"/><a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="returning functions from functions" id="id1317"/> some function state to another function, you can also return a closure from a function. Let’s demonstrate this by writing a function that returns a multiplier function. You can run this program on <a href="https://oreil.ly/8tpbN">The Go Playground</a>. The code is also in the <em>sample_code/makeMult</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>. Here is a function that returns a closure:</p>

<pre data-type="programlisting" data-code-language="go" class="less_space pagebreak-before"><code class="kd">func</code><code class="w"> </code><code class="nx">makeMult</code><code class="p">(</code><code class="nx">base</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">factor</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="nx">base</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="nx">factor</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>And here is how the function is used:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">twoBase</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">makeMult</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">threeBase</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">makeMult</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">3</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">twoBase</code><code class="p">(</code><code class="nx">i</code><code class="p">),</code><code class="w"> </code><code class="nx">threeBase</code><code class="p">(</code><code class="nx">i</code><code class="p">))</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p class="less_space">Running this program gives the following output:</p>

<pre data-type="programlisting">0 0
2 3
4 6</pre>

<p>Now that you’ve seen closures in action, you might wonder how often they are used by Go developers. It turns out that they are surprisingly useful. You saw how they are used to sort slices. A closure is also used to efficiently search a sorted slice with <code>sort.Search</code>. As for returning closures, you will see this pattern used when you build middleware for a web server in <a data-type="xref" href="ch13.html#middleware">“Middleware”</a>. Go also uses closures to implement resource cleanup, via the <code>defer</code> keyword.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you spend any time with programmers<a data-type="indexterm" data-primary="“higher-order functions” definition" data-primary-sortas="higher-order functions" id="id1318"/><a data-type="indexterm" data-primary="Haskell having higher-order functions" id="id1319"/><a data-type="indexterm" data-primary="functions" data-secondary="“higher-order functions” definition" data-secondary-sortas="higher-order functions" id="id1320"/> who use functional programming languages like Haskell, you might hear the term <em>higher-order functions</em>. That’s a fancy way to say that a function has a function for an input parameter or a return value. As a Go developer, you are as cool as they are!<a data-type="indexterm" data-startref="ch05-clos" id="id1321"/><a data-type="indexterm" data-startref="ch05-clos2" id="id1322"/><a data-type="indexterm" data-startref="ch05-clos3" id="id1323"/><a data-type="indexterm" data-startref="ch05-clos4" id="id1324"/></p>
</div>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="defer"><div class="sect1" id="id69">
<h1>defer</h1>

<p>Programs often create temporary resources,<a data-type="indexterm" data-primary="functions" data-secondary="defer" id="ch05-def"/><a data-type="indexterm" data-primary="defer keyword" id="ch05-def2"/><a data-type="indexterm" data-primary="keywords" data-secondary="defer" id="ch05-def3"/> like files or network connections, that need to be cleaned up. This cleanup has to happen, no matter how many exit points a function has, or whether a function completed successfully or not. In Go, the cleanup code is attached to the function with the <code>defer</code> keyword.</p>

<p>Let’s take a look at how to use <code>defer</code> to release resources. <a data-type="indexterm" data-primary="cat simplified example code" id="id1325"/>You’ll do this by writing a simple version of <code>cat</code>, the Unix utility for printing the contents of a file. You can’t pass in arguments on The Go Playground, but you can find the code for this example in the <em>sample_code/simple_cat</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>:<a data-type="indexterm" data-startref="ix_eeee" id="id1326"/><a data-type="indexterm" data-startref="ix_eee" id="id1327"/></p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">os</code><code class="p">.</code><code class="nx">Args</code><code class="p">)</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="mi">2</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="s">"no file specified"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">f</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">os</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="nx">os</code><code class="p">.</code><code class="nx">Args</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">defer</code><code class="w"> </code><code class="nx">f</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="nx">data</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nb">make</code><code class="p">([]</code><code class="kt">byte</code><code class="p">,</code><code class="w"> </code><code class="mi">2048</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">count</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">f</code><code class="p">.</code><code class="nx">Read</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="nx">os</code><code class="p">.</code><code class="nx">Stdout</code><code class="p">.</code><code class="nx">Write</code><code class="p">(</code><code class="nx">data</code><code class="p">[:</code><code class="nx">count</code><code class="p">])</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="nx">io</code><code class="p">.</code><code class="nx">EOF</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">                </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">            </code><code class="p">}</code><code class="w"/>
<code class="w">            </code><code class="k">break</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>This example introduces a few new features that I cover in more detail in later chapters. Feel free to read ahead to learn more.</p>

<p>First, you make sure that a filename<a data-type="indexterm" data-primary="os package" data-secondary="os.Args" id="id1328"/> was specified on the command line by checking the length of <code>os.Args</code>, a slice in the <code>os</code> package. The first value in <code>os.Args</code> is the name of the program. The remaining values are the arguments passed to the program. You check that the length of <code>os.Args</code> is at least 2 to determine whether the argument to the program was provided. If it wasn’t, use the <code>Fatal</code> function in the <code>log</code> package to print a message and exit the program. <a data-type="indexterm" data-primary="os package" data-secondary="os.Open" id="id1329"/>Next, you acquire a read-only file handle with the <code>Open</code> function in the <code>os</code> package. The second value that’s returned by <code>Open</code> is an error. If there’s a problem opening the file, you print the error message and exit the program. As mentioned earlier, I’ll talk about errors in <a data-type="xref" href="ch09.html#unique_chapter_id_09">Chapter 9</a>.</p>

<p>Once you know there is a valid file handle,<a data-type="indexterm" data-primary="Close method of file via defer" id="id1330"/> you need to close it after you use it, no matter how you exit the function. To ensure that the cleanup code runs, you use the <code>defer</code> keyword, followed by a function or method call. In this case, you use the <code>Close</code> method on the file variable. (I cover <code>at</code> methods in Go in <a data-type="xref" href="ch07.html#unique_chapter_id_07">Chapter 7</a>.) Normally, a function call runs immediately, but <code>defer</code> delays the invocation until the surrounding function exits.</p>

<p>You read from a file handle<a data-type="indexterm" data-primary="Read method of file" id="id1331"/> by passing a slice of bytes into the <code>Read</code> method on a file variable. I’ll cover how to use this method in detail in <a data-type="xref" href="ch13.html#io_friends">“io and Friends”</a>, but <code>Read</code> returns the number of bytes that were read into the slice and an error. If an error occurs, you check whether it’s an end-of-file marker. If you are at the end of the file, you use <code>break</code> to exit the <code>for</code> loop. For all other errors, you report it and exit immediately, using <code>log.Fatal</code>. I’ll talk a little more about slices and function parameters in <a data-type="xref" href="#call_value">“Go Is Call by Value”</a> and go into details on this pattern when I discuss pointers in the next chapter.</p>

<p>Building and running the program from within the <em>simple_cat</em> directory produces the following result:</p>
<pre data-type="programlisting">
$ <strong>go build</strong>
$ <strong>./simple_cat simple_cat.go</strong>
package main

import (
    "io"
    "log"
    "os"
)
...
</pre>

<p>You should know a few more things about <code>defer</code>. <a data-type="indexterm" data-primary="defer keyword" data-secondary="function, method, or closure with" id="id1332"/>First, you can use a function, method, or closure with <code>defer</code>. (When I mention functions with <code>defer</code>, mentally expand that to “functions, methods, or closures.”)</p>

<p>You can <code>defer</code> multiple functions<a data-type="indexterm" data-primary="defer keyword" data-secondary="function, method, or closure with" data-tertiary="multiple functions" id="id1333"/> in a Go function. They run in last-in, first-out (LIFO) order; the last <code>defer</code> registered runs first.</p>

<p>The code within <code>defer</code> functions<a data-type="indexterm" data-primary="return keyword" data-secondary="defer functions running after" id="id1334"/> runs <em>after</em> the return statement. As I mentioned, you can supply a function with input parameters to a <code>defer</code>. The input parameters are evaluated immediately and their values are stored until the function runs.</p>

<p>Here’s a quick example that demonstrates both of these features of <code>defer</code>:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">deferExample</code><code class="p">()</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">a</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">10</code><code class="w"/>
<code class="w">    </code><code class="k">defer</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">val</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"first:"</code><code class="p">,</code><code class="w"> </code><code class="nx">val</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">a</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="mi">20</code><code class="w"/>
<code class="w">    </code><code class="k">defer</code><code class="w"> </code><code class="kd">func</code><code class="p">(</code><code class="nx">val</code><code class="w"> </code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"second:"</code><code class="p">,</code><code class="w"> </code><code class="nx">val</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}(</code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">a</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="mi">30</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"exiting:"</code><code class="p">,</code><code class="w"> </code><code class="nx">a</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">a</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Running this code gives the following output:</p>

<pre data-type="programlisting">exiting: 30
second: 20
first: 10</pre>

<p>You can run this on <a href="https://oreil.ly/SgAcq">The Go Playground</a>. It is also available in the <em>sam⁠ple​_code/defer_example</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="id1335"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="id1336"/></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You can supply a function that returns<a data-type="indexterm" data-primary="defer keyword" data-secondary="returned values cannot be read" id="id1337"/> values to a <code>defer</code>, but there’s no way to read those values:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">example</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">defer</code><code class="w"> </code><code class="kd">func</code><code class="p">()</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="mi">2</code><code class="w"> </code><code class="c1">// there's no way to read this value</code><code class="w"/>
<code class="w">    </code><code class="p">}()</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
</div>

<p>You might be wondering whether there’s a way<a data-type="indexterm" data-primary="defer keyword" data-secondary="named return values" id="id1338"/><a data-type="indexterm" data-primary="errors" data-secondary="actions taken on returned error via defer" id="id1339"/><a data-type="indexterm" data-primary="errors" data-secondary="returning errors via return value" data-tertiary="actions taken via defer" id="id1340"/><a data-type="indexterm" data-primary="defer keyword" data-secondary="actions taken on returned error" id="id1341"/><a data-type="indexterm" data-primary="return keyword" data-secondary="named return values" data-tertiary="defer using" id="id1342"/><a data-type="indexterm" data-primary="functions" data-secondary="returning values" data-tertiary="named return values used by defer" id="id1343"/> for a deferred function to examine or modify the return values of its surrounding function. There is, and it’s the best reason to use named return values. It allows your code to take actions based on an error. When I talk about errors in <a data-type="xref" href="ch09.html#unique_chapter_id_09">Chapter 9</a>, I will discuss a pattern that uses <code>defer</code> to add contextual information to an error returned from a function. Let’s look at a way to handle database transaction cleanup using named return values and <code>defer</code>:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">DoSomeInserts</code><code class="p">(</code><code class="nx">ctx</code><code class="w"> </code><code class="nx">context</code><code class="p">.</code><code class="nx">Context</code><code class="p">,</code><code class="w"> </code><code class="nx">db</code><code class="w"> </code><code class="o">*</code><code class="nx">sql</code><code class="p">.</code><code class="nx">DB</code><code class="p">,</code><code class="w"> </code><code class="nx">value1</code><code class="p">,</code><code class="w"> </code><code class="nx">value2</code><code class="w"> </code><code class="kt">string</code><code class="p">)</code><code class="w"/>
<code class="w">                  </code><code class="p">(</code><code class="nx">err</code><code class="w"> </code><code class="kt">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">tx</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">BeginTx</code><code class="p">(</code><code class="nx">ctx</code><code class="p">,</code><code class="w"> </code><code class="kc">nil</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="nx">err</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">defer</code><code class="w"> </code><code class="kd">func</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">tx</code><code class="p">.</code><code class="nx">Commit</code><code class="p">()</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="nx">tx</code><code class="p">.</code><code class="nx">Rollback</code><code class="p">()</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="p">}()</code><code class="w"/>
<code class="w">    </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">tx</code><code class="p">.</code><code class="nx">ExecContext</code><code class="p">(</code><code class="nx">ctx</code><code class="p">,</code><code class="w"> </code><code class="s">"INSERT INTO FOO (val) values $1"</code><code class="p">,</code><code class="w"> </code><code class="nx">value1</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="nx">err</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="c1">// use tx to do more database inserts here</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="kc">nil</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>I’m not going to cover Go’s <a data-type="indexterm" data-primary="database/sql/driver package" data-secondary="database support" id="id1344"/><a data-type="indexterm" data-primary="standard library" data-secondary="database/sql/driver package" id="id1345"/>database support in this book, but the standard library includes extensive support for databases in the <code>database/sql</code> package. In the example function, you create a transaction to do a series of database inserts. If any of them fails, you want to roll back (not modify the database). If all of them succeed, you want to commit (store the database changes). You use a closure with <code>defer</code> to check whether <code>err</code> has been assigned a value. If it hasn’t, you run <code>tx.Commit</code>, which could also return an error. If it does, the value <code>err</code> is modified. If any database interaction returned an error, you call <code>tx.Rollback</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>New Go developers tend to forget<a data-type="indexterm" data-primary="errors" data-secondary="compile-time errors" data-tertiary="defer function parentheses" id="id1346"/> the set of parentheses after the braces when specifying a function for <code>defer</code>. It is a compile-time error to leave them out, and eventually the habit sets in. It helps to remember that supplying parentheses allows you to specify values that will be passed into the function when it runs.</p>
</div>

<p>A common pattern in Go is for a function that allocates a resource to also return a closure that cleans up the resource. <a data-type="indexterm" data-primary="cat simplified example code" id="id1347"/>In the <em>sample_code/simple_cat_cancel</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>,<a data-type="indexterm" data-primary="book supplemental material URL" data-secondary="code repository" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="ix_eeee2"/><a data-type="indexterm" data-primary="resources online" data-secondary="book supplemental material" data-tertiary="Chapter 5" data-tertiary-sortas="eee" id="ix_eee2"/> there is a rewrite of the simple <code>cat</code> program that does this. First you write a helper function that opens a file and returns a closure:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">getFile</code><code class="p">(</code><code class="nx">name</code><code class="w"> </code><code class="kt">string</code><code class="p">)</code><code class="w"> </code><code class="p">(</code><code class="o">*</code><code class="nx">os</code><code class="p">.</code><code class="nx">File</code><code class="p">,</code><code class="w"> </code><code class="kd">func</code><code class="p">(),</code><code class="w"> </code><code class="kt">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">file</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">os</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="nx">name</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="kc">nil</code><code class="p">,</code><code class="w"> </code><code class="kc">nil</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">file</code><code class="p">,</code><code class="w"> </code><code class="kd">func</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">file</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="p">},</code><code class="w"> </code><code class="kc">nil</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>The helper function returns a file, a function, and an error. That <code>*</code> means that a file reference in Go is a pointer. I’ll talk more about that in the next chapter.</p>

<p>Now in <code>main</code>, you use the <code>getFile</code> function:</p>

<pre data-type="programlisting" data-code-language="go"><code class="nx">f</code><code class="p">,</code><code class="w"> </code><code class="nx">closer</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">getFile</code><code class="p">(</code><code class="nx">os</code><code class="p">.</code><code class="nx">Args</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code><code class="w"/>
<code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/>
<code class="k">defer</code><code class="w"> </code><code class="nx">closer</code><code class="p">()</code><code class="w"/></pre>

<p>Because Go doesn’t allow unused variables, returning the <code>closer</code> from the function means that the program will not compile if the function is not called. That reminds the user to use <code>defer</code>. As covered earlier, you put parentheses after <code>closer</code> when you <code>defer</code> it.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Using <code>defer</code> can feel strange if you are used to a language that uses a block within a function to control when a resource is cleaned up, like the <code>try/catch/finally</code> blocks in Java, JavaScript, and Python or the <code>begin/rescue/ensure</code> blocks in Ruby.</p>

<p>The downside to these resource-cleanup<a data-type="indexterm" data-primary="resources online" data-secondary="indentation of code and readability" id="id1348"/><a data-type="indexterm" data-primary="nested code harder to read" id="id1349"/> blocks is that they create another level of indentation in your function, and that makes the code harder to read. It’s not just my opinion that nested code is harder to follow.<a data-type="indexterm" data-primary="Antinyan, Vard" id="id1350"/><a data-type="indexterm" data-primary="Staron, Miroslaw" id="id1351"/><a data-type="indexterm" data-primary="Sandberg, Anna" id="id1352"/> In research described in a <a href="https://oreil.ly/VcYrR">2017 paper in <em>Empirical Software Engineering</em></a>, Vard Antinyan et al. discovered that “Of…​eleven proposed code characteristics, only two markedly influence complexity growth: the nesting depth and the lack of structure.”</p>

<p>Research on what makes a program easier to read and understand isn’t new. <a data-type="indexterm" data-primary="Miara, Richard" id="id1353"/><a data-type="indexterm" data-primary="Musseman, Joyce" id="id1354"/><a data-type="indexterm" data-primary="Navarro, Juan" id="id1355"/><a data-type="indexterm" data-primary="Shneiderman, Ben" id="id1356"/>You can find papers that are many decades old, including a <a href="https://oreil.ly/s0xcq">paper from 1983</a> by Richard Miara et al. that tries to figure out the right amount of indentation to use (according to their results, two to four spaces).<a data-type="indexterm" data-startref="ch05-def" id="id1357"/><a data-type="indexterm" data-startref="ch05-def2" id="id1358"/><a data-type="indexterm" data-startref="ch05-def3" id="id1359"/></p>
</div>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Go Is Call by Value"><div class="sect1" id="call_value">
<h1>Go Is Call by Value</h1>

<p>You might hear people say<a data-type="indexterm" data-primary="Go" data-secondary="call by value language" id="ch05-cbv"/><a data-type="indexterm" data-primary="call by value language" id="ch05-cbv2"/><a data-type="indexterm" data-primary="functions" data-secondary="call by value language" id="ch05-cbv3"/><a data-type="indexterm" data-primary="parameters" data-secondary="call by value language" id="ch05-cbv4"/><a data-type="indexterm" data-primary="variables" data-secondary="call by value language" id="ch05-cbv5"/><a data-type="indexterm" data-primary="parameters" data-secondary="input parameters not modified" id="ch05-cbv6"/><a data-type="indexterm" data-primary="functions" data-secondary="input parameters not modified" id="ch05-cbv7"/> that Go is a <em>call-by-value</em> language and wonder what that means. It means that when you supply a variable for a parameter to a function, Go <em>always</em> makes a copy of the value of the variable. Let’s take a look. You can run this code on <a href="https://oreil.ly/yo_rY">The Go Playground</a>. It is also in the <em>sample_code/pass_value_type</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>. First, you define a simple struct:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">type</code><code class="w"> </code><code class="nx">person</code><code class="w"> </code><code class="kd">struct</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">age</code><code class="w">  </code><code class="kt">int</code><code class="w"/>
<code class="w">    </code><code class="nx">name</code><code class="w"> </code><code class="kt">string</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>Next, you write a function that takes in an <code>int</code>, a <code>string</code>, and a <code>person</code>, and modifies their values:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">modifyFails</code><code class="p">(</code><code class="nx">i</code><code class="w"> </code><code class="kt">int</code><code class="p">,</code><code class="w"> </code><code class="nx">s</code><code class="w"> </code><code class="kt">string</code><code class="p">,</code><code class="w"> </code><code class="nx">p</code><code class="w"> </code><code class="nx">person</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">i</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="mi">2</code><code class="w"/>
<code class="w">    </code><code class="nx">s</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="s">"Goodbye"</code><code class="w"/>
<code class="w">    </code><code class="nx">p</code><code class="p">.</code><code class="nx">name</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="s">"Bob"</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>You then call this function from <code>main</code> and see whether the modifications stick:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">p</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">person</code><code class="p">{}</code><code class="w"/>
<code class="w">    </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">2</code><code class="w"/>
<code class="w">    </code><code class="nx">s</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="s">"Hello"</code><code class="w"/>
<code class="w">    </code><code class="nx">modifyFails</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">s</code><code class="p">,</code><code class="w"> </code><code class="nx">p</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">s</code><code class="p">,</code><code class="w"> </code><code class="nx">p</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>As the name of the function indicates, running this code shows that a function won’t change the values of the parameters passed into it:</p>

<pre data-type="programlisting">2 Hello {0 }</pre>

<p>I included the <code>person</code> struct to show that this isn’t true just for primitive types. If you have programming experience in Java, JavaScript, Python, or Ruby, you might find the struct behavior strange. After all, those languages let you modify the fields in an object when you pass an object as a parameter to a function. The reason for the difference is something I will cover when I talk about pointers.</p>

<p>The behavior is a little different<a data-type="indexterm" data-primary="maps" data-secondary="call by value language" id="id1360"/><a data-type="indexterm" data-primary="slices" data-secondary="call by value language" id="id1361"/> for maps and slices. Let’s see what happens when you try to modify them within a function. You can run this code on <a href="https://oreil.ly/kKL4R">The Go Playground</a>. It is also in the <em>sample_code/pass_map_slice</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>. You’re going to write a function to modify a map parameter and a function to modify a slice 
<span class="keep-together">parameter:</span></p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">modMap</code><code class="p">(</code><code class="nx">m</code><code class="w"> </code><code class="kd">map</code><code class="p">[</code><code class="kt">int</code><code class="p">]</code><code class="kt">string</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">m</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="s">"hello"</code><code class="w"/>
<code class="w">    </code><code class="nx">m</code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="s">"goodbye"</code><code class="w"/>
<code class="w">    </code><code class="nb">delete</code><code class="p">(</code><code class="nx">m</code><code class="p">,</code><code class="w"> </code><code class="mi">1</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">modSlice</code><code class="p">(</code><code class="nx">s</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">k</code><code class="p">,</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">s</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">s</code><code class="p">[</code><code class="nx">k</code><code class="p">]</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">v</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="mi">2</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">s</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nb">append</code><code class="p">(</code><code class="nx">s</code><code class="p">,</code><code class="w"> </code><code class="mi">10</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>You then call these functions from <code>main</code>:</p>

<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">m</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="kd">map</code><code class="p">[</code><code class="kt">int</code><code class="p">]</code><code class="kt">string</code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="mi">1</code><code class="p">:</code><code class="w"> </code><code class="s">"first"</code><code class="p">,</code><code class="w"/>
<code class="w">        </code><code class="mi">2</code><code class="p">:</code><code class="w"> </code><code class="s">"second"</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">modMap</code><code class="p">(</code><code class="nx">m</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">m</code><code class="p">)</code><code class="w"/>

<code class="w">    </code><code class="nx">s</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="p">[]</code><code class="kt">int</code><code class="p">{</code><code class="mi">1</code><code class="p">,</code><code class="w"> </code><code class="mi">2</code><code class="p">,</code><code class="w"> </code><code class="mi">3</code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">modSlice</code><code class="p">(</code><code class="nx">s</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">s</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>

<p>When you run this code, you’ll see something interesting:</p>

<pre data-type="programlisting">map[2:hello 3:goodbye]
[2 4 6]</pre>

<p>For the map, it’s easy to explain what happens: any changes made to a map parameter are reflected in the variable passed into the function. For a slice, it’s more 
<span class="keep-together">complicated</span>. You can modify any element in the slice, but you can’t lengthen the slice. This is true for maps and slices that are passed directly into functions as well as map and slice fields in structs.</p>

<p>This program leads to the question: <a data-type="indexterm" data-primary="maps" data-secondary="call by value language" data-tertiary="pointer implementation of  maps" id="id1362"/><a data-type="indexterm" data-primary="slices" data-secondary="call by value language" data-tertiary="pointer implementation of slices" id="id1363"/><a data-type="indexterm" data-primary="pointers" data-secondary="call by value behavior of maps and slices" id="id1364"/>why do maps and slices behave differently than other types? It’s because maps and slices are both implemented with pointers. I’ll go into more detail in the next chapter.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Every type in Go is a value type.<a data-type="indexterm" data-primary="types" data-secondary="all types as value types" id="id1365"/> It’s just that sometimes the value is a pointer.</p>
</div>

<p>Call by value is one reason that Go’s limited support for constants is only a minor handicap. Since variables are passed by value, you can be sure that calling a function doesn’t modify the variable whose value was passed in (unless the variable is a slice or map). In general, this is a good thing. It makes it easier to understand the flow of data through your program when functions don’t modify their input parameters and instead return newly computed values.</p>

<p>While this approach is easy to understand, at times you need to pass something mutable to a function. What do you do then? That’s when you need a pointer.<a data-type="indexterm" data-startref="ch05-cbv" id="id1366"/><a data-type="indexterm" data-startref="ch05-cbv2" id="id1367"/><a data-type="indexterm" data-startref="ch05-cbv3" id="id1368"/><a data-type="indexterm" data-startref="ch05-cbv4" id="id1369"/><a data-type="indexterm" data-startref="ch05-cbv5" id="id1370"/><a data-type="indexterm" data-startref="ch05-cbv6" id="id1371"/><a data-type="indexterm" data-startref="ch05-cbv7" id="id1372"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Exercises"><div class="sect1" id="id71">
<h1>Exercises</h1>

<p>These exercises test your knowledge of functions in Go and how to use them. Solutions are available in the <em>exercise_solutions</em> directory in the <a href="https://oreil.ly/EzU8N">Chapter 5 repository</a>.<a data-type="indexterm" data-startref="ix_eeee2" id="id1373"/><a data-type="indexterm" data-startref="ix_eee2" id="id1374"/></p>
<ol>
<li>
<p>The simple calculator program doesn’t handle one error case: division by zero. Change the function signature for the math operations to return both an <code>int</code> and an <code>error</code>. In the <code>div</code> function, if
the divisor is <code>0</code>, return <code>errors.New("division by zero")</code> for the error. In all other cases, return <code>nil</code>. Adjust the <code>main</code> function to check for this error.</p>
</li>
<li>
<p>Write a function called <code>fileLen</code> that has an input parameter of type <code>string</code> and returns an <code>int</code> and an <code>error</code>. The function takes in a filename and returns the number of bytes in the file. If there is an error reading the file, return the error. Use <code>defer</code> to make sure the file is closed properly.</p>
</li>
<li>
<p>Write a function called <code>prefixer</code> that has an input parameter of type <code>string</code> and returns a function that has an input parameter of type <code>string</code> and returns a <code>string</code>. The returned function should prefix its input with the string passed into <code>prefixer</code>. Use the following <code>main</code> function to test <code>prefixer</code>:</p>
<div class="openblock">
<pre data-type="programlisting" data-code-language="go"><code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">helloPrefix</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">prefixer</code><code class="p">(</code><code class="s">"Hello"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">helloPrefix</code><code class="p">(</code><code class="s">"Bob"</code><code class="p">))</code><code class="w"> </code><code class="c1">// should print Hello Bob</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">helloPrefix</code><code class="p">(</code><code class="s">"Maria"</code><code class="p">))</code><code class="w"> </code><code class="c1">// should print Hello Maria</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
</div>
</li>

</ol>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Wrapping Up"><div class="sect1" id="id343">
<h1>Wrapping Up</h1>

<p>In this chapter, you’ve looked at functions in Go, how they are similar to functions in other languages, and their unique features. In the next chapter, you’re going to look at pointers, find out that they aren’t nearly as scary as many new Go developers expect them to be, and learn how to take advantage of them to write efficient programs.</p>
</div></section>
</div></section></div>
</div>
</body></html>