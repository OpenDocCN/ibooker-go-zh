<html><head></head><body><section data-pdf-bookmark="Appendix A. understanding os.openfile: Opening Files" data-type="appendix" epub:type="appendix" class="preface"><div class="preface" id="understanding_osdotopenfile_opening_file">
<h1 class="calibre17"><span class="calibre">Appendix A. </span>understanding os.openfile: Opening Files</h1>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0481-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7"><a data-primary="file management" data-secondary="opening files" data-type="indexterm" id="idm46062707671592" class="calibre10"/><a data-primary="OpenFile function (os)" data-type="indexterm" id="idm46062707670376" class="calibre10"/><a data-primary="os package" data-secondary="OpenFile function" data-type="indexterm" id="idm46062707669496" class="calibre10"/><strong class="calibre8">Some programs need to write data to files, not just read data.</strong> Throughout the book, when we’ve wanted to work with files, you had to create them in your text editor for your programs to read. But some programs <em class="calibre9">generate</em> data, and when they do, they need to be able to <em class="calibre9">write</em> data to a file.</p>
<p class="calibre7">We used the <code class="calibre20">os.OpenFile</code> function to open a file for writing earlier in the book. But we didn’t have space then to fully explore how it worked. In this appendix, we’ll show you everything you need to know in order to use <code class="calibre20">os.OpenFile</code> effectively!</p>
<section data-pdf-bookmark="Understanding os.OpenFile" data-type="sect1" class="preface"><div class="preface" id="understanding_osdotopenfile">
<h1 class="calibre25">Understanding os.OpenFile</h1>
<p class="calibre7"><a data-primary="FileMode type (os)" data-type="indexterm" id="idm46062707663688" class="calibre10"/><a data-primary="os package" data-secondary="FileMode type" data-type="indexterm" id="idm46062707662712" class="calibre10"/>In <a data-type="xref" href="ch16_split_000.html#a_pattern_to_follow_html_templates" class="calibre10">Chapter 16</a>, we had to use the <code class="calibre20">os.OpenFile</code> function to open a file for writing, which required some rather strange-looking code:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0482-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Back then, we were focused on writing a web app, so we didn’t want to take too much time out to fully explain <code class="calibre20">os.OpenFile</code>. But you’ll almost certainly need to use this function again in your Go-writing career, so we added this appendix to take a closer look at it.</p>
<p class="calibre7">When you’re trying to figure out how a function works, it’s always good to start with its documentation. In your terminal, run <strong class="calibre8"><code class="calibre40">go doc os OpenFile</code></strong> (or search for the <code class="calibre20">"os"</code> package documentation in your browser).</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0482-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Its arguments are a <code class="calibre20">string</code> filename, an <code class="calibre20">int</code> “flag,” and an <code class="calibre20">os.FileMode</code> “perm.” It’s pretty clear that the filename is just the name of the file we want to open. Let’s figure out what this “flag” means first, then come back to the <code class="calibre20">os.FileMode</code>.</p>
<p class="calibre7">To help keep our code samples in this appendix short, assume that all our programs include a <code class="calibre20">check</code> function, just like the one we showed you in <a data-type="xref" href="ch16_split_000.html#a_pattern_to_follow_html_templates" class="calibre10">Chapter 16</a>. It accepts an <code class="calibre20">error</code> value, checks whether it’s <code class="calibre20">nil</code>, and if not, reports the error and exits the program.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0482-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Passing flag constants to os.OpenFile" data-type="sect1" class="preface"><div class="preface" id="passing_flag_constants_to_osdotopenfile">
<h1 class="calibre25">Passing flag constants to os.OpenFile</h1>
<p class="calibre7"><a data-primary="O_RDONLY flag (os)" data-type="indexterm" id="idm46062707644120" class="calibre10"/><a data-primary="os package" data-secondary="O_RDONLY flag" data-type="indexterm" id="idm46062707642872" class="calibre10"/>The description mentions that one possible value for the flag is <code class="calibre20">os.O_RDONLY</code>. Let’s look that up and see what it means...</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0483-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">From the documentation, it looks like <code class="calibre20">os.O_RDONLY</code> is one of several <code class="calibre20">int</code> constants intended for passing to the <code class="calibre20">os.OpenFile</code> function, which change the function’s behavior.</p>
<p class="calibre7">Let’s try calling <code class="calibre20">os.OpenFile</code> with some of these constants, and see what happens.</p>
<p class="calibre7">First, we’ll need a file to work with. Create a plain-text file with a single line of text. Save it in any directory you want, with the name <em class="calibre9">aardvark.txt</em>.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0483-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Then, in the same directory, create a Go program that includes the <code class="calibre20">check</code> function from the previous page, and the following <code class="calibre20">main</code> function. In <code class="calibre20">main</code>, we call <code class="calibre20">os.OpenFile</code> with the <code class="calibre20">os.O_RDONLY</code> constant as the second argument. (Ignore the third argument for now; we’ll talk about that later.) Then we create a <code class="calibre20">bufio.Scanner</code> and use it to print the contents of the file.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0483-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">In your terminal, change to the directory where you saved the <em class="calibre9">aardvark.txt</em> file and your program, and use <strong class="calibre8"><code class="calibre40">go run</code></strong> to run the program. It will open <em class="calibre9">aardvark.txt</em> and print out its contents.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0483-04.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7"><a data-primary="O_APPEND flag (os)" data-type="indexterm" id="idm46062707624040" class="calibre10"/><a data-primary="O_CREATE flag (os)" data-type="indexterm" id="idm46062707622968" class="calibre10"/><a data-primary="os package" data-secondary="O_APPEND flag" data-type="indexterm" id="idm46062707622088" class="calibre10"/><a data-primary="os package" data-secondary="O_CREATE flag" data-type="indexterm" id="idm46062707620936" class="calibre10"/><a data-primary="os package" data-secondary="O_WRONLY flag" data-type="indexterm" id="idm46062707619864" class="calibre10"/><a data-primary="O_WRONLY flag (os)" data-type="indexterm" id="idm46062707618680" class="calibre10"/>Now let’s try writing to the file instead. Update your <code class="calibre20">main</code> function with the code below. (You’ll also need to remove unused packages from the <code class="calibre20">import</code> statement.) This time, we’ll pass the <code class="calibre20">os.O_WRONLY</code> constant to <code class="calibre20">os.OpenFile</code>, so that it opens the file for writing. Then we’ll call the <code class="calibre20">Write</code> method on the file with a slice of bytes to write to the file.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0484-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">If we run the program, it will produce no output, but it will update the <em class="calibre9">aardvark.txt</em> file. But if we open <em class="calibre9">aardvark.txt</em>, we’ll see that instead of appending the text to the end, the program overwrote part of the file!</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0484-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">That’s not how we wanted the program to work. What can we do?</p>
<p class="calibre7">Well, the <code class="calibre20">os</code> package has some other constants that might help. This includes an <code class="calibre20">os.O_APPEND</code> flag that should cause the program to append data to the file instead of overwriting it.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0484-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">But you can’t just pass <code class="calibre20">os.O_APPEND</code> to <code class="calibre20">os.OpenFile</code> by itself; you’ll get an error if you try.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0484-04.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">The documentation says something about how <code class="calibre20">os.O_APPEND</code> and <code class="calibre20">os.O_CREATE</code> “may be or’ed in.” This is referring to the <em class="calibre9">binary OR</em> operator. We’ll need to take a few pages to explain how that works...</p>
</div></section>
<section data-pdf-bookmark="Binary notation" data-type="sect1" class="preface"><div class="preface" id="binary_notation">
<h1 class="calibre25">Binary notation</h1>
<p class="calibre7"><a data-primary="| OR bitwise operator" data-type="indexterm" id="idm46062707599496" class="calibre10"/><a data-primary="&amp; AND bitwise operator" data-type="indexterm" id="idm46062707598520" class="calibre10"/><a data-primary="AND bitwise operator (&amp;)" data-type="indexterm" id="idm46062707597704" class="calibre10"/><a data-primary="%b formatting verb" data-type="indexterm" id="idm46062707596840" class="calibre10"/><a data-primary="binary notation" data-type="indexterm" id="idm46062707596008" class="calibre10"/><a data-primary="bitwise operators" data-type="indexterm" id="idm46062707595176" class="calibre10"/><a data-primary="operators" data-secondary="bitwise" data-type="indexterm" id="idm46062707594344" class="calibre10"/><a data-primary="OR bitwise operator (|)" data-type="indexterm" id="idm46062707593240" class="calibre10"/><a data-primary="Printf function (fmt)" data-secondary="formatting output" data-type="indexterm" id="idm46062707592408" class="calibre10"/><a data-primary="verbs, formatting for Printf" data-type="indexterm" id="idm46062707591304" class="calibre10"/>At the lowest level, computers have to represent information using simple switches, which can be either on or off. If one switch were used to represent a number, you could only represent the values <code class="calibre20">0</code> (switch “off”) or <code class="calibre20">1</code> (switch “on”). Computer scientists call this a <em class="calibre9">bit</em>.</p>
<p class="calibre7">If you combine multiple bits, you can represent larger numbers. This is the idea behind <em class="calibre9">binary</em> notation. In everyday life, we have the most experience with decimal notation, which uses the digits 0 through 9. But binary notation uses only the digits 0 and 1 to represent numbers.</p>
<div data-type="note" epub:type="note" class="calibre22"><h6 class="calibre23">Note</h6>
<p class="calibre7">(If you’d like to know more, just type “binary” into your favorite web search engine.)</p>
</div>
<p class="calibre7">You can view the binary representation of various numbers (the bits the numbers are composed of) using <code class="calibre20">fmt.Printf</code> with the <code class="calibre20">%b</code> formatting verb:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0485-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Bitwise operators" data-type="sect1" class="preface"><div class="preface" id="bitwise_operators">
<h1 class="calibre25">Bitwise operators</h1>
<p class="calibre7">We’ve seen operators like <code class="calibre20">+</code>, <code class="calibre20">-</code>, <code class="calibre20">*</code>, and <code class="calibre20">/</code> that allow you to do math operations on entire numbers. But Go also has <strong class="calibre8">bitwise operators</strong>, which allow you to manipulate the individual bits a number is composed of. Two of the most common ones are the <code class="calibre20">&amp;</code> bitwise AND operator, and the <code class="calibre20">|</code> bitwise OR operator.</p>
<table class="calibre11">
<thead class="calibre33">
<tr class="calibre13">
<th class="calibre34">Operator</th>
<th class="calibre34">Name</th>
</tr>
</thead>
<tbody class="calibre12">
<tr class="calibre13">
<td class="calibre14"><code class="calibre36">&amp;</code></td>
<td class="calibre14">Bitwise AND</td>
</tr>
<tr class="calibre15">
<td class="calibre14"><code class="calibre36">|</code></td>
<td class="calibre14">Bitwise OR</td>
</tr>
</tbody>
</table>
</div></section>
<section data-pdf-bookmark="The bitwise AND operator" data-type="sect1" class="preface"><div class="preface" id="the_bitwise_and_operator">
<h1 class="calibre25">The bitwise AND operator</h1>
<p class="calibre7"><a data-primary="&amp;&amp; logical operator" data-type="indexterm" id="idm46062707570456" class="calibre10"/>We’ve seen the <code class="calibre20">&amp;&amp;</code> operator. It’s a Boolean operator that gives a <code class="calibre20">true</code> value only if both the values to its left <em class="calibre9">and</em> its right are <code class="calibre20">true</code>:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0486-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">The <code class="calibre20">&amp;</code> operator (with just one ampersand), however, is a <em class="calibre9">bitwise</em> operator. It sets a bit to <code class="calibre20">1</code> only if the corresponding bit in the value to its left <em class="calibre9">and</em> the bit in the value to its right are both <code class="calibre20">1</code>. For the numbers <code class="calibre20">0</code> and <code class="calibre20">1</code>, which require only one bit to represent, this is fairly straightforward:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0486-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">For larger numbers, however, it can seem like nonsense!</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0486-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">It’s only when you look at the values of individual bits that bitwise operations make sense. The <code class="calibre20">&amp;</code> operator only sets a bit to <code class="calibre20">1</code> in the result if the bit in the same place in the left number <em class="calibre9">and</em> the bit in the same place in the right number are both <code class="calibre20">1</code>.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0486-04.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">This is true for numbers of any size. The bits of the two values the <code class="calibre20">&amp;</code> operator is used on determine the bits at the same places in the resulting value.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0486-05.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
</div></section>
<section data-pdf-bookmark="The bitwise OR operator" data-type="sect1" class="preface"><div class="preface" id="the_bitwise_or_operator">
<h1 class="calibre25">The bitwise OR operator</h1>
<p class="calibre7"><a data-primary="|| logical operator" data-type="indexterm" id="idm46062707548632" class="calibre10"/><a data-primary="| OR bitwise operator" data-type="indexterm" id="idm46062707547544" class="calibre10"/><a data-primary="boolean operators" data-type="indexterm" id="idm46062707546728" class="calibre10"/><a data-primary="logical operators" data-type="indexterm" id="idm46062707545832" class="calibre10"/><a data-primary="operators" data-secondary="boolean" data-type="indexterm" id="idm46062707544968" class="calibre10"/><a data-primary="operators" data-secondary="logical" data-type="indexterm" id="idm46062707543832" class="calibre10"/><a data-primary="OR bitwise operator (|)" data-type="indexterm" id="idm46062707542760" class="calibre10"/>We’ve also seen the <code class="calibre20">||</code> operator. It’s a Boolean operator that gives a <code class="calibre20">true</code> value if the value to its left <em class="calibre9">or</em> the value to its right is <code class="calibre20">true</code>.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0487-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">The <code class="calibre20">|</code> operator sets a bit to <code class="calibre20">1</code> in the result if the corresponding bit in the value to its left <em class="calibre9">or</em> the bit in the value to its right has a value of <code class="calibre20">1</code>.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0487-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Just as with bitwise AND, the bitwise OR operator looks at the bits at a given position in the two values it’s operating on to decide the value of the bit at the same position in the result.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0487-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">This is true for numbers of any size. The bits of the two values the <code class="calibre20">|</code> operator is used on determine the bits at the same places in the resulting value.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0487-04.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Using bitwise OR on the “os” package constants" data-type="sect1" class="preface"><div class="preface" id="using_bitwise_or_on_the">
<h1 class="calibre25">Using bitwise OR on the “os” package constants</h1>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0488-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7"><a data-primary="O_APPEND flag (os)" data-type="indexterm" id="idm46062707525288" class="calibre10"/><a data-primary="O_CREATE flag (os)" data-type="indexterm" id="idm46062707523944" class="calibre10"/><a data-primary="O_RDWR flag (os)" data-type="indexterm" id="idm46062707523000" class="calibre10"/><a data-primary="os package" data-secondary="bitwise operators and" data-type="indexterm" id="idm46062707522264" class="calibre10"/><a data-primary="os package" data-secondary="O_APPEND flag" data-type="indexterm" id="idm46062707521128" class="calibre10"/><a data-primary="os package" data-secondary="O_CREATE flag" data-type="indexterm" id="idm46062707520056" class="calibre10"/><a data-primary="os package" data-secondary="O_RDONLY flag" data-type="indexterm" id="idm46062707518920" class="calibre10"/><a data-primary="os package" data-secondary="O_RDWR flag" data-type="indexterm" id="idm46062707517848" class="calibre10"/><a data-primary="os package" data-secondary="O_WRONLY flag" data-type="indexterm" id="idm46062707516712" class="calibre10"/><strong class="calibre8">We showed you all this because you’ll need to use the bitwise OR operator to combine the constant values together!</strong></p>
<p class="calibre7">When the documentation says that the <code class="calibre20">os.O_APPEND</code> and <code class="calibre20">os.O_CREATE</code> values “may be or’ed in” with the <code class="calibre20">os.O_RDONLY</code>, <code class="calibre20">os.O_WRONLY</code>, or <code class="calibre20">os.O_RDWR</code> values, it means that you should use the bitwise OR operator on them.</p>
<p class="calibre7">Behind the scenes, these constants are all just <code class="calibre20">int</code> values:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0488-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">If we look at the binary representation of these values, we’ll see that just one bit is set to <code class="calibre20">1</code> for each, and all the other bits are <code class="calibre20">0</code>:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0488-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">That means we can combine the values with the bitwise OR operator, and none of the bits will interfere with each other:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0488-04.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">The <code class="calibre20">os.OpenFile</code> function can check whether the first bit is a <code class="calibre20">1</code> to determine whether the file should be write-only. If the seventh bit is a <code class="calibre20">1</code>, <code class="calibre20">OpenFile</code> will know to create the file if it doesn’t exist. And if the 11th bit is a <code class="calibre20">1</code>, <code class="calibre20">OpenFile</code> will append to the file.</p>
<aside data-type="sidebar" epub:type="sidebar" class="calibre30"><div class="sidebar" id="watch_it_7">
<h5 class="calibre31"><span class="calibre"><img alt="image" src="assets/watch-it.png" class="calibre4"/></span> Watch it!</h5>
<p class="calibre7"><strong class="calibre8">Only use the constant names in your code, never their</strong> <code class="calibre20">int</code> <strong class="calibre8">values!</strong></p>
<p class="calibre7"><em class="calibre9">If you use values like</em> <code class="calibre20">1</code> <em class="calibre9">and</em> <code class="calibre20">1024</code> <em class="calibre9">in your code in place of the constants, it might work in the short term. But if the Go maintainers ever modified the constants’ values, your code would break. Make sure to use the constant names like</em> <code class="calibre20">os.O_WRONLY</code> <em class="calibre9">and</em> <code class="calibre20">os.O_APPEND</code>, <em class="calibre9">and you’ll be safe.</em></p>
</div></aside>
</div></section>
<section data-pdf-bookmark="Using bitwise OR to fix our os.OpenFile options" data-type="sect1" class="preface"><div class="preface" id="using_bitwise_or_to_fix_our_osdotopenfil">
<h1 class="calibre25">Using bitwise OR to fix our os.OpenFile options</h1>
<p class="calibre7"><a data-primary="OpenFile function (os)" data-type="indexterm" id="idm46062707493384" class="calibre10"/><a data-primary="operators" data-secondary="bitwise" data-type="indexterm" id="idm46062707489368" class="calibre10"/><a data-primary="os package" data-secondary="OpenFile function" data-type="indexterm" id="idm46062707488296" class="calibre10"/><a data-primary="O_WRONLY flag (os)" data-type="indexterm" id="idm46062707487176" class="calibre10"/>Previously, when we passed only the <code class="calibre20">os.O_WRONLY</code> option to <code class="calibre20">os.OpenFile</code>, it wrote over part of the data that was already in the file. Let’s see if we can combine options so that it appends new data to the end of the file instead.</p>
<p class="calibre7">Start by editing the <em class="calibre9">aardvark.txt</em> file so that it consists of a single line again.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0489-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Next, update our program to use the bitwise OR operator to combine the <code class="calibre20">os.O_WRONLY</code> and <code class="calibre20">os.O_APPEND</code> constant values into a single value. Pass the result to <code class="calibre20">os.OpenFile</code>.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0489-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Run the program again and take another look at the file’s contents. You should see the new line of text appended at the end.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0489-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Let’s also try using the <code class="calibre20">os.O_CREATE</code> option, which causes <code class="calibre20">os.OpenFile</code> to create the specified file if it doesn’t exist. Start by deleting the <em class="calibre9">aardvark.txt</em> file.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0489-04.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Now update the program to add <code class="calibre20">os.O_CREATE</code> to the options being passed to <code class="calibre20">os.OpenFile</code>.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0489-05.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">When we run the program, it will create a new <em class="calibre9">aardvark.txt</em> file and then write the data to it.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0489-06.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Unix-style file permissions" data-type="sect1" class="preface"><div class="preface" id="unixhyphenstyle_file_permissions">
<h1 class="calibre25">Unix-style file permissions</h1>
<p class="calibre7"><a data-primary="execute (x) file permission" data-type="indexterm" id="idm46062707464408" class="calibre10"/><a data-primary="file management" data-secondary="file permissions" data-type="indexterm" id="idm46062707463400" class="calibre10"/><a data-primary="Linux operating systems" data-type="indexterm" id="idm46062707462280" class="calibre10"/><a data-primary="Mac operating systems" data-type="indexterm" id="idm46062707461448" class="calibre10"/><a data-primary="permissions, file" data-type="indexterm" id="idm46062707460568" class="calibre10"/><a data-primary="read (r) file permission" data-type="indexterm" id="idm46062707459736" class="calibre10"/><a data-primary="Unix operating systems" data-type="indexterm" id="idm46062707458936" class="calibre10"/><a data-primary="Windows operating systems" data-type="indexterm" id="idm46062707458024" class="calibre10"/><a data-primary="write (w) file permission" data-type="indexterm" id="idm46062707457256" class="calibre10"/>We’ve been focusing on the second argument to <code class="calibre20">os.OpenFile</code>, which controls reading, writing, creating, and appending files. Up until now, we’ve been ignoring the third argument, which controls the file’s <em class="calibre9">permissions</em>: which users will be permitted to read from and write to the file after your program creates it.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0490-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">When developers talk about file permissions, they usually mean permissions as they’re implemented on Unix-like systems like macOS and Linux. Under Unix, there are three major permissions a user can have on a file:</p>
<table class="calibre11">
<thead class="calibre33">
<tr class="calibre13">
<th class="calibre34">Abbreviation</th>
<th class="calibre34">Permission</th>
</tr>
</thead>
<tbody class="calibre12">
<tr class="calibre13">
<td class="calibre14"><code class="calibre36">r</code></td>
<td class="calibre14">The user can <strong class="calibre8">r</strong>ead the file’s contents.</td>
</tr>
<tr class="calibre15">
<td class="calibre14"><code class="calibre36">w</code></td>
<td class="calibre14">The user can <strong class="calibre8">w</strong>rite the file’s contents.</td>
</tr>
<tr class="calibre13">
<td class="calibre14"><code class="calibre36">x</code></td>
<td class="calibre14">The user can e<strong class="calibre8">x</strong>ecute the file. (This is only appropriate for files that contain program code.)</td>
</tr>
</tbody>
</table>
<p class="calibre7">If a user doesn’t have read permissions on a file, for example, any program they run that tries to access the file’s contents will get an error from the operating system:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0490-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">If a user doesn’t have execute permissions on a file, they won’t be able to execute any code it contains. (Files that don’t contain executable code should <em class="calibre9">not</em> be marked executable, because attempting to run them could produce unpredictable results.)</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0490-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar" class="calibre30"><div class="sidebar" id="watch_it_8">
<h5 class="calibre31"><span class="calibre"><img alt="image" src="assets/watch-it.png" class="calibre4"/></span> Watch it!</h5>
<p class="calibre7"><strong class="calibre8">The permissions argument is ignored on Windows.</strong></p>
<p class="calibre7"><em class="calibre9">Windows doesn’t treat file permissions in the same way as Unix-like systems, so files will be created with default permissions on Windows no matter what you do. But that same program will not ignore the permissions argument when it runs on Unix-like machines. It’s important to be familiar with how permissions work, and if possible, to test your program on the various operating systems you want it to run on.</em></p>
</div></aside>
</div></section>
<section data-pdf-bookmark="Representing permissions with the os.FileMode type" data-type="sect1" class="preface"><div class="preface" id="representing_permissions_with_the_osdotf">
<h1 class="calibre25">Representing permissions with the os.FileMode type</h1>
<p class="calibre7"><a data-primary="FileMode type (os)" data-type="indexterm" id="idm46062707427416" class="calibre10"/><a data-primary="fmt package" data-secondary="Printf function" data-see="Printf function (fmt)" data-type="indexterm" id="idm46062707433256" class="calibre10"/><a data-primary="ls utility (Unix)" data-type="indexterm" id="idm46062707432008" class="calibre10"/><a data-primary="os package" data-secondary="FileMode type" data-type="indexterm" id="idm46062707431240" class="calibre10"/><a data-primary="os package" data-secondary="String method" data-type="indexterm" id="idm46062707430200" class="calibre10"/><a data-primary="Printf function (fmt)" data-type="indexterm" id="idm46062707429016" class="calibre10"/><a data-primary="Printf function (fmt)" data-secondary="file permissions and" data-type="indexterm" id="idm46062707426184" class="calibre10"/><a data-primary="String method (os)" data-type="indexterm" id="idm46062707425112" class="calibre10"/><a data-primary="uint32 type" data-type="indexterm" id="idm46062707424280" class="calibre10"/>Go’s <code class="calibre20">os</code> package uses the <code class="calibre20">FileMode</code> type to represent file permissions. If a file doesn’t already exist, the <code class="calibre20">FileMode</code> you pass to <code class="calibre20">os.OpenFile</code> determines what permissions the file will be created with, and therefore what kinds of access users will have to it.</p>
<p class="calibre7"><code class="calibre20">FileMode</code> values have a <code class="calibre20">String</code> method, so if you pass a <code class="calibre20">FileMode</code> to functions in the <code class="calibre20">fmt</code> package like <code class="calibre20">fmt.Println</code>, you’ll get a special string representation of the value. That string shows the permissions the <code class="calibre20">FileMode</code> represents, in a format similar to the one you might see in the Unix <code class="calibre20">ls</code> utility.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0491-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<pre data-type="programlisting" class="calibre32">fmt.Println(os.FileMode(0700))</pre>
<div data-type="note" epub:type="note" class="calibre22"><h6 class="calibre23">Note</h6>
<p class="calibre7">(Look for “Unix file permissions” in a search engine if you’d like more info.)</p>
</div>
<p class="calibre7">Each file has three sets of permissions, affecting three different classes of users. The first set of permissions applies only to the user that owns the file. (By default, your user account is the owner of any files you create.) The second set of permissions is for the group of users that the file is assigned to. And the third set applies to other users on the system that are neither the file owner nor part of the file’s assigned group.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0491-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7"><code class="calibre20">FileMode</code> has an underlying type of <code class="calibre20">uint32</code>, which stands for “32-bit unsigned integer.” It’s a basic type that we haven’t talked about previously. Because it’s unsigned, it can’t hold any negative numbers, but it can hold larger numbers within its 32 bits of memory than it would otherwise be able to.</p>
<p class="calibre7">Because <code class="calibre20">FileMode</code> is based on <code class="calibre20">uint32</code>, you can use a type conversion to convert (almost) any non-negative integer to a <code class="calibre20">FileMode</code> value. The results may be a little hard to understand, though:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0491-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Octal notation" data-type="sect1" class="preface"><div class="preface" id="octal_notation">
<h1 class="calibre25">Octal notation</h1>
<p class="calibre7"><a data-primary="%0 formatting verb" data-type="indexterm" id="idm46062707404648" class="calibre10"/><a data-primary="binary notation" data-type="indexterm" id="idm46062707403400" class="calibre10"/><a data-primary="octal notation" data-type="indexterm" id="idm46062707402568" class="calibre10"/>Instead, it’s easier to specify integers for conversion to <code class="calibre20">FileMode</code> values using <strong class="calibre8">octal notation</strong>. We’ve seen decimal notation, which uses 10 digits: 0 through 9. We’ve seen binary notation, which uses just two digits: 0 and 1. Octal notation uses eight digits: 0 through 7.</p>
<p class="calibre7">You can view the octal representation of various numbers using <code class="calibre20">fmt.Printf</code> with the <code class="calibre20">%0</code> formatting verb:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0492-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Unlike with binary notation, Go lets you write numbers using octal notation in your program code. Any series of digits preceded by a <code class="calibre20">0</code> will be treated as an octal number.</p>
<p class="calibre7">This can be confusing if you’re not prepared for it. Decimal <code class="calibre20">10</code> is not at all the same as octal <code class="calibre20">010</code>, and decimal <code class="calibre20">100</code> isn’t at all like octal <code class="calibre20">0100</code>!</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0492-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Only the digits 0 through 7 are valid in octal numbers. If you include an 8 or a 9, you’ll get a compile error.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0492-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
</div></section>
<section data-pdf-bookmark="Converting octal values to FileMode values" data-type="sect1" class="preface"><div class="preface" id="converting_octal_values_to_filemode_valu">
<h1 class="calibre25">Converting octal values to FileMode values</h1>
<p class="calibre7">So why use this (arguably strange) octal notation for file permissions? Because each digit of an octal number can be represented using just 3 bits of memory:</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0493-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Three bits is also the exact amount of data needed to store the permissions for one user class (“user,” “group,” or “other”). Any combination of permissions you need for a user class can be represented using one octal digit!</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0493-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">Notice the similarity between the binary representation of the octal numbers below and the <code class="calibre20">FileMode</code> conversion for the same number. If a bit in the binary representation is <code class="calibre20">1</code>, then the corresponding permission is enabled.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0493-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">For this reason, the Unix <code class="calibre20">chmod</code> utility (short for “change mode”) has used octal digits to set file permissions for decades now.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0493-04.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<table class="calibre11">
<thead class="calibre33">
<tr class="calibre13">
<th class="calibre34">Octal digit</th>
<th class="calibre34">Permission</th>
</tr>
</thead>
<tbody class="calibre12">
<tr class="calibre13">
<td class="calibre14"><code class="calibre36">0</code></td>
<td class="calibre14">no permissions</td>
</tr>
<tr class="calibre15">
<td class="calibre14"><code class="calibre36">1</code></td>
<td class="calibre14">execute</td>
</tr>
<tr class="calibre13">
<td class="calibre14"><code class="calibre36">2</code></td>
<td class="calibre14">write</td>
</tr>
<tr class="calibre15">
<td class="calibre14"><code class="calibre36">3</code></td>
<td class="calibre14">write, execute</td>
</tr>
<tr class="calibre13">
<td class="calibre14"><code class="calibre36">4</code></td>
<td class="calibre14">read</td>
</tr>
<tr class="calibre15">
<td class="calibre14"><code class="calibre36">5</code></td>
<td class="calibre14">read, execute</td>
</tr>
<tr class="calibre13">
<td class="calibre14"><code class="calibre36">6</code></td>
<td class="calibre14">read, write</td>
</tr>
<tr class="calibre15">
<td class="calibre14"><code class="calibre36">7</code></td>
<td class="calibre14">read, write, execute</td>
</tr>
</tbody>
</table>
<p class="calibre7">Go’s support for octal notation allows you to follow the same convention in your code!</p>
</div></section>
<section data-pdf-bookmark="Calls to os.OpenFile, explained" data-type="sect1" class="preface"><div class="preface" id="calls_to_osdotopenfile_explained">
<h1 class="calibre25">Calls to os.OpenFile, explained</h1>
<p class="calibre7"><a data-primary="- (dash)" data-type="indexterm" id="idm46062707359608" class="calibre10"/><a data-primary="bitwise operators" data-type="indexterm" id="idm46062707358744" class="calibre10"/><a data-primary="Create function (os)" data-type="indexterm" id="idm46062707357944" class="calibre10"/><a data-primary="dash (-)" data-type="indexterm" id="idm46062707357144" class="calibre10"/><a data-primary="File type (os)" data-type="indexterm" id="idm46062707356344" class="calibre10"/><a data-primary="hyphen (-)" data-type="indexterm" id="idm46062707355544" class="calibre10"/><a data-primary="OpenFile function (os)" data-type="indexterm" id="idm46062707354728" class="calibre10"/><a data-primary="Open function (os)" data-type="indexterm" id="idm46062707353928" class="calibre10"/><a data-primary="operators" data-secondary="bitwise" data-type="indexterm" id="idm46062707353016" class="calibre10"/><a data-primary="os package" data-secondary="Create function" data-type="indexterm" id="idm46062707351944" class="calibre10"/><a data-primary="os package" data-secondary="File type" data-type="indexterm" id="idm46062707350792" class="calibre10"/><a data-primary="os package" data-secondary="OpenFile function" data-type="indexterm" id="idm46062707349672" class="calibre10"/><a data-primary="os package" data-secondary="Open function" data-type="indexterm" id="idm46062707348520" class="calibre10"/>Now that we understand both bitwise operators and octal notation, we can finally understand just what calls to <code class="calibre20">os.OpenFile</code> do!</p>
<p class="calibre7">This code, for example, will append new data to an existing logfile. The user that owns the file will be able to read from and write to the file. All other users will only be able to read from it.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0494-01.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<p class="calibre7">And this code will create a file if it doesn’t exist, then append data to it. The resulting file will be readable and writable by its owner, but no other user will have access to it.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0494-02.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar" class="calibre30"><div class="sidebar" id="watch_it_9">
<h5 class="calibre31"><span class="calibre"><img alt="image" src="assets/watch-it.png" class="calibre4"/></span> Watch it!</h5>
<p class="calibre7"><strong class="calibre8">If the os.Open or os.Create functions will do what you need, use those instead.</strong></p>
<p class="calibre7"><em class="calibre9">The</em> <code class="calibre20">os.Open</code> <em class="calibre9">function can only open files for reading. But if that’s all you need, you may find it simpler to use than</em> <code class="calibre20">os.OpenFile</code><em class="calibre9">. Likewise, the</em> <code class="calibre20">os.Create</code> <em class="calibre9">function can only create files that are readable and writable by any user. But if that’s all you need, you should consider using it instead of</em> <code class="calibre20">os.OpenFile</code><em class="calibre9">. Sometimes less powerful functions result in more readable code.</em></p>
</div></aside>
</div></section>
<section data-pdf-bookmark="there are no Dumb Questions" data-type="sect1" class="preface"><div class="preface" id="there_are_no_dumb_questions_16">
<h1 class="calibre25">there are no Dumb Questions</h1>
<p class="calibre7"><strong class="calibre8">Q: Octal notation and bitwise operators are a pain! Why is it done this way?</strong></p>
<p class="calibre7"><strong class="calibre8">A:</strong> To save computer memory! These conventions for handling files have their roots in Unix, which was developed when RAM and disk space were both smaller and more expensive. But even now, when a hard disk can contain millions of files, packing file permissions into a few bits instead of several bytes can save a lot of space (and make your system run faster). Trust us, the effort is worth it!</p>
<p class="calibre7"><strong class="calibre8">Q: What’s that extra dash at the front of a <code class="calibre40">FileMode</code> string?</strong></p>
<p class="calibre7"><strong class="calibre8">A:</strong> A dash in that position indicates that a file is just an ordinary file, but it can show several other values. For example, if the <code class="calibre20">FileMode</code> value represents a directory, it will be a <code class="calibre20">d</code> instead.</p>
<figure class="informal"><div class="figure">
<img alt="image" src="assets/f0494-03.png" class="calibre4"/>
<h6 class="calibre5"/>
</div></figure>
</div></section>
</div></section></body></html>