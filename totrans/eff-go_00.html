<html><head></head><body><section data-pdf-bookmark="Preface" data-type="preface" epub:type="preface"><div class="preface" id="idm45606849013424">&#13;
<h1>Preface</h1>&#13;
&#13;
&#13;
<p>Welcome to the pragmatic software development world, where engineers are not afraid of ambitious performance goals. Where the change in requirements or unexpected efficiency issues is handled without stress, where code is optimized tactically and effectively, based on data, yet the codebase is kept simple and easy to read, maintain, and extend. Wait, is this even possible?</p>&#13;
&#13;
<p>Yes, and I will show you how! The good news is that if you bought this book, you are already halfway there—it means you acknowledge the problem and are open to learning more! The bad news is that, while I tried to distill the knowledge to only what’s necessary, there are still 11 chapters to go through. I think <em>Efficient Go</em> is unique in this regard as it is not a quick tutorial. Instead, it is a complete guide to writing efficient yet pragmatic software that goes through all aspects I wish I had known when I started my career.</p>&#13;
&#13;
<p>In this book, you will undoubtedly learn a lot about my favorite programming language, Go, and how to optimize it. But don’t let the title of this book fool you. While I use Go as the example language to show the optimization mindset and observability patterns, 8 out of 11 chapters of this book are language agnostic. You can use the same techniques to improve software written in any other language like Java, C#, Scala, Python, C++, Rust, or Haskell.</p>&#13;
&#13;
<p>Finally, if you expected a full list of low-level optimization tricks, this is not the right book. Firstly, optimizations do not generalize well. The fact that someone unrolled the loop or used a pointer in their struct field and achieved better efficiency does not mean it will be helpful if we do the same! We will go through some optimization tricks, but I emphasize complete knowledge about efficiency in pragmatic software development instead.</p>&#13;
&#13;
<p>Secondly, “low-level” dangerous tricks are often not needed. In most cases, an awareness of simple points where your program wastes time and resources is enough to fulfill your efficiency and scalability goals cheaply and effectively. Furthermore, you will learn that in most cases, there is no need to rewrite your program to C++, Rust, or Assembly to have an efficient solution!</p>&#13;
&#13;
<p>Before we start, let’s go through the main goals behind this book and why I found it necessary to focus my time on the subject of efficiency. You will also learn how to get the most out of this book and effectively use it in your software development tasks.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Why I Wrote This Book" data-type="sect1"><div class="sect1" id="idm45606858234944">&#13;
<h1>Why I Wrote This Book</h1>&#13;
&#13;
<p>I spent around 1,200 hours writing <em>Efficient Go</em>, so the choice to deliver such a book was not spur-of-the-moment. In the era of social media, YouTube, and TikTok, book writing and reading might feel outdated, but in my experience, modern media tend to oversimplify topics. You have to condense those to an absolute minimum not to lose viewers and monetization. It leads to <a href="https://oreil.ly/A8dCv">the wrong incentives</a>, which generally collide with what I wanted to achieve with this book.</p>&#13;
&#13;
<p>My mission here is straightforward: I want the software I use or depend on to be better! I want software project contributors and maintainers to understand their code’s efficiency and how to assess it. I want them to reliably review my or others’ pull requests with efficiency improvements. I want people around me to know how to handle performance issues professionally instead of building a stressful atmosphere. I want users and stakeholders to be cautious with the benchmarks and cheap marketing we see in the industry. Finally, I want leaders, directors, and product managers to approach software efficiency topics maturely with the awareness of how to form pragmatic efficiency requirements that help engineers to deliver excellent products.</p>&#13;
&#13;
<p>I also consider this book a small contribution toward more sustainable software. Every wasted CPU time and memory wastes a significant amount of your business’s money. However, it also wastes energy and hardware, which has a serious environmental effect. So saving money and the planet at the same time while enabling better value for your business is not a bad outcome of the skills you will learn here.</p>&#13;
&#13;
<p>I figured out that writing a book is the best way to achieve this goal. It’s easier than continuously explaining the same nuances, tooling, and techniques in my daily work, open source, and conferences!</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How I Gathered This Knowledge" data-type="sect1"><div class="sect1" id="idm45606860290352">&#13;
<h1>How I Gathered This Knowledge</h1>&#13;
&#13;
<p>I built my experience toward efficiency topics and high-quality software development through a lot of practice, mistakes, experiments, <a href="https://oreil.ly/7IFBd">implicit mentors</a>, and research.</p>&#13;
&#13;
<p>I was 29 years old when I started writing this book. That might not feel like &#13;
<span class="keep-together">much experience,</span> but I started a full-time, professional software development career when I was 19. I did full-time computer science studies in parallel to work at Intel around software-defined infrastructure (SDI). I initially coded in Python around the <a href="https://www.openstack.org">OpenStack project</a>, then in C++ including contributions to the popular-back-then <a href="https://mesos.apache.org">Mesos</a> project under the supervision of amazing engineers from <a href="https://oreil.ly/yUHzn">Mesosphere</a> and Twitter. Finally, I moved to develop Go around <a href="https://kubernetes.io">Kubernetes</a> and fell in love with this language.</p>&#13;
&#13;
<p>I spent a nontrivial amount of time at Intel on node <a href="https://oreil.ly/uPnb7">oversubscription feature</a> with noisy neighbor mitigations. Generally, oversubscription allows running more programs on a single machine than would be otherwise possible. This can work since statistically, all programs rarely use all of their reserved resources simultaneously. Looking at this now from a later perspective, it is usually easier and more effective to save money by starting with software optimization than by using complex algorithms like this.</p>&#13;
&#13;
<p>In 2016, I moved to London to work for a gaming start-up. I worked with past employees of Google, Amazon, Microsoft, and Facebook to develop and operate a global gaming platform. We were developing microservices, mostly in Go running on dozens of Kubernetes clusters worldwide. This is where I learned a lot about distributed systems, site reliability engineering, and monitoring. Perhaps this was when I got addicted to amazing tooling around observability, which is key to achieving pragmatic efficiency and explained in <a data-type="xref" href="ch06.html#ch-observability">Chapter 6</a>.</p>&#13;
&#13;
<p>My passion for good visibility of the running software translated to becoming an expert in using and developing a popular, open source, time-series database for monitoring purposes called <a href="https://prometheus.io">Prometheus</a>. Eventually, I became an official maintainer and started multiple other Go open source projects and libraries. Finally, I had an opportunity to cocreate with Fabian Reinartz a large distributed time-series database in the open source called <a href="https://thanos.io">Thanos</a>. I would not be surprised if some of my code runs in your company infrastructure!</p>&#13;
&#13;
<p>In 2019, I moved to Red Hat, where I work full-time on observability systems in open source. This is when I also dived more into continuous profiling solutions, which you will learn in this book too.</p>&#13;
&#13;
<p>I am also active in <a href="https://cncf.io">the Cloud Native Computing Foundation (CNCF)</a> as the ambassador and <a href="https://oreil.ly/f9UYG">observability Technical Advisory Group (TAG)</a> tech lead. In addition, I co-organize conferences and meetups. Finally, with the Prometheus and Thanos projects, with the team, we mentor multiple engineers every year via the CNCF <a href="https://oreil.ly/rU0bg">mentoring initiatives</a>.<sup><a data-type="noteref" href="preface01.html#idm45606849001040" id="idm45606849001040-marker">1</a></sup></p>&#13;
&#13;
<p class="less_space pagebreak-before">I wrote or reviewed thousands of code lines for various software that had to run on production, be reliable, and scale. I have taught and mentored over two dozen engineers so far. However, perhaps the most insightful was the open source work. You interact with diverse people, from different companies and places worldwide, with different backgrounds, goals, and needs.</p>&#13;
&#13;
<p>Overall, I believe we achieved amazing things with the fantastic people I had a chance to work with. I was lucky to work in environments where high-quality code was more important than decreasing code review delays or reducing time spent addressing style issues. We thrived on good system design, code maintainability, and readability. We tried to bring those values to open source, and I think we did a good job there. However, there is one important thing I would improve if I had a chance to write, for instance, the Thanos project again: I would try to focus more on the pragmatic efficiency of my code and the algorithms we chose. I would focus on having clearer efficiency requirements from the start and invest more in benchmarking and profiling.</p>&#13;
&#13;
<p>And don’t get me wrong, the Thanos system nowadays is faster and uses much fewer resources than some competitors, but it took a lot of time, and there is still a massive amount of hardware resources we could use less. We still have many bottlenecks that await community attention. However, if I applied the knowledge, techniques, and suggestions that you will learn in this book, I believe we could have cut the development cost in half, if not more, to have Thanos in the state we have today (I hope my ex-boss who paid for this work won’t read that!).</p>&#13;
&#13;
<p>My journey showed me how much a book like this was needed. With more people programming overall, often without a computer science background, there are plenty of mistakes and misconceptions, especially regarding software efficiency. Not much literature was available to give us practical answers to our efficiency or scaling questions, especially for Go. Hopefully, this book fills that literature gap.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Who This Book Is For" data-type="sect1"><div class="sect1" id="idm45606848969216">&#13;
<h1>Who This Book Is For</h1>&#13;
&#13;
<p><em>Efficient Go</em> focuses on giving the tools and knowledge necessary to answer when and how to apply efficiency optimization, depending strongly on circumstances and your organization’s goals. As a result, the primary audience for this book is software developers designing, creating, or changing programs written in Go and any other modern language. It should be a software engineer’s job to be an expert on ensuring the software they create works within both functional and efficiency requirements. Ideally, you have some basic programming skills when starting this book.</p>&#13;
&#13;
<p class="less_space pagebreak-before">I believe this book is also useful to those who primarily operate software somebody else writes, e.g., DevOps engineers, SRE, sysadmins, and platform teams. There are many optimization design levels (as discussed in <a data-type="xref" href="ch03.html#ch-conq-opt-levels">“Optimization Design Levels”</a>). Sometimes it makes sense to invest in software optimizations, and sometimes we might need to address it on other levels! Moreover, to achieve reliable efficiency, software engineers have to benchmark and experiment a lot with production-like environments (as explained in <a data-type="xref" href="ch06.html#ch-observability">Chapter 6</a>), which usually means close collaboration with platform teams. Finally, the observability practices explained in <a data-type="xref" href="ch06.html#ch-observability">Chapter 6</a> are state-of-the-art tools recommended for modern platform engineering. I am a strong proponent of avoiding differentiating between application performance monitoring (APM) and observability for SRE. If you hear that differentiation, it’s mostly coming from vendors who want you to pay more or feel like they have more features. As I will explain, we can reuse the same tools, instrumentations, and signals across all software observations.<sup><a data-type="noteref" href="preface01.html#idm45606840126384" id="idm45606840126384-marker">2</a></sup> Generally, we are on the same team—we want to build better products!</p>&#13;
&#13;
<p>Finally, I would like to recommend this book to managers, product managers, and leaders who want to stay technical and understand how to ensure you are not wasting millions of dollars on easy-to-fix efficiency issues within your team!</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How This Book Is Organized" data-type="sect1"><div class="sect1" id="idm45606849010704">&#13;
<h1>How This Book Is Organized</h1>&#13;
&#13;
<p>This book is organized into 11 chapters. In <a data-type="xref" href="ch01.html#ch-efficiency-matters">Chapter 1</a>, we discuss efficiency and why it matters. Then, in <a data-type="xref" href="ch02.html#ch-go">Chapter 2</a>, I briefly introduce Go with efficiency in mind. Then, in <a data-type="xref" href="ch03.html#ch-efficiency">Chapter 3</a>, we will talk about optimizations and how to think about them and approach those. Efficiency improvements can take enormous amounts of your time, but systematic approaches help you save a lot of time and effort.</p>&#13;
&#13;
<p>In Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch04.html#ch-hardware">4</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch05.html#ch-hardware2">5</a>, I will explain all you need to know about latency, CPU, and memory resources, as well as how OS and Go abstract them.</p>&#13;
&#13;
<p>Then we will move on to what it means to perform data-driven decisions around software efficiency. We will start with <a data-type="xref" href="ch06.html#ch-observability">Chapter 6</a>. Then we will discuss the reliability of experiments and complexity analysis in <a data-type="xref" href="ch07.html#ch-observability2">Chapter 7</a>. Finally, I will explain benchmarking and profiling techniques in Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch08.html#ch-benchmarking">8</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch09.html#ch-observability3">9</a>.</p>&#13;
&#13;
<p>Last but not least, I will show you various examples of different optimization situations in <a data-type="xref" href="ch10.html#ch-opt">Chapter 10</a>. Finally, in <a data-type="xref" href="ch11.html#ch-opt2">Chapter 11</a>, we will take a few learnings and summarize various efficiency patterns and tricks we see in the Go community.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Conventions Used in This Book" data-type="sect1"><div class="sect1" id="idm45606840492336">&#13;
<h1>Conventions Used in This Book</h1>&#13;
&#13;
<p>The following typographical conventions are used in this book:</p>&#13;
<dl>&#13;
<dt><em>Italic</em></dt>&#13;
<dd>&#13;
<p>Indicates new terms, URLs, email addresses, filenames, and file extensions.</p>&#13;
</dd>&#13;
<dt><code>Constant width</code></dt>&#13;
<dd>&#13;
<p>Used for program listings, as well as within paragraphs to refer to program elements such as variable or function names, databases, data types, environment variables, statements, and keywords.</p>&#13;
</dd>&#13;
<dt><strong><code>Constant width bold</code></strong></dt>&#13;
<dd>&#13;
<p>Shows commands or other text that should be typed literally by the user.</p>&#13;
</dd>&#13;
<dt><em><code>Constant width italic</code></em></dt>&#13;
<dd>&#13;
<p>Shows text that should be replaced with user-supplied values or by values determined by context.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="tip">&#13;
<p>This element signifies a tip or suggestion.</p>&#13;
</div>&#13;
<div data-type="note" epub:type="note">&#13;
<p>This element signifies a general note.</p>&#13;
</div>&#13;
<div data-type="warning" epub:type="warning">&#13;
<p>This element indicates a warning or caution.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Code Examples" data-type="sect1"><div class="sect1" id="idm45606840492096">&#13;
<h1>Using Code Examples</h1>&#13;
&#13;
<p>This book contains code examples that should help you understand the tools, techniques, and good practices. All of them are in the Go programming language and work with Go version 1.18 and above.</p>&#13;
&#13;
<p>You can find all the examples from this book in the executable and tested open source GitHub repository  <a href="https://github.com/efficientgo/examples"><code>efficientgo/examples</code></a>. You are welcome to fork it, use it, and play with the examples I share in this book. Everybody learns differently. For some people, it is helpful to import some examples into their favorite IDE and play with it by modifying it, running, testing, or debugging. Find the way that works for you and feel free to ask questions or propose improvements through <a href="https://github.com/efficientgo/examples/issues">GitHub issues or pull requests</a>!</p>&#13;
&#13;
<p>Note that the code examples in this book are simplified for a clear view and smaller size. Particularly, the following rules apply:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>If the <code>Go</code> package is not specified, assume <code>package main</code>.</p>&#13;
</li>&#13;
<li>&#13;
<p>If the filename or extension of the example is not specified, assume the file has a <em>.go</em> extension. If it’s a functional test or microbenchmark, the file name has to end with <em>_test.go</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>import</code> statements are not always provided. In such cases, assume standard library or previously introduced packages are imported.</p>&#13;
</li>&#13;
<li>&#13;
<p>Sometimes, I don’t provide imports in the <code>import</code> statement but in a comment (<code>// import &lt;URL&gt;</code>). This is when I want to explain a single nontrivial import out of many needed in this code example.</p>&#13;
</li>&#13;
<li>&#13;
<p>A comment with three dots (<code>// ...</code>) specifies that some unrelated content was removed. This highlights that some logic is there for a function to make sense.</p>&#13;
</li>&#13;
<li>&#13;
<p>A comment with the <code>handle error</code> statement (<code>// handle error</code>) indicates that error handling was removed for readability. Always handle errors in your code!</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>This book is here to help you get your job done. In general, if this book offers an example code, you may use it in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. However, incorporating a significant amount of example code from this book into your product’s documentation does require permission.</p>&#13;
&#13;
<p>We appreciate but generally do not require attribution. An attribution usually includes the title, author, publisher, and ISBN. For example, "<em>Efficient Go</em> by Bartłomiej Płotka (O’Reilly). Copyright 2023 Alloc Limited, 978-1-098-10571-6.”</p>&#13;
&#13;
<p>If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at <a class="email" href="mailto:permissions@oreilly.com"><em>permissions@oreilly.com</em></a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Acknowledgments" data-type="sect1"><div class="sect1" id="thanks">&#13;
<h1>Acknowledgments</h1>&#13;
&#13;
<p>As they say, <a href="https://oreil.ly/owETM">“the greatness is in the agency of others”</a>. This book is no different. Numerous people helped me directly or indirectly in my <em>Efficient Go</em> book-writing journey and my career.</p>&#13;
&#13;
<p>First of all, I would love to thank my wife, Kasia—without her support, this wouldn’t be possible.</p>&#13;
&#13;
<p>Thanks to my main tech reviewers, Michael Bang and Saswata Mukherjee, for relentlessly checking all the content in detail. Thanks to others who looked at some parts of the early content and gave amazing feedback: Matej Gera, Felix Geisendörfer, &#13;
<span class="keep-together">Giedrius</span> Statkevičius, Björn Rabenstein, Lili Cosic, Johan Brandhorst-Satzkorn, Michael Hausenblas, Juraj Michalak, Kemal Akkoyun, Rick Rackow, Goutham Veeramachaneni, and more!</p>&#13;
&#13;
<p>Furthermore, thanks to the many talented people from the open source community who share enormous knowledge in their public content! They might not realize it, but they help with such work, including my writing of this book. You will see quotes from some of them in this book: Chandler Carruth, Brendan Gregg, Damian Gryski, Frederic Branczyk, Felix Geisendörfer, Dave Cheney, Bartosz Adamczewski, Dominik Honnef, William (Bill) Kennedy, Bryan Boreham, Halvar Flake, Cindy Sridharan, Tom Wilkie, Martin Kleppmann, Rob Pike, Russ Cox, Scott Mayers, and more.</p>&#13;
&#13;
<p>Finally, thanks to the O’Reilly team, especially Melissa Potter, Zan McQuade, and Clare Jensen, for amazing help and understanding of delays, moving deadlines, and sneaking more content into this book than planned! :)</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Feedback Is Welcome!" data-type="sect1"><div class="sect1" id="idm45606839611712">&#13;
<h1>Feedback Is Welcome!</h1>&#13;
&#13;
<p>If you are interested in following my work or the groups I work with or want to learn even more in this area, follow me on <a href="https://twitter.com/bwplotka">Twitter</a> or <a href="https://www.bwplotka.dev">check my blog</a>.</p>&#13;
&#13;
<p>Do not hesitate to reach out to me if you have feedback on my work or the content I have produced. I am always open to learning more!</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="O’Reilly Online Learning" data-type="sect1"><div class="sect1" id="idm45606839929072">&#13;
<h1>O’Reilly Online Learning</h1>&#13;
<div class="ormenabled" data-type="note" epub:type="note">&#13;
<p>For more than 40 years, <a class="orm:hideurl" href="https://oreilly.com"><em class="hyperlink">O’Reilly Media</em></a> has provided technology and business training, knowledge, and insight to help companies succeed.</p>&#13;
</div>&#13;
&#13;
<p>Our unique network of experts and innovators share their knowledge and expertise through books, articles, and our online learning platform. O’Reilly’s online learning platform gives you on-demand access to live training courses, in-depth learning paths, interactive coding environments, and a vast collection of text and video from O’Reilly and 200+ other publishers. For more information, visit <a class="orm:hideurl" href="https://oreilly.com"><em>https://oreilly.com</em></a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How to Contact Us" data-type="sect1"><div class="sect1" id="idm45606849038880">&#13;
<h1>How to Contact Us</h1>&#13;
&#13;
<p>Please address comments and questions concerning this book to the publisher:</p>&#13;
<ul class="simplelist">&#13;
  <li>O’Reilly Media, Inc.</li>&#13;
  <li>1005 Gravenstein Highway North</li>&#13;
  <li>Sebastopol, CA 95472</li>&#13;
  <li>800-998-9938 (in the United States or Canada)</li>&#13;
  <li>707-829-0515 (international or local)</li>&#13;
  <li>707-829-0104 (fax)</li>&#13;
</ul>&#13;
&#13;
<p>We have a web page for this book, where we list errata, examples, and any additional information. You can access this page at <a class="bare" href="https://oreil.ly/efficient-go"><em class="hyperlink">https://oreil.ly/efficient-go</em></a>.</p>&#13;
<!--Don't forget to update the link above.-->&#13;
&#13;
<p>Email <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a> to comment or ask technical questions about this book.</p>&#13;
&#13;
<p>For news and information about our books and courses, visit <a class="bare" href="https://oreilly.com"><em class="hyperlink">https://oreilly.com</em></a>.</p>&#13;
&#13;
<p>Find us on LinkedIn: <a class="bare" href="https://linkedin.com/company/oreilly-media"><em class="hyperlink">https://linkedin.com/company/oreilly-media</em></a>.</p>&#13;
&#13;
<p>Follow us on Twitter: <a class="bare" href="https://twitter.com/oreillymedia"><em class="hyperlink">https://twitter.com/oreillymedia</em></a>.</p>&#13;
&#13;
<p>Watch us on YouTube: <a class="bare" href="https://www.youtube.com/oreillymedia"><em class="hyperlink">https://www.youtube.com/oreillymedia</em></a>.</p>&#13;
</div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45606849001040"><sup><a href="preface01.html#idm45606849001040-marker">1</a></sup> If you are new to software development or open source, talk to us, start contributing, and apply for two months paid mentorship. Let me know if you would like to have fun while mentoring others! We need good mentors too—it’s important to teach another generation of open source maintainers.</p><p data-type="footnote" id="idm45606840126384"><sup><a href="preface01.html#idm45606840126384-marker">2</a></sup> I’ve already gotten feedback from some experienced people that they did not know you could use metrics to work on efficiency and performance improvements! It’s possible, and you will learn how here.</p></div></div></section></body></html>